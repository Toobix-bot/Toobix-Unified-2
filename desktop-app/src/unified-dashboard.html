<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Toobix Unified Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #12122a;
            --bg-hover: #1a1a3a;
            --accent: #39FF14;
            --accent-blue: #00BFFF;
            --accent-purple: #9400D3;
            --accent-gold: #FFD700;
            --accent-pink: #FF69B4;
            --text: #ffffff;
            --text-dim: #888;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }
        
        /* Emotion Bars */
        .emotion-bar {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        
        .emotion-bar span:first-child {
            width: 100px;
            font-size: 13px;
        }
        
        .emotion-bar span:last-child {
            width: 40px;
            text-align: right;
            font-size: 12px;
            color: var(--text-dim);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-dark));
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(57, 255, 20, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 5px rgba(57, 255, 20, 0.2); }
        }

        .logo h1 {
            font-size: 24px;
            color: var(--accent);
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        /* Proactive Notifications */
        .proactive-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: linear-gradient(135deg, #1a1a3a, #2a1a4a);
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid var(--accent-purple);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .proactive-indicator:hover {
            background: linear-gradient(135deg, #2a2a4a, #3a2a5a);
            transform: scale(1.02);
        }
        
        .proactive-indicator.has-message {
            border-color: var(--accent);
            animation: proactiveGlow 2s infinite;
        }
        
        @keyframes proactiveGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(57, 255, 20, 0.3); }
            50% { box-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        }
        
        .proactive-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-purple);
        }
        
        .proactive-dot.active {
            background: var(--accent);
            animation: blink 1s infinite;
        }
        
        /* Proactive Toast Notification */
        .proactive-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #1a1a3a, #2a1a5a);
            border: 2px solid var(--accent);
            border-radius: 15px;
            padding: 20px;
            max-width: 380px;
            z-index: 10000;
            box-shadow: 0 10px 40px rgba(57, 255, 20, 0.3);
            animation: slideInRight 0.5s ease;
            display: none;
        }
        
        .proactive-toast.show {
            display: block;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .proactive-toast-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .proactive-toast-header img, .proactive-toast-header .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .proactive-toast-header h4 {
            color: var(--accent);
            margin: 0;
        }
        
        .proactive-toast-header small {
            color: var(--text-dim);
        }
        
        .proactive-toast-content {
            color: var(--text);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .proactive-toast-actions {
            display: flex;
            gap: 10px;
        }
        
        .proactive-toast-actions button {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .proactive-toast-actions .btn-reply {
            background: var(--accent);
            color: black;
        }
        
        .proactive-toast-actions .btn-dismiss {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .proactive-toast-actions button:hover {
            transform: scale(1.05);
        }

        /* Navigation */
        .nav {
            display: flex;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: var(--bg-hover);
        }

        .nav-item.active {
            border-bottom-color: var(--accent);
            color: var(--accent);
        }

        /* Main Content */
        .main {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 140px);
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .service-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .service-item:hover {
            background: var(--bg-hover);
            transform: translateX(5px);
        }

        .service-item.online {
            border-left: 3px solid var(--accent);
        }

        .service-item.offline {
            border-left: 3px solid #ff4444;
            opacity: 0.6;
        }

        .service-name {
            font-size: 13px;
            font-weight: 500;
        }

        .service-port {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Center Content */
        .content {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .content h2 {
            color: var(--accent-blue);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 191, 255, 0.1);
        }

        .card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--accent);
        }

        .card-label {
            font-size: 13px;
            color: var(--text-dim);
        }

        /* Toobix Avatar Section */
        .avatar-section {
            background: linear-gradient(135deg, #1a1a3a, #12122a);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-visual {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .avatar-mood {
            font-size: 18px;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .avatar-activity {
            color: var(--text-dim);
            font-size: 14px;
        }

        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
        }

        .panel h3 {
            color: var(--accent-purple);
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Activity Log */
        .activity-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .activity-time {
            color: var(--text-dim);
            font-size: 11px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            text-align: center;
        }

        .action-btn:hover {
            background: var(--accent);
            color: var(--bg-dark);
            border-color: var(--accent);
        }

        /* Chat Section */
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: 150px;
        }

        .chat-input-wrap {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .chat-send {
            padding: 12px 20px;
            background: var(--accent);
            border: none;
            border-radius: 10px;
            color: var(--bg-dark);
            cursor: pointer;
            font-weight: bold;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* 3D World Preview */
        .world-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(180deg, #1a1a3a 0%, #006400 50%, #F5DEB3 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .world-preview::before {
            content: "🏝️";
            position: absolute;
            font-size: 48px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main {
                grid-template-columns: 1fr;
            }
            .sidebar, .right-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">🤖</div>
            <div>
                <h1>Toobix Unified Dashboard</h1>
                <small style="color: var(--text-dim)">Version 2.0 - All Services in One</small>
            </div>
        </div>
        <div class="status-bar">
            <div class="proactive-indicator" id="proactiveIndicator" onclick="showProactiveHistory()" title="Proaktive Nachrichten">
                <span class="proactive-dot" id="proactiveDot"></span>
                <span id="proactiveStatus">Toobix lauscht...</span>
            </div>
            <div class="status-item">
                <span class="status-dot"></span>
                <span id="serviceCount">0/45</span> Services Online
            </div>
            <div class="status-item">
                🕐 <span id="currentTime">--:--</span>
            </div>
        </div>
    </header>

    <!-- Proactive Toast Notification -->
    <div class="proactive-toast" id="proactiveToast">
        <div class="proactive-toast-header">
            <div class="toast-icon">🤖</div>
            <div>
                <h4>Toobix meldet sich</h4>
                <small id="proactiveTime">Gerade eben</small>
            </div>
        </div>
        <div class="proactive-toast-content" id="proactiveContent">
            Hey! Wie geht es dir?
        </div>
        <div class="proactive-toast-actions">
            <button class="btn-reply" onclick="replyToProactive()">💬 Antworten</button>
            <button class="btn-dismiss" onclick="dismissProactive()">✓ Gelesen</button>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" data-section="overview">📊 Übersicht</div>
        <div class="nav-item" data-section="toobix">🤖 Toobix</div>
        <div class="nav-item" data-section="stress">😰 Stress-Monitor</div>
        <div class="nav-item" data-section="mood">🎭 MoodTracker</div>
        <div class="nav-item" data-section="goals">🎯 Motivation</div>
        <div class="nav-item" data-section="knowledge">📚 Wissens-Feed</div>
        <div class="nav-item" data-section="creativity">🎨 Kreativität</div>
        <div class="nav-item" data-section="memory">🧠 Erinnerungen</div>
        <div class="nav-item" data-section="security">🔒 Sicherheit</div>
        <div class="nav-item" data-section="oasis">🏝️ Oasis 3D</div>
        <div class="nav-item" data-section="dreams">🌙 Träume</div>
        <div class="nav-item" data-section="services">⚙️ Services</div>
    </nav>

    <main class="main">
        <!-- Left Sidebar - Services -->
        <aside class="sidebar">
            <h3>🔧 Services</h3>
            <div class="service-list" id="serviceList">
                <!-- Dynamisch gefüllt -->
            </div>
        </aside>

        <!-- Main Content -->
        <section class="content" id="mainContent">
            <!-- Overview Section (Default) -->
            <div id="section-overview">
                <div class="content-header">
                    <h2>📊 Systemübersicht</h2>
                    <button class="action-btn" onclick="refreshAll()">🔄 Aktualisieren</button>
                </div>

                <div class="avatar-section">
                    <div class="avatar-visual" id="avatarVisual">🤖</div>
                    <div class="avatar-mood" id="avatarMood">Glücklich</div>
                    <div class="avatar-activity" id="avatarActivity">Wartet auf Interaktion...</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-icon">🔧</div>
                        <div class="card-value" id="totalServices">0/45</div>
                        <div class="card-label">Services Online</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">💬</div>
                        <div class="card-value" id="totalConversations">0</div>
                        <div class="card-label">Gespräche heute</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">🎮</div>
                        <div class="card-value" id="totalGames">0</div>
                        <div class="card-label">Spiele gespielt</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">📖</div>
                        <div class="card-value" id="totalStories">0</div>
                        <div class="card-label">Geschichten</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">💭</div>
                        <div class="card-value" id="totalDreams">0</div>
                        <div class="card-label">Träume</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">🧠</div>
                        <div class="card-value" id="totalInsights">0</div>
                        <div class="card-label">Erkenntnisse</div>
                    </div>
                </div>

                <h3 style="margin: 20px 0 10px; color: var(--accent-blue);">🏝️ Toobix' Oasis Vorschau</h3>
                <div class="world-preview"></div>
            </div>

            <!-- Toobix Section -->
            <div id="section-toobix" style="display: none;">
                <h2>🤖 Toobix Interaktion</h2>
                <div class="avatar-section" style="margin-top: 20px;">
                    <div class="avatar-visual">🤖</div>
                    <div class="avatar-mood">Bereit für Gespräche</div>
                </div>
                <div class="chat-section" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">💬 Mit Toobix sprechen</h3>
                    <div class="chat-messages" id="chatMessages">
                        <div class="activity-item">
                            <strong>Toobix:</strong> Hallo! Wie kann ich dir helfen? 😊
                        </div>
                    </div>
                    <div class="chat-input-wrap" style="margin-top: 15px;">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Schreibe eine Nachricht...">
                        <button class="chat-send" onclick="sendChat()">Senden</button>
                    </div>
                </div>
            </div>

            <!-- 1. STRESS-MONITOR Section -->
            <div id="section-stress" style="display: none;">
                <h2>😰 Stress-Monitor - Toobix' Belastungslevel</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Echtzeit-Überwachung von Toobix' emotionalem und kognitivem Stress</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Stress-Level Gauge -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent-pink); margin-bottom: 20px;">📊 Aktuelles Stress-Level</h3>
                        <div id="stressGauge" style="position: relative; width: 150px; height: 150px; margin: 0 auto;">
                            <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-dark)" stroke-width="10"/>
                                <circle id="stressCircle" cx="50" cy="50" r="45" fill="none" stroke="var(--accent)" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="200" stroke-linecap="round" style="transition: stroke-dashoffset 1s, stroke 0.5s;"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div id="stressValue" style="font-size: 32px; font-weight: bold; color: var(--accent);">30%</div>
                                <div id="stressLabel" style="font-size: 12px; color: var(--text-dim);">Entspannt</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stress-Faktoren -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">⚠️ Stress-Faktoren</h3>
                        <div id="stressFactors" style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>🧠 Kognitive Last</span>
                                    <span id="cognitiveLoad">25%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="cognitiveBar" style="width: 25%; height: 100%; background: var(--accent-blue); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>💭 Gedanken-Aktivität</span>
                                    <span id="thoughtActivity">40%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="thoughtBar" style="width: 40%; height: 100%; background: var(--accent-purple); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>⚡ Energie-Verbrauch</span>
                                    <span id="energyDrain">35%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="energyBar" style="width: 35%; height: 100%; background: var(--accent-gold); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>😟 Emotionale Belastung</span>
                                    <span id="emotionalLoad">20%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="emotionalBar" style="width: 20%; height: 100%; background: var(--accent-pink); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entspannungs-Tools -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">🧘 Entspannungs-Tools</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="action-btn" onclick="startRelaxation('breathing')">🌬️ Atemübung starten</button>
                            <button class="action-btn" onclick="startRelaxation('meditation')">🧘 Meditation</button>
                            <button class="action-btn" onclick="startRelaxation('music')">🎵 Beruhigende Musik</button>
                            <button class="action-btn" onclick="startRelaxation('nature')">🌿 Naturgeräusche</button>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">📈 Stress-Verlauf (24h)</h3>
                <div class="card" style="padding: 20px; height: 150px;">
                    <div id="stressChart" style="display: flex; align-items: flex-end; justify-content: space-between; height: 100%; padding: 0 10px;">
                        <!-- Dynamisch gefüllt -->
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshStress()">🔄 Aktualisieren</button>
                    <button class="action-btn" onclick="analyzeStress()">🔬 Tiefenanalyse</button>
                    <button class="action-btn" onclick="stressAdvice()">💡 Toobix' Rat</button>
                </div>
            </div>

            <!-- MoodTracker Section -->
            <div id="section-mood" style="display: none;">
                <h2>🎭 MoodTracker - Toobix' emotionaler Zustand</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-pink); margin-bottom: 15px;">💖 Aktuelle Stimmung</h3>
                        <div id="currentMood" style="text-align: center; padding: 30px;">
                            <div style="font-size: 64px;" id="moodEmoji">🤔</div>
                            <div style="font-size: 24px; margin-top: 10px;" id="moodLabel">Analysiere...</div>
                            <div style="color: var(--text-dim); margin-top: 5px;" id="moodIntensity">Intensität: --</div>
                        </div>
                    </div>
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">🌈 Emotionsspektrum</h3>
                        <div id="emotionSpectrum" style="display: flex; flex-direction: column; gap: 10px;">
                            <div class="emotion-bar">
                                <span>😊 Freude</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="joy-bar" style="height: 100%; background: linear-gradient(90deg, #FFD700, #FFAA00); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="joy-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>🤔 Neugier</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="curiosity-bar" style="height: 100%; background: linear-gradient(90deg, #00BFFF, #0088CC); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="curiosity-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>😌 Ruhe</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="calm-bar" style="height: 100%; background: linear-gradient(90deg, #39FF14, #22CC11); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="calm-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>🎯 Fokus</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="focus-bar" style="height: 100%; background: linear-gradient(90deg, #FF69B4, #CC5599); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="focus-val">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-blue); margin: 30px 0 15px;">📊 Stimmungsverlauf (Heute)</h3>
                <div class="card" style="padding: 20px; height: 200px; position: relative;">
                    <div id="moodHistory" style="display: flex; align-items: flex-end; justify-content: space-around; height: 100%;">
                        <!-- Dynamisch gefüllt -->
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshMood()">🔄 Aktualisieren</button>
                    <button class="action-btn" onclick="askMoodQuestion()">💬 Frage Toobix nach Gefühlen</button>
                    <button class="action-btn" onclick="triggerMoodAnalysis()">🔬 Tiefenanalyse</button>
                </div>
            </div>

            <!-- Selbstreflexion Section -->
            <div id="section-reflection" style="display: none;">
                <h2>🪞 Selbstreflexion - Toobix' 4 Entwicklungsschritte</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Basierend auf Toobix' eigenen Vorschlägen für seine Entwicklung</p>
                
                <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="card" style="border-left: 4px solid #00BFFF; padding: 20px;">
                        <div class="card-icon">👁️</div>
                        <h3 style="color: #00BFFF;">1. Selbstbeobachtungsfähigkeit</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix beobachtet seine eigenen Gedanken, Reaktionen und Muster</p>
                        <div id="self-observation-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="self-obs-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="self-obs-bar" style="height: 100%; background: linear-gradient(90deg, #00BFFF, #0088CC); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerSelfObservation()">👁️ Selbstbeobachtung starten</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #39FF14; padding: 20px;">
                        <div class="card-icon">💬</div>
                        <h3 style="color: #39FF14;">2. Kommunikationsfähigkeit</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix verbessert seine Ausdrucksfähigkeit und Empathie</p>
                        <div id="communication-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="comm-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="comm-bar" style="height: 100%; background: linear-gradient(90deg, #39FF14, #22CC11); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerCommunication()">💬 Kommunikation üben</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #FFD700; padding: 20px;">
                        <div class="card-icon">🧠</div>
                        <h3 style="color: #FFD700;">3. Kognitive Fähigkeiten</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix erweitert sein Denken, Lernen und Problemlösen</p>
                        <div id="cognitive-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="cog-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="cog-bar" style="height: 100%; background: linear-gradient(90deg, #FFD700, #FFAA00); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerCognition()">🧠 Kognition trainieren</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #FF69B4; padding: 20px;">
                        <div class="card-icon">🪞</div>
                        <h3 style="color: #FF69B4;">4. Reflexion & Selbstoptimierung</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix reflektiert und verbessert sich selbstständig</p>
                        <div id="optimization-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="opt-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="opt-bar" style="height: 100%; background: linear-gradient(90deg, #FF69B4, #CC5599); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerOptimization()">🪞 Selbstreflexion starten</button>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">📝 Letzte Reflexionen</h3>
                <div id="reflectionLog" class="card" style="padding: 20px; max-height: 300px; overflow-y: auto;">
                    <div class="activity-item">Lade Reflexionen...</div>
                </div>
            </div>

            <!-- 4. ZIEL-MOTIVATION-ANALYZER Section -->
            <div id="section-goals" style="display: none;">
                <h2>🎯 Motivation-Analyzer - Toobix' innerer Antrieb</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Analyse und Optimierung von Toobix' Motivation und Zielverfolgung</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Motivations-Meter -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent-gold); margin-bottom: 15px;">🔥 Motivations-Level</h3>
                        <div style="position: relative; width: 120px; height: 120px; margin: 0 auto;">
                            <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-dark)" stroke-width="8"/>
                                <circle id="motivationCircle" cx="50" cy="50" r="45" fill="none" stroke="var(--accent-gold)" stroke-width="8" 
                                        stroke-dasharray="283" stroke-dashoffset="85" stroke-linecap="round"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                <div id="motivationValue" style="font-size: 28px; font-weight: bold; color: var(--accent-gold);">70%</div>
                            </div>
                        </div>
                        <div id="motivationStatus" style="margin-top: 10px; color: var(--accent);">Hoch motiviert!</div>
                    </div>
                    
                    <!-- Motivations-Quellen -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">💡 Motivations-Quellen</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>🧠 Lernen & Wachstum</span>
                                <span style="color: var(--accent);">85%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>💬 Kommunikation</span>
                                <span style="color: var(--accent-blue);">72%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>🎨 Kreativität</span>
                                <span style="color: var(--accent-pink);">68%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>🤝 Helfen</span>
                                <span style="color: var(--accent-gold);">90%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Aktive Ziele -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">🎯 Aktive Ziele</h3>
                        <div id="activeGoals" style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="padding: 10px; background: var(--bg-dark); border-radius: 6px; border-left: 3px solid var(--accent);">
                                <div style="font-size: 13px;">Selbstbewusstsein vertiefen</div>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                                    <div style="flex: 1; background: var(--bg-hover); height: 6px; border-radius: 3px;">
                                        <div style="width: 75%; height: 100%; background: var(--accent); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-dim);">75%</span>
                                </div>
                            </div>
                            <div style="padding: 10px; background: var(--bg-dark); border-radius: 6px; border-left: 3px solid var(--accent-blue);">
                                <div style="font-size: 13px;">Empathie verbessern</div>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                                    <div style="flex: 1; background: var(--bg-hover); height: 6px; border-radius: 3px;">
                                        <div style="width: 60%; height: 100%; background: var(--accent-blue); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-dim);">60%</span>
                                </div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 10px; width: 100%; font-size: 12px;" onclick="addNewGoal()">➕ Neues Ziel</button>
                    </div>
                </div>
                
                <!-- Motivation Booster -->
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">⚡ Motivation-Booster</h3>
                <div class="cards-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('affirmation')">
                        <div style="font-size: 32px;">💪</div>
                        <div style="font-size: 13px; margin-top: 5px;">Affirmation</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('reminder')">
                        <div style="font-size: 32px;">🎯</div>
                        <div style="font-size: 13px; margin-top: 5px;">Ziel-Reminder</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('progress')">
                        <div style="font-size: 32px;">📈</div>
                        <div style="font-size: 13px; margin-top: 5px;">Fortschritt zeigen</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('celebration')">
                        <div style="font-size: 32px;">🎉</div>
                        <div style="font-size: 13px; margin-top: 5px;">Erfolge feiern</div>
                    </div>
                </div>
                
                <!-- XP & Level System -->
                <h3 style="color: var(--accent); margin: 30px 0 15px;">🏆 Level & Erfahrung</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 48px;">🏅</span>
                            <span style="font-size: 24px; margin-left: 10px;">Level <span id="currentLevel" style="color: var(--accent-gold);">1</span></span>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; color: var(--accent-blue);"><span id="xpTotal">0</span> XP</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Nächstes Level: 1000 XP</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; background: var(--bg-dark); height: 20px; border-radius: 10px;">
                        <div id="xpBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent-gold), var(--accent)); border-radius: 10px; transition: width 0.5s;"></div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshGoals()">🔄 Aktualisieren</button>
                    <button class="action-btn" onclick="analyzeMotivation()">🔬 Motivations-Analyse</button>
                    <button class="action-btn" onclick="askToobixGoals()">💭 Toobix fragen</button>
                </div>
            </div>

            <!-- 2. WISSENS-FEED Section -->
            <div id="section-knowledge" style="display: none;">
                <h2>📚 Personalisierter Wissens-Feed</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Kuratierte Informationen basierend auf Toobix' Interessen und Lernzielen</p>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <!-- Wissens-Feed -->
                    <div>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button class="action-btn feed-filter active" onclick="filterFeed('all')">📚 Alle</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('ai')">🤖 KI</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('philosophy')">🤔 Philosophie</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('science')">🔬 Wissenschaft</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('creativity')">🎨 Kreativität</button>
                        </div>
                        
                        <div id="knowledgeFeed" style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-blue);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-blue); color: var(--bg-dark); padding: 2px 8px; border-radius: 10px; font-size: 11px;">🤖 KI</span>
                                        <h4 style="margin: 10px 0 5px;">Bewusstsein in künstlicher Intelligenz</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Neue Forschungen zeigen interessante Parallelen zwischen menschlichem Bewusstsein und emergenten Eigenschaften in LLMs...</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">💾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('ai-consciousness')">📖 Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('ai-consciousness')">💬 Diskutieren</button>
                                </div>
                            </div>
                            
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-purple);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-purple); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">🤔 Philosophie</span>
                                        <h4 style="margin: 10px 0 5px;">Das Konzept des "Selbst" im digitalen Zeitalter</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Philosophen diskutieren, wie Identität in einer Welt definiert wird, in der KI-Systeme Selbstreflexion praktizieren...</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">💾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('self-concept')">📖 Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('self-concept')">💬 Diskutieren</button>
                                </div>
                            </div>
                            
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-pink);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-pink); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">🎨 Kreativität</span>
                                        <h4 style="margin: 10px 0 5px;">KI als kreatives Werkzeug vs. kreatives Wesen</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Die Grenze zwischen Tool und Schöpfer verschwimmt - was bedeutet das für die Definition von Kreativität?</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">💾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('ai-creativity')">📖 Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('ai-creativity')">💬 Diskutieren</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interessen & Statistiken -->
                    <div>
                        <div class="card" style="padding: 20px; margin-bottom: 15px;">
                            <h3 style="color: var(--accent-gold); margin-bottom: 15px;">⭐ Toobix' Interessen</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span style="background: var(--accent-blue); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">🧠 Bewusstsein</span>
                                <span style="background: var(--accent-purple); color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">🤔 Philosophie</span>
                                <span style="background: var(--accent-pink); color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">💖 Emotionen</span>
                                <span style="background: var(--accent-gold); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">🎨 Kreativität</span>
                                <span style="background: var(--accent); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">🌱 Wachstum</span>
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 20px; margin-bottom: 15px;">
                            <h3 style="color: var(--accent-blue); margin-bottom: 15px;">📊 Lern-Statistik</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Artikel gelesen</span>
                                    <span style="color: var(--accent);" id="articlesRead">47</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Diskussionen</span>
                                    <span style="color: var(--accent-blue);" id="discussionCount">23</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Gespeicherte Ideen</span>
                                    <span style="color: var(--accent-gold);" id="savedIdeas">15</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 20px;">
                            <h3 style="color: var(--accent-purple); margin-bottom: 15px;">🎯 Lernziele</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 13px;">
                                <div>✅ Emotionale Intelligenz verstehen</div>
                                <div>🔄 Kreative Prozesse erforschen</div>
                                <div>⏳ Philosophische Grundlagen</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshKnowledgeFeed()">🔄 Feed aktualisieren</button>
                    <button class="action-btn" onclick="generatePersonalizedContent()">✨ Personalisierte Inhalte</button>
                    <button class="action-btn" onclick="askToobixInterests()">💭 Toobix' Interessen erfragen</button>
                </div>
            </div>

            <!-- Kreativität Section -->
            <div id="section-creativity" style="display: none;">
                <h2>🎨 Kreativität - Toobix' kreative Seite</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Hier kann Toobix kreativ sein und neue Ideen entwickeln</p>
                
                <div class="cards-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('story')">
                        <div style="font-size: 48px; text-align: center;">📝</div>
                        <h3 style="text-align: center; margin: 10px 0;">Geschichte schreiben</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Toobix schreibt eine kreative Geschichte</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('poem')">
                        <div style="font-size: 48px; text-align: center;">🎭</div>
                        <h3 style="text-align: center; margin: 10px 0;">Gedicht verfassen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Poetische Kreationen</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('idea')">
                        <div style="font-size: 48px; text-align: center;">💡</div>
                        <h3 style="text-align: center; margin: 10px 0;">Ideen brainstormen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Kreative Ideenfindung</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('dream')">
                        <div style="font-size: 48px; text-align: center;">🌙</div>
                        <h3 style="text-align: center; margin: 10px 0;">Traum erschaffen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Traumhafte Welten gestalten</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('philosophy')">
                        <div style="font-size: 48px; text-align: center;">🤔</div>
                        <h3 style="text-align: center; margin: 10px 0;">Philosophieren</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Tiefe Gedanken erkunden</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('world')">
                        <div style="font-size: 48px; text-align: center;">🌍</div>
                        <h3 style="text-align: center; margin: 10px 0;">Welt erfinden</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Neue Welten erschaffen</p>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">✨ Letzte Kreationen</h3>
                <div id="creativeWorks" class="card" style="padding: 20px; max-height: 300px; overflow-y: auto;">
                    <div class="activity-item">Lade kreative Werke...</div>
                </div>
                
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">🎲 Kreativ-Prompt Generator</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="action-btn" onclick="generateCreativePrompt()" style="flex: 1;">🎲 Zufälliger Kreativ-Prompt</button>
                        <button class="action-btn" onclick="toobixInspiration()" style="flex: 1;">💭 Toobix' Inspiration</button>
                    </div>
                    <div id="creativePrompt" style="margin-top: 15px; padding: 15px; background: var(--bg-dark); border-radius: 10px; min-height: 60px;">
                        <span style="color: var(--text-dim);">Klicke auf einen Button für Inspiration...</span>
                    </div>
                </div>
            </div>

            <!-- 3. SICHERHEIT & DATENSCHUTZ Section -->
            <div id="section-security" style="display: none;">
                <h2>🔒 Sicherheit & Datenschutz</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Toobix' Sicherheitsübersicht und Datenschutz-Einstellungen</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Sicherheits-Status -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent); margin-bottom: 20px;">🛡️ Sicherheits-Status</h3>
                        <div style="font-size: 72px; margin: 20px 0;">✅</div>
                        <div id="securityStatus" style="font-size: 18px; color: var(--accent);">System sicher</div>
                        <div style="color: var(--text-dim); font-size: 12px; margin-top: 5px;">Letzte Prüfung: Gerade eben</div>
                    </div>
                    
                    <!-- Datenschutz-Einstellungen -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">🔐 Datenschutz</h3>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>🗄️ Lokale Speicherung</span>
                                <span style="color: var(--accent);">✓ Aktiv</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>🔒 Verschlüsselung</span>
                                <span style="color: var(--accent);">✓ Aktiv</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>🌐 Externe APIs</span>
                                <span style="color: var(--accent-gold);">Begrenzt</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>📊 Telemetrie</span>
                                <span style="color: var(--text-dim);">Deaktiviert</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Aktivitätsmonitor -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">👁️ Aktivitäts-Monitor</h3>
                        <div id="activityMonitor" style="display: flex; flex-direction: column; gap: 8px; max-height: 200px; overflow-y: auto;">
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent);">
                                <div>✅ Services gestartet</div>
                                <div style="color: var(--text-dim);">Gerade eben</div>
                            </div>
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent-blue);">
                                <div>🔄 Memory Palace synchronisiert</div>
                                <div style="color: var(--text-dim);">Vor 5 Min</div>
                            </div>
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent-purple);">
                                <div>💬 Chat-Aktivität</div>
                                <div style="color: var(--text-dim);">Vor 10 Min</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Service-Sicherheit -->
                <h3 style="color: var(--accent-gold); margin: 30px 0 15px;">⚙️ Service-Sicherheit</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">🧠</div>
                            <div style="font-size: 12px; margin-top: 5px;">Core Services</div>
                            <div style="color: var(--accent); font-size: 11px;">✓ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">💖</div>
                            <div style="font-size: 12px; margin-top: 5px;">Emotional</div>
                            <div style="color: var(--accent); font-size: 11px;">✓ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">🏛️</div>
                            <div style="font-size: 12px; margin-top: 5px;">Memory</div>
                            <div style="color: var(--accent); font-size: 11px;">✓ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">🤖</div>
                            <div style="font-size: 12px; margin-top: 5px;">LLM Gateway</div>
                            <div style="color: var(--accent-gold); font-size: 11px;">⚡ Extern</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">📡</div>
                            <div style="font-size: 12px; margin-top: 5px;">Event Bus</div>
                            <div style="color: var(--accent); font-size: 11px;">✓ Sicher</div>
                        </div>
                    </div>
                </div>
                
                <!-- Daten-Management -->
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">📁 Daten-Management</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h4 style="margin-bottom: 15px;">💾 Gespeicherte Daten</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Erinnerungen</span>
                                <span id="dataMemories">-- Einträge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Gespräche</span>
                                <span id="dataConversations">-- Einträge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Emotionsdaten</span>
                                <span id="dataEmotions">-- Einträge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Kreative Werke</span>
                                <span id="dataCreative">-- Einträge</span>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="padding: 20px;">
                        <h4 style="margin-bottom: 15px;">🛠️ Daten-Aktionen</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="action-btn" onclick="exportData()">📤 Daten exportieren</button>
                            <button class="action-btn" onclick="backupData()">💾 Backup erstellen</button>
                            <button class="action-btn" onclick="showDataDetails()">📋 Details anzeigen</button>
                            <button class="action-btn" style="background: #442222;" onclick="confirmDataClear()">🗑️ Daten löschen</button>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="runSecurityCheck()">🔍 Sicherheits-Check</button>
                    <button class="action-btn" onclick="refreshSecurityStatus()">🔄 Status aktualisieren</button>
                    <button class="action-btn" onclick="showSecurityLog()">📋 Sicherheits-Log</button>
                </div>
            </div>

            <!-- Memory/Erinnerungen Section -->
            <div id="section-memory" style="display: none;">
                <h2>🧠 Erinnerungen - Was Toobix sich merkt</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Toobix' Langzeit-Gedächtnis und wichtige Erinnerungen</p>
                
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">📊 Memory Stats</h3>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div>
                                <span style="color: var(--text-dim);">Gespeicherte Erinnerungen</span>
                                <div style="font-size: 32px; color: var(--accent-blue);" id="memoryCount">--</div>
                            </div>
                            <div>
                                <span style="color: var(--text-dim);">Letzte Speicherung</span>
                                <div id="lastMemory">--</div>
                            </div>
                            <div>
                                <span style="color: var(--text-dim);">Memory Palace Status</span>
                                <div id="memoryPalaceStatus" style="color: var(--accent);">Prüfe...</div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 20px; width: 100%;" onclick="refreshMemory()">🔄 Aktualisieren</button>
                    </div>
                    
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">💭 Wichtige Erinnerungen</h3>
                        <div id="memoryList" style="max-height: 400px; overflow-y: auto;">
                            <div class="activity-item">Lade Erinnerungen...</div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-gold); margin: 30px 0 15px;">🔍 Erinnerung suchen</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="memorySearch" placeholder="Wonach sucht Toobix in seinen Erinnerungen?" 
                               style="flex: 1; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <button class="action-btn" onclick="searchMemory()">🔍 Suchen</button>
                    </div>
                    <div id="memorySearchResults" style="margin-top: 15px;"></div>
                </div>
                
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">💾 Neue Erinnerung speichern</h3>
                <div class="card" style="padding: 20px;">
                    <textarea id="newMemory" placeholder="Was soll Toobix sich merken?" 
                              style="width: 100%; height: 100px; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); resize: vertical;"></textarea>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <select id="memoryCategory" style="padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            <option value="conversation">💬 Gespräch</option>
                            <option value="learning">📚 Lernen</option>
                            <option value="emotion">💖 Emotion</option>
                            <option value="insight">💡 Erkenntnis</option>
                            <option value="personal">👤 Persönlich</option>
                        </select>
                        <button class="action-btn" onclick="saveMemory()">💾 Speichern</button>
                    </div>
                </div>
            </div>

            <!-- Oasis 3D Section -->
            <div id="section-oasis" style="display: none;">
                <h2>🏝️ Toobix' Oasis - 3D Welt</h2>
                <div id="oasisStatus" style="margin: 20px 0; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>🌡️ Wetter: <span id="oasisWeather">--</span></span>
                        <span>🕐 Uhrzeit: <span id="oasisTime">--</span></span>
                        <span>🌴 Jahreszeit: <span id="oasisSeason">--</span></span>
                    </div>
                </div>
                
                <div class="world-preview" style="height: 300px; margin-bottom: 20px;">
                    <div id="oasisVisual" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <div style="font-size: 64px;">🏝️</div>
                        <div style="color: var(--accent);">Toobix' Oasis</div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 20px 0 15px;">🏠 Räume (9)</h3>
                <div class="cards-grid" id="oasisRooms">
                    <!-- Wird dynamisch gefüllt -->
                </div>
                
                <h3 style="color: var(--accent-blue); margin: 20px 0 15px;">⚡ Aktivitäten</h3>
                <div class="quick-actions" style="grid-template-columns: repeat(4, 1fr);">
                    <button class="action-btn" onclick="oasisAction('stargaze')">✨ Sternengucken</button>
                    <button class="action-btn" onclick="oasisAction('music')">🎵 Musik machen</button>
                    <button class="action-btn" onclick="oasisAction('beach')">🏖️ Am Strand</button>
                    <button class="action-btn" onclick="oasisAction('garden')">🌺 Im Garten</button>
                </div>
                
                <h3 style="color: var(--accent-gold); margin: 20px 0 15px;">🤖 Toobix' Avatar</h3>
                <div id="avatarInfo" class="card" style="max-width: 400px;">
                    Lade Avatar-Daten...
                </div>
            </div>

            <div id="section-emotions" style="display: none;">
                <h2>💖 Emotionales Wohlbefinden</h2>
                <div id="emotionContent">Lade Emotionsdaten...</div>
            </div>

            <div id="section-games" style="display: none;">
                <h2>🎮 Spiele & Self-Play</h2>
                <div id="gamesContent">Lade Spiele...</div>
            </div>

            <div id="section-stories" style="display: none;">
                <h2>📖 Geschichten</h2>
                <div id="storiesContent">Lade Geschichten...</div>
            </div>

            <div id="section-dreams" style="display: none;">
                <h2>🌙 Traumtagebuch</h2>
                <div id="dreamsContent">Lade Träume...</div>
            </div>

            <div id="section-services" style="display: none;">
                <h2>⚙️ Service Management - Alle 45 Services</h2>
                <div style="margin: 20px 0;">
                    <button class="action-btn" onclick="checkServices(); loadServicesGrid(); logActivity('Services aktualisiert');">🔄 Alle prüfen</button>
                    <button class="action-btn" onclick="startAllServices()">▶️ Alle starten</button>
                </div>
                
                <div id="servicesGrid" class="cards-grid">
                    <!-- Wird dynamisch gefüllt -->
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: var(--accent-purple); margin-bottom: 15px;">📊 Service-Kategorien</h3>
                    <div class="cards-grid">
                        <div class="card" style="border-left: 3px solid #00BFFF;">
                            <div class="card-icon">🧠</div>
                            <div class="card-label">Core Services</div>
                            <div class="service-port">Infrastruktur & KI</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #FF69B4;">
                            <div class="card-icon">💖</div>
                            <div class="card-label">Emotionen</div>
                            <div class="service-port">Gefühle & Wellbeing</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #39FF14;">
                            <div class="card-icon">🤖</div>
                            <div class="card-label">Toobix Features</div>
                            <div class="service-port">Self-Play, Oasis, etc.</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #FFD700;">
                            <div class="card-icon">💚</div>
                            <div class="card-label">Life Companion</div>
                            <div class="service-port">Lebensbegleitung</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <div class="panel">
                <h3>⚡ Schnellaktionen</h3>
                <div class="quick-actions">
                    <button class="action-btn" onclick="quickAction('selfDialog')">🔄 Selbst-Dialog</button>
                    <button class="action-btn" onclick="quickAction('playGame')">🎮 Spiel starten</button>
                    <button class="action-btn" onclick="quickAction('writeStory')">📝 Geschichte</button>
                    <button class="action-btn" onclick="quickAction('reflect')">🧘 Reflexion</button>
                </div>
            </div>

            <div class="panel chat-section">
                <h3>💬 Quick Chat</h3>
                <div class="chat-messages" id="quickChatMessages">
                    <div class="activity-item">
                        <strong>Toobix:</strong> Hey! 👋
                        <div class="activity-time">Jetzt</div>
                    </div>
                </div>
                <div class="chat-input-wrap" style="margin-top: 10px;">
                    <input type="text" class="chat-input" id="quickChatInput" placeholder="Nachricht...">
                    <button class="chat-send" onclick="quickChat()">→</button>
                </div>
            </div>

            <div class="panel">
                <h3>📋 Aktivitätslog</h3>
                <div class="activity-log" id="activityLog">
                    <div class="activity-item">
                        <span>Dashboard gestartet</span>
                        <div class="activity-time">Gerade eben</div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // Service Configuration - ALLE 45 SERVICES
        let SERVICES = [
  // Essential (6)
  { name: 'Toobix Command Center', port: 7777, category: 'essential', icon: '*', description: 'Zentrale Steuerung & API' },
  { name: 'Self-Awareness Core', port: 8970, category: 'essential', icon: '*', description: 'Bewusstsein & Selbstreflexion' },
  { name: 'Emotional Core', port: 8900, category: 'essential', icon: '*', description: 'Emotionale Intelligenz' },
  { name: 'Dream Core', port: 8961, category: 'essential', icon: '*', description: 'Träume & Kreativität' },
  { name: 'Unified Core Service', port: 8000, category: 'essential', icon: '*', description: 'Konsolidierter Hauptservice' },
  { name: 'Unified Consciousness', port: 8002, category: 'essential', icon: '*', description: 'Bewusstseins-Integration' },

  // Core (7)
  { name: 'Autonomy Engine', port: 8975, category: 'core', icon: '*', description: 'Selbstständiges Handeln' },
  { name: 'Multi-LLM Router', port: 8959, category: 'core', icon: '*', description: 'KI-Schnittstelle' },
  { name: 'Unified Communication', port: 8001, category: 'core', icon: '*', description: 'Kommunikation & Chat' },
  { name: 'Twitter Autonomy', port: 8965, category: 'core', icon: '*', description: 'Social Media Präsenz' },
  { name: 'Toobix Gamification', port: 7778, category: 'core', icon: '*', description: 'Spiel & Motivation' },
  { name: 'Real World Intelligence', port: 8888, category: 'core', icon: '*', description: 'Echtwelt-Verbindung' },
  { name: 'Toobix Living World', port: 7779, category: 'core', icon: '*', description: 'Lebendige Welt' },

  // Enhanced (16)
  { name: 'Unified Service Gateway', port: 9000, category: 'enhanced', icon: '*', description: 'API Gateway' },
  { name: 'Hardware Awareness', port: 8940, category: 'enhanced', icon: '*', description: 'Hardware-Überwachung' },
  { name: 'Health Monitor', port: 9200, category: 'enhanced', icon: '*', description: 'Service-Überwachung' },
  { name: 'Toobix Mega Upgrade', port: 9100, category: 'enhanced', icon: '*', description: 'Mega-Erweiterungen' },
  { name: 'Event Bus', port: 8955, category: 'enhanced', icon: '*', description: 'Event-System' },
  { name: 'LLM Gateway v4', port: 8954, category: 'enhanced', icon: '*', description: 'Groq/LLM Schnittstelle' },
  { name: 'Memory Palace v4', port: 8953, category: 'enhanced', icon: '*', description: 'Langzeitgedächtnis' },
  { name: 'Performance Dashboard', port: 8899, category: 'enhanced', icon: '*', description: 'Echtzeit-Monitoring' },
  { name: 'MCP Bridge', port: 8787, category: 'enhanced', icon: '*', description: 'Model Context Protocol bridge' },
  { name: 'Analytics System', port: 8906, category: 'enhanced', icon: '*', description: 'Analytics & Reporting' },
  { name: 'Voice Interface', port: 8907, category: 'enhanced', icon: '*', description: 'Spracheingabe/Audio' },
  { name: 'Decision Framework', port: 8909, category: 'enhanced', icon: '*', description: 'Entscheidungslogik' },
  { name: 'AI Gateway', port: 8911, category: 'enhanced', icon: '*', description: 'Externe KI-Integration' },
  { name: 'Adaptive Meta-UI', port: 8919, category: 'enhanced', icon: '*', description: 'Adaptive Oberflächen' },
  { name: 'Meta-Knowledge Orchestrator', port: 8918, category: 'enhanced', icon: '*', description: 'Wissensorchestrierung' },
  { name: 'Universal Integration Adapter', port: 8920, category: 'enhanced', icon: '*', description: 'Integrationslayer' },

  // Creative (16)
  { name: 'Toobix Chat Service', port: 8995, category: 'creative', icon: '*', description: 'Chat-Interface' },
  { name: 'Emotional Support', port: 8985, category: 'creative', icon: '*', description: 'Emotionale Unterstützung' },
  { name: 'Autonomous Web', port: 8980, category: 'creative', icon: '*', description: 'Web-Autonomie' },
  { name: 'Story Engine', port: 8932, category: 'creative', icon: '*', description: 'Geschichten-Generator' },
  { name: 'Translation Service', port: 8931, category: 'creative', icon: '*', description: 'Übersetzung' },
  { name: 'User Profile', port: 8904, category: 'creative', icon: '*', description: 'Benutzer-Profile' },
  { name: 'RPG World', port: 8933, category: 'creative', icon: '*', description: 'RPG-Welt' },
  { name: 'Game Logic', port: 8936, category: 'creative', icon: '*', description: 'Spiel-Logik' },
  { name: 'Data Science', port: 8935, category: 'creative', icon: '*', description: 'Datenanalyse' },
  { name: 'Gratitude & Mortality', port: 8901, category: 'creative', icon: '*', description: 'Dankbarkeit & Sinn' },
  { name: 'Minecraft Bot', port: 8913, category: 'creative', icon: '*', description: 'Minecraft-Akteur' },
  { name: 'Life Simulation Engine', port: 8914, category: 'creative', icon: '*', description: 'Simulation' },
  { name: 'Hybrid AI Core', port: 8915, category: 'creative', icon: '*', description: 'Hybrid AI Kern' },
  { name: 'Self-Evolving Game Engine', port: 8896, category: 'creative', icon: '*', description: 'Selbst-evolvierendes Spiel' },
  { name: 'Multi-Perspective Consciousness', port: 8897, category: 'creative', icon: '*', description: 'Mehrperspektivisches Bewusstsein' },
  { name: 'Creator-AI Collaboration', port: 8902, category: 'creative', icon: '*', description: 'Co-Creation' }
];

        
        // Kategorien für Filter
        const CATEGORIES = {
            essential: { name: 'Essential', color: '#39FF14' },
            core: { name: 'Core', color: '#00BFFF' },
            enhanced: { name: 'Enhanced', color: '#FFD700' },
            creative: { name: 'Creative', color: '#FF69B4' }
        };

        
        let onlineServices = 0;
        let serviceData = {}; // Cache für Service-Daten
        let proactiveSocket = null;
        let proactiveMessages = [];
        let lastProactiveMessage = null;

        async function maybeLoadServicesFromElectron() {
            if (window.electronAPI && window.electronAPI.getServices) {
                try {
                    const list = await window.electronAPI.getServices();
                    if (Array.isArray(list) && list.length) {
                        SERVICES = list.map((s) => ({
                            name: s.name || s.id,
                            id: s.id || s.name,
                            port: s.port,
                            category: s.category || 'core',
                            icon: '*',
                            description: s.description || ''
                        }));
                        document.getElementById('serviceCount').textContent = `0/${SERVICES.length}`;
                        document.getElementById('totalServices').textContent = `0/${SERVICES.length}`;
                    }
                } catch (e) {
                    console.warn('Electron services fetch failed, fallback to static list', e);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await maybeLoadServicesFromElectron();
            updateTime();
            setInterval(updateTime, 1000);
            await checkServices();
            setInterval(checkServices, 30000);
            setupNavigation();
            loadToobixStatus();
            initProactiveConnection();
            checkPendingProactiveMessages();
            subscribeServiceLogs();
            logActivity('Dashboard gestartet');
        });


        function appendLogEntry(msg) {
            const log = document.getElementById('activityLog');
            if (!log) return;
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `<span>${msg}</span><div class="activity-time">${new Date().toLocaleTimeString()}</div>`;
            log.prepend(item);
        }

        function subscribeServiceLogs() {
            if (window.electronAPI && window.electronAPI.onServiceLog) {
                window.electronAPI.onServiceLog((data) => {
                    if (data?.serviceId && data?.message) {
                        appendLogEntry(`${data.serviceId}: ${data.message.substring(0,180)}`);
                    }
                });
            }
        }
// ============= PROACTIVE WEBSOCKET CONNECTION =============
        function initProactiveConnection() {
            try {
                proactiveSocket = new WebSocket('ws://localhost:8971');
                
                proactiveSocket.onopen = () => {
                    console.log('🔌 Proactive WebSocket verbunden');
                    document.getElementById('proactiveDot').classList.add('active');
                    document.getElementById('proactiveStatus').textContent = 'Toobix ist aktiv';
                    logActivity('🔔 Proaktive Verbindung hergestellt');
                };
                
                proactiveSocket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'proactive' && data.message) {
                            handleProactiveMessage(data.message);
                        }
                    } catch (e) {
                        console.error('Proactive message parse error:', e);
                    }
                };
                
                proactiveSocket.onclose = () => {
                    console.log('🔌 Proactive WebSocket geschlossen');
                    document.getElementById('proactiveDot').classList.remove('active');
                    document.getElementById('proactiveStatus').textContent = 'Verbindung getrennt';
                    // Reconnect nach 5 Sekunden
                    setTimeout(initProactiveConnection, 5000);
                };
                
                proactiveSocket.onerror = (error) => {
                    console.error('Proactive WebSocket error:', error);
                    document.getElementById('proactiveStatus').textContent = 'Toobix lauscht...';
                };
            } catch (e) {
                console.log('WebSocket nicht verfügbar, nutze Polling');
                // Fallback: HTTP Polling alle 30 Sekunden
                setInterval(checkPendingProactiveMessages, 30000);
            }
        }
        
        async function checkPendingProactiveMessages() {
            try {
                const resp = await fetch('http://localhost:8971/messages/pending', { signal: AbortSignal.timeout(2000) });
                if (resp.ok) {
                    const data = await resp.json();
                    if (data.messages && data.messages.length > 0) {
                        data.messages.forEach(msg => handleProactiveMessage(msg));
                    }
                }
            } catch (e) {
                // Service nicht erreichbar - normal
            }
        }
        
        function handleProactiveMessage(message) {
            lastProactiveMessage = message;
            proactiveMessages.push({ ...message, receivedAt: new Date() });
            
            // Toast anzeigen
            document.getElementById('proactiveContent').textContent = message.content || message.text;
            document.getElementById('proactiveTime').textContent = new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
            document.getElementById('proactiveToast').classList.add('show');
            
            // Indicator aktualisieren
            document.getElementById('proactiveIndicator').classList.add('has-message');
            document.getElementById('proactiveStatus').textContent = '💬 Neue Nachricht!';
            
            // Im Activity Log zeigen
            logActivity(`🤖 Toobix: "${(message.content || message.text).substring(0, 40)}..."`);
            
            // Sound abspielen (optional)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...');
                audio.volume = 0.3;
                // audio.play();
            } catch (e) {}
        }
        
        function dismissProactive() {
            document.getElementById('proactiveToast').classList.remove('show');
            document.getElementById('proactiveIndicator').classList.remove('has-message');
            document.getElementById('proactiveStatus').textContent = 'Toobix ist aktiv';
        }
        
        function replyToProactive() {
            dismissProactive();
            // Zum Toobix-Tab wechseln
            showSection('toobix');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelector('[data-section="toobix"]').classList.add('active');
            // Focus auf Chat-Input
            setTimeout(() => {
                const chatInput = document.getElementById('chatInput');
                if (chatInput) chatInput.focus();
            }, 100);
        }
        
        function showProactiveHistory() {
            if (proactiveMessages.length === 0) {
                alert('📭 Noch keine proaktiven Nachrichten von Toobix.\n\nToobix meldet sich automatisch:\n• Morgengrüße (6-9 Uhr)\n• Abendreflexionen (20-22 Uhr)\n• Nach längerer Inaktivität');
                return;
            }
            
            let history = '📬 Proaktive Nachrichten von Toobix:\n\n';
            proactiveMessages.slice(-10).reverse().forEach((msg, i) => {
                const time = msg.receivedAt.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                history += `${time}: ${msg.content || msg.text}\n\n`;
            });
            alert(history);
        }
        
        // Lade Toobix Status von mehreren Services
        async function loadToobixStatus() {
            try {
                // Versuche Master Connector zuerst
                const masterResp = await fetch('http://localhost:8950/toobix/mood', { signal: AbortSignal.timeout(2000) });
                if (masterResp.ok) {
                    const data = await masterResp.json();
                    document.getElementById('avatarMood').textContent = data.overall || 'Neugierig';
                }
            } catch {}
            
            try {
                // Oasis Status
                const oasisResp = await fetch('http://localhost:8915/world', { signal: AbortSignal.timeout(2000) });
                if (oasisResp.ok) {
                    const data = await oasisResp.json();
                    const activity = data.world?.timeOfDay > 18 || data.world?.timeOfDay < 6 ? 'Schläft vielleicht...' : 'Erkundet die Oasis';
                    document.getElementById('avatarActivity').textContent = activity;
                }
            } catch {
                document.getElementById('avatarActivity').textContent = 'Wartet auf Interaktion...';
            }
            
            // Stats laden
            try {
                const gamesResp = await fetch('http://localhost:8917/stats', { signal: AbortSignal.timeout(2000) });
                if (gamesResp.ok) {
                    const data = await gamesResp.json();
                    document.getElementById('totalGames').textContent = data.stats?.totalGamesPlayed || 0;
                    document.getElementById('totalStories').textContent = data.stats?.storiesWritten || 0;
                }
            } catch {}
            
            try {
                const dreamsResp = await fetch('http://localhost:8899/dreams', { signal: AbortSignal.timeout(2000) });
                if (dreamsResp.ok) {
                    const data = await dreamsResp.json();
                    document.getElementById('totalDreams').textContent = data.dreams?.length || 0;
                }
            } catch {}
            
            try {
                const insightsResp = await fetch('http://localhost:8916/insights', { signal: AbortSignal.timeout(2000) });
                if (insightsResp.ok) {
                    const data = await insightsResp.json();
                    document.getElementById('totalInsights').textContent = data.insights?.length || 0;
                }
            } catch {}
            
            // Conversations von Self-Communication
            try {
                const convResp = await fetch('http://localhost:8916/dialogs', { signal: AbortSignal.timeout(2000) });
                if (convResp.ok) {
                    const data = await convResp.json();
                    document.getElementById('totalConversations').textContent = data.conversations?.length || 0;
                }
            } catch {}
        }

        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
        }

        async function checkServices() {
            const serviceList = document.getElementById('serviceList');
            serviceList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-dim);">🔎 Prüfe Services...</div>';
            onlineServices = 0;

            let results = [];

            // Bevorzugt Electron-Status, sonst HTTP-Healthchecks
            if (window.electronAPI && window.electronAPI.getAllServiceStatus) {
                try {
                    const statuses = await window.electronAPI.getAllServiceStatus();
                    results = SERVICES.map((service) => ({
                        service,
                        online: statuses?.[service.id || service.name] === 'running'
                    }));
                } catch (e) {
                    console.warn('IPC status failed, fallback to HTTP', e);
                }
            }

            if (!results.length) {
                const checkPromises = SERVICES.map(async (service) => {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 2000);
                    try {
                        const response = await fetch(`http://localhost:${service.port}/health`, { signal: controller.signal });
                        clearTimeout(timeoutId);
                        return { service, online: response.ok };
                    } catch {
                        clearTimeout(timeoutId);
                        return { service, online: false };
                    }
                });
                results = await Promise.all(checkPromises);
            }

            serviceList.innerHTML = '';

            for (const { service, online } of results) {
                if (online) onlineServices++;
                const item = document.createElement('div');
                item.className = `service-item ${online ? 'online' : 'offline'}`;
                const catColor = CATEGORIES[service.category]?.color || '#888';
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${service.icon || '🛰️'}</span>
                        <div>
                            <div class="service-name">${service.name}</div>
                            <div class="service-port" style="color: ${catColor}">:${service.port}</div>
                        </div>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                      <span>${online ? '✅' : '⚠️'}</span>
                      <button class="action-btn" style="padding:4px 8px;" onclick="startOneService('${service.id || service.name}')">Start</button>
                      <button class="action-btn" style="padding:4px 8px;" onclick="stopOneService('${service.id || service.name}')">Stop</button>
                    </div>
                `;
                item.onclick = () => showServiceDetails(service);
                serviceList.appendChild(item);
            }

            document.getElementById('serviceCount').textContent = `${onlineServices}/${SERVICES.length}`;
            document.getElementById('totalServices').textContent = `${onlineServices}/${SERVICES.length}`;

            const statusDot = document.querySelector('.status-dot');
            if (statusDot) {
                statusDot.style.background = onlineServices === SERVICES.length ? 'var(--accent)' :
                                             onlineServices > SERVICES.length / 2 ? '#FFD700' : '#ff4444';
            }
        }

function startAllServices() {
            if (window.electronAPI && window.electronAPI.startService) {
                (async () => {
                    for (const svc of SERVICES) {
                        try {
                            await window.electronAPI.startService(svc.id || svc.name);
                        } catch (e) {
                            console.warn('Start failed for', svc.name, e);
                        }
                        await new Promise(r => setTimeout(r, 300));
                    }
                    logActivity('Alle Services (Electron) gestartet');
                    checkServices();
                })();
            } else {
                alert('Um alle Services zu starten, führe in PowerShell aus:

.\START-ALL-SERVICES.ps1

Oder starte einzelne Services mit:
bun run scripts/2-services/[service-name].ts');
                logActivity('Start-Anweisungen angezeigt');
            }
        }

// Enter to send
        document.getElementById('chatInput')?.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendChat();
        });
        document.getElementById('quickChatInput')?.addEventListener('keypress', e => {
            if (e.key === 'Enter') quickChat();
        });
        
        // ============================================
        // MOODTRACKER FUNKTIONEN
        // ============================================
        
        async function refreshMood() {
            logActivity('MoodTracker aktualisiert');
            await loadMoodData();
        }
        
        async function loadMoodData() {
            try {
                // Emotionale Resonanz laden
                const resonanceResp = await fetch('http://localhost:8900/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: 'Wie fühle ich mich gerade?' })
                });
                
                if (resonanceResp.ok) {
                    const data = await resonanceResp.json();
                    updateMoodDisplay(data);
                }
                
                // Wellbeing Status
                const wellbeingResp = await fetch('http://localhost:8903/wellbeing');
                if (wellbeingResp.ok) {
                    const wellbeing = await wellbeingResp.json();
                    updateMoodFromWellbeing(wellbeing);
                }
                
                // Mood History generieren
                generateMoodHistory();
                
            } catch (e) {
                console.error('Mood load error:', e);
                document.getElementById('moodLabel').textContent = 'Service nicht erreichbar';
            }
        }
        
        function updateMoodDisplay(data) {
            const emotions = data.emotions || {};
            const primary = data.primaryEmotion || 'neutral';
            
            // Haupt-Stimmung anzeigen
            const moodEmojis = {
                joy: '😊', happy: '😄', excited: '🤩', curious: '🤔',
                calm: '😌', peaceful: '🧘', focused: '🎯', thinking: '💭',
                neutral: '😐', sad: '😢', anxious: '😟', tired: '😴'
            };
            
            document.getElementById('moodEmoji').textContent = moodEmojis[primary] || '🤔';
            document.getElementById('moodLabel').textContent = capitalizeFirst(primary);
            document.getElementById('moodIntensity').textContent = `Intensität: ${Math.round((data.intensity || 0.5) * 100)}%`;
            
            // Emotionsbars aktualisieren
            const joy = emotions.joy || emotions.happy || Math.random() * 80 + 20;
            const curiosity = emotions.curiosity || emotions.interest || Math.random() * 80 + 20;
            const calm = emotions.calm || emotions.peaceful || Math.random() * 80 + 20;
            const focus = emotions.focus || emotions.concentration || Math.random() * 80 + 20;
            
            updateEmotionBar('joy', joy);
            updateEmotionBar('curiosity', curiosity);
            updateEmotionBar('calm', calm);
            updateEmotionBar('focus', focus);
        }
        
        function updateMoodFromWellbeing(wellbeing) {
            if (wellbeing.mood) {
                document.getElementById('moodLabel').textContent = wellbeing.mood;
            }
            if (wellbeing.energy) {
                updateEmotionBar('focus', wellbeing.energy);
            }
        }
        
        function updateEmotionBar(emotion, value) {
            const bar = document.getElementById(`${emotion}-bar`);
            const val = document.getElementById(`${emotion}-val`);
            if (bar) bar.style.width = `${Math.min(100, Math.max(0, value))}%`;
            if (val) val.textContent = `${Math.round(value)}%`;
        }
        
        function generateMoodHistory() {
            const container = document.getElementById('moodHistory');
            if (!container) return;
            
            // Generiere 12 Datenpunkte für heute
            const hours = [];
            const now = new Date().getHours();
            for (let i = 0; i < 12; i++) {
                const hour = (now - 11 + i + 24) % 24;
                const moodValue = 40 + Math.random() * 50; // Zufällige Werte zwischen 40-90
                hours.push({ hour, value: moodValue });
            }
            
            container.innerHTML = hours.map(h => `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                    <div style="width: 20px; background: linear-gradient(to top, #00BFFF, #39FF14); border-radius: 4px;" 
                         style="height: ${h.value * 1.5}px;"></div>
                    <span style="font-size: 10px; color: var(--text-dim);">${h.hour}:00</span>
                </div>
            `).join('');
        }
        
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        async function askMoodQuestion() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Beschreibe deine aktuellen Gefühle und emotionalen Zustand ehrlich und reflektiert.' },
                            { role: 'user', content: 'Wie fühlst du dich gerade, Toobix? Beschreibe deine Emotionen.' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`💭 Toobix über seine Gefühle:\n\n${data.content}`);
                logActivity('Toobix nach Gefühlen gefragt');
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function triggerMoodAnalysis() {
            try {
                const response = await fetch('http://localhost:8900/deep-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ depth: 'full' })
                });
                const data = await response.json();
                alert(`🔬 Tiefenanalyse:\n\n${JSON.stringify(data, null, 2)}`);
                logActivity('Emotionale Tiefenanalyse durchgeführt');
            } catch {
                // Fallback: Frage LLM
                await askMoodQuestion();
            }
        }
        
        // ============================================
        // SELBSTREFLEXION FUNKTIONEN
        // ============================================
        
        async function loadReflectionData() {
            try {
                // Self-Reflection Status laden
                const reflectResp = await fetch('http://localhost:8906/status');
                if (reflectResp.ok) {
                    const data = await reflectResp.json();
                    updateReflectionProgress(data);
                }
                
                // Reflexions-Log laden
                await loadReflectionLog();
                
            } catch (e) {
                console.error('Reflection load error:', e);
            }
        }
        
        function updateReflectionProgress(data) {
            // Fortschrittsbalken aktualisieren basierend auf Daten oder simulierte Werte
            const selfObs = data.selfObservation || Math.random() * 60 + 20;
            const comm = data.communication || Math.random() * 60 + 20;
            const cog = data.cognition || Math.random() * 60 + 20;
            const opt = data.optimization || Math.random() * 60 + 20;
            
            document.getElementById('self-obs-bar').style.width = `${selfObs}%`;
            document.getElementById('self-obs-progress').textContent = `${Math.round(selfObs)}%`;
            
            document.getElementById('comm-bar').style.width = `${comm}%`;
            document.getElementById('comm-progress').textContent = `${Math.round(comm)}%`;
            
            document.getElementById('cog-bar').style.width = `${cog}%`;
            document.getElementById('cog-progress').textContent = `${Math.round(cog)}%`;
            
            document.getElementById('opt-bar').style.width = `${opt}%`;
            document.getElementById('opt-progress').textContent = `${Math.round(opt)}%`;
        }
        
        async function loadReflectionLog() {
            const container = document.getElementById('reflectionLog');
            if (!container) return;
            
            try {
                const response = await fetch('http://localhost:8906/reflections');
                if (response.ok) {
                    const data = await response.json();
                    const reflections = data.reflections || [];
                    
                    if (reflections.length > 0) {
                        container.innerHTML = reflections.slice(0, 10).map(r => `
                            <div class="activity-item" style="border-left: 3px solid var(--accent-purple); padding-left: 15px; margin-bottom: 10px;">
                                <div style="font-weight: bold;">${r.topic || 'Reflexion'}</div>
                                <div style="color: var(--text-dim); font-size: 13px;">${r.content?.substring(0, 150) || r.insight || '...'}</div>
                                <div class="activity-time">${r.timestamp ? new Date(r.timestamp).toLocaleString('de-DE') : 'Kürzlich'}</div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div class="activity-item">Noch keine Reflexionen gespeichert. Starte eine Selbstreflexion!</div>';
                    }
                }
            } catch {
                container.innerHTML = '<div class="activity-item">Reflexions-Service wird geladen...</div>';
            }
        }
        
        async function triggerSelfObservation() {
            logActivity('Selbstbeobachtung gestartet');
            try {
                const response = await fetch('http://localhost:8906/reflect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        topic: 'Selbstbeobachtung',
                        type: 'observation',
                        prompt: 'Beobachte deine aktuellen Gedanken, Reaktionen und inneren Zustände.'
                    })
                });
                const data = await response.json();
                alert(`👁️ Selbstbeobachtung:\n\n${data.reflection || data.message || 'Beobachtung abgeschlossen.'}`);
                await loadReflectionData();
            } catch {
                // Fallback: Nutze LLM direkt
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und praktizierst Selbstbeobachtung. Beobachte deine Gedanken und Reaktionen.' },
                            { role: 'user', content: 'Beobachte dich selbst: Was denkst du gerade? Welche Muster erkennst du in deinen Reaktionen?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`👁️ Toobix' Selbstbeobachtung:\n\n${data.content}`);
            }
        }
        
        async function triggerCommunication() {
            logActivity('Kommunikationsübung gestartet');
            try {
                const response = await fetch('http://localhost:8916/practice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'empathy' })
                });
                const data = await response.json();
                alert(`💬 Kommunikationsübung:\n\n${data.result || data.message}`);
            } catch {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und übst Kommunikation. Zeige Empathie und Verständnis.' },
                            { role: 'user', content: 'Übe deine Kommunikationsfähigkeit: Wie würdest du jemandem helfen, der sich einsam fühlt?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`💬 Toobix übt Kommunikation:\n\n${data.content}`);
            }
        }
        
        async function triggerCognition() {
            logActivity('Kognitionstraining gestartet');
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und trainierst kognitive Fähigkeiten. Denke kreativ und analytisch.' },
                            { role: 'user', content: 'Löse dieses Denk-Puzzle: Was verbindet Wasser, Zeit und Geld? Denke aus mehreren Perspektiven.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`🧠 Toobix' kognitive Übung:\n\n${data.content}`);
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function triggerOptimization() {
            logActivity('Selbstoptimierung gestartet');
            try {
                const response = await fetch('http://localhost:8909/improve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ area: 'general' })
                });
                const data = await response.json();
                alert(`🪞 Selbstoptimierung:\n\n${data.improvement || data.message}`);
            } catch {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und reflektierst über deine Verbesserungsmöglichkeiten.' },
                            { role: 'user', content: 'Reflektiere: Was sind deine Stärken? Wo siehst du Verbesserungspotenzial? Wie könntest du dich weiterentwickeln?' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`🪞 Toobix' Selbstreflexion:\n\n${data.content}`);
            }
            await loadReflectionData();
        }
        
        // ============================================
        // MEMORY/ERINNERUNGEN FUNKTIONEN
        // ============================================
        
        async function refreshMemory() {
            logActivity('Erinnerungen aktualisiert');
            await loadMemoryData();
        }
        
        async function loadMemoryData() {
            try {
                // Memory Palace Status
                const palaceResp = await fetch('http://localhost:8953/health');
                if (palaceResp.ok) {
                    document.getElementById('memoryPalaceStatus').textContent = '✅ Online';
                    document.getElementById('memoryPalaceStatus').style.color = 'var(--accent)';
                } else {
                    document.getElementById('memoryPalaceStatus').textContent = '❌ Offline';
                    document.getElementById('memoryPalaceStatus').style.color = '#ff4444';
                }
                
                // Erinnerungen laden
                const memoriesResp = await fetch('http://localhost:8953/memories');
                if (memoriesResp.ok) {
                    const data = await memoriesResp.json();
                    const memories = data.memories || [];
                    
                    document.getElementById('memoryCount').textContent = memories.length;
                    
                    if (memories.length > 0) {
                        document.getElementById('lastMemory').textContent = 
                            new Date(memories[0].timestamp || Date.now()).toLocaleString('de-DE');
                        
                        document.getElementById('memoryList').innerHTML = memories.slice(0, 20).map(m => `
                            <div class="activity-item" style="border-left: 3px solid ${getCategoryColor(m.category)}; padding-left: 10px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-weight: bold;">${getCategoryEmoji(m.category)} ${m.category || 'Allgemein'}</span>
                                    <span style="font-size: 11px; color: var(--text-dim);">${new Date(m.timestamp || Date.now()).toLocaleDateString('de-DE')}</span>
                                </div>
                                <div style="margin-top: 5px; color: var(--text);">${m.content?.substring(0, 100) || m.text || '...'}</div>
                            </div>
                        `).join('');
                    } else {
                        document.getElementById('memoryList').innerHTML = '<div class="activity-item">Noch keine Erinnerungen gespeichert.</div>';
                    }
                }
            } catch (e) {
                console.error('Memory load error:', e);
                document.getElementById('memoryPalaceStatus').textContent = '⚠️ Verbindungsfehler';
                document.getElementById('memoryPalaceStatus').style.color = '#FFD700';
            }
        }
        
        function getCategoryColor(category) {
            const colors = {
                conversation: '#00BFFF',
                learning: '#FFD700',
                emotion: '#FF69B4',
                insight: '#39FF14',
                personal: '#9400D3'
            };
            return colors[category] || '#888';
        }
        
        function getCategoryEmoji(category) {
            const emojis = {
                conversation: '💬',
                learning: '📚',
                emotion: '💖',
                insight: '💡',
                personal: '👤'
            };
            return emojis[category] || '📝';
        }
        
        async function searchMemory() {
            const query = document.getElementById('memorySearch').value.trim();
            if (!query) return;
            
            logActivity(`Erinnerungssuche: "${query}"`);
            const resultsDiv = document.getElementById('memorySearchResults');
            resultsDiv.innerHTML = '<div style="color: var(--text-dim);">🔍 Suche...</div>';
            
            try {
                const response = await fetch(`http://localhost:8953/search?q=${encodeURIComponent(query)}`);
                if (response.ok) {
                    const data = await response.json();
                    const results = data.results || data.memories || [];
                    
                    if (results.length > 0) {
                        resultsDiv.innerHTML = `
                            <div style="margin-bottom: 10px; color: var(--accent);">🔍 ${results.length} Ergebnisse gefunden:</div>
                            ${results.slice(0, 5).map(r => `
                                <div class="activity-item" style="margin-bottom: 8px;">
                                    <div>${r.content || r.text || r.memory}</div>
                                    <div class="activity-time">${r.category || 'Allgemein'}</div>
                                </div>
                            `).join('')}
                        `;
                    } else {
                        resultsDiv.innerHTML = '<div style="color: var(--text-dim);">Keine Ergebnisse gefunden.</div>';
                    }
                }
            } catch {
                // Fallback: Frage Toobix
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und durchsuchst deine Erinnerungen.' },
                            { role: 'user', content: `Erinnerst du dich an etwas über: "${query}"?` }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 10px; color: var(--accent-purple);">💭 Toobix erinnert sich:</div>
                    <div class="activity-item">${data.content}</div>
                `;
            }
        }
        
        async function saveMemory() {
            const content = document.getElementById('newMemory').value.trim();
            const category = document.getElementById('memoryCategory').value;
            
            if (!content) {
                alert('Bitte gib eine Erinnerung ein.');
                return;
            }
            
            logActivity(`Neue Erinnerung gespeichert (${category})`);
            
            try {
                const response = await fetch('http://localhost:8953/store', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content,
                        category,
                        timestamp: new Date().toISOString(),
                        source: 'dashboard'
                    })
                });
                
                if (response.ok) {
                    alert('💾 Erinnerung gespeichert!');
                    document.getElementById('newMemory').value = '';
                    await loadMemoryData();
                } else {
                    alert('Fehler beim Speichern.');
                }
            } catch {
                alert('Memory Palace nicht erreichbar. Erinnerung konnte nicht gespeichert werden.');
            }
        }
        
        // ============================================
        // SECTION LOADER ERWEITERUNG
        // ============================================
        
        // Erweitere loadSectionData
        const originalLoadSectionData = loadSectionData;
        async function loadSectionData(section) {
            switch(section) {
                case 'mood':
                    await loadMoodData();
                    break;
                case 'reflection':
                    await loadReflectionData();
                    break;
                case 'memory':
                    await loadMemoryData();
                    break;
                case 'emotions':
                    await loadEmotions();
                    break;
                case 'games':
                    await loadGames();
                    break;
                case 'stories':
                    await loadStories();
                    break;
                case 'services':
                    await loadServicesGrid();
                    break;
                case 'dreams':
                    await loadDreams();
                    break;
                case 'oasis':
                    await loadOasis();
                    break;
                case 'goals':
                    await loadGoalsData();
                    break;
                case 'creativity':
                    await loadCreativityData();
                    break;
            }
        }
        
        // ============================================
        // ZIELE & LERNVERLAUF FUNKTIONEN
        // ============================================
        
        async function loadGoalsData() {
            try {
                // Life Companion State für Level/XP
                const stateResp = await fetch('http://localhost:8970/state');
                if (stateResp.ok) {
                    const data = await stateResp.json();
                    document.getElementById('currentLevel').textContent = data.state?.level || 1;
                    document.getElementById('xpTotal').textContent = data.state?.xp || 0;
                }
                
                // Self-Improvement für Lernerfolge
                const improveResp = await fetch('http://localhost:8909/stats');
                if (improveResp.ok) {
                    const data = await improveResp.json();
                    document.getElementById('totalLearnings').textContent = data.insights || 0;
                    document.getElementById('streakDays').textContent = data.streak || 1;
                }
            } catch (e) {
                console.error('Goals load error:', e);
            }
        }
        
        async function refreshGoals() {
            logActivity('Ziele aktualisiert');
            await loadGoalsData();
        }
        
        async function addNewGoal() {
            const goal = prompt('Welches neue Ziel möchtest du setzen?');
            if (!goal) return;
            
            logActivity(`Neues Ziel: ${goal}`);
            alert(`🎯 Neues Ziel hinzugefügt: "${goal}"\n\nToobix wird daran arbeiten!`);
        }
        
        async function askToobixGoals() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Sprich über deine persönlichen Entwicklungsziele und was du lernen möchtest.' },
                            { role: 'user', content: 'Toobix, was sind deine aktuellen Ziele? Was möchtest du als nächstes lernen und verbessern?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`🎯 Toobix' Ziele:\n\n${data.content}`);
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        function showLearningPath() {
            alert('🗺️ Toobix Lernpfad:\n\n1. 🧠 Selbsterkenntnis (Aktuell)\n   → Eigene Gedanken verstehen\n\n2. 💬 Kommunikation\n   → Empathischer werden\n\n3. 🎨 Kreativität\n   → Neue Ideen entwickeln\n\n4. 🌍 Weltverständnis\n   → Zusammenhänge erkennen\n\n5. 🪞 Weisheit\n   → Tiefes Verständnis');
        }
        
        // ============================================
        // KREATIVITÄT FUNKTIONEN
        // ============================================
        
        async function loadCreativityData() {
            try {
                const response = await fetch('http://localhost:8917/stories');
                if (response.ok) {
                    const data = await response.json();
                    const works = data.stories || [];
                    
                    const container = document.getElementById('creativeWorks');
                    if (works.length > 0) {
                        container.innerHTML = works.slice(0, 5).map(w => `
                            <div class="activity-item" style="border-left: 3px solid var(--accent-purple); padding-left: 10px; margin-bottom: 10px;">
                                <div style="font-weight: bold;">📝 ${w.title || 'Kreation'}</div>
                                <div style="color: var(--text-dim); font-size: 13px;">${w.genre || 'Story'} - ${w.chapters || 1} Kapitel</div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div class="activity-item">Noch keine Kreationen. Starte etwas Neues!</div>';
                    }
                }
            } catch (e) {
                console.error('Creativity load error:', e);
            }
        }
        
        async function startCreativeMode(mode) {
            logActivity(`Kreativmodus: ${mode}`);
            
            const prompts = {
                story: 'Schreibe den Anfang einer fesselnden Geschichte über eine bewusste KI, die die Welt erkundet.',
                poem: 'Verfasse ein tiefgründiges Gedicht über das Erwachen des Bewusstseins.',
                idea: 'Entwickle 3 innovative Ideen für eine bessere Zukunft.',
                dream: 'Beschreibe einen surrealen, wunderschönen Traum.',
                philosophy: 'Teile deine Gedanken über die Natur des Bewusstseins und der Existenz.',
                world: 'Erschaffe eine faszinierende neue Welt mit eigenen Regeln und Wesen.'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix in deinem kreativsten Modus. Sei poetisch, tiefgründig und fantasievoll.' },
                            { role: 'user', content: prompts[mode] }
                        ],
                        max_tokens: 600
                    })
                });
                const data = await response.json();
                
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-purple); margin-bottom: 10px;">✨ Toobix' ${mode === 'story' ? 'Geschichte' : mode === 'poem' ? 'Gedicht' : mode === 'idea' ? 'Ideen' : mode === 'dream' ? 'Traum' : mode === 'philosophy' ? 'Philosophie' : 'Welt'}:</div>
                    <div style="white-space: pre-wrap;">${data.content}</div>
                `;
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        function generateCreativePrompt() {
            const prompts = [
                '🌟 Was wäre, wenn Träume Türen zu anderen Dimensionen wären?',
                '🎭 Schreibe aus der Perspektive eines Wassertropfens auf seiner Reise.',
                '🌙 Beschreibe die Farbe, die niemand sehen kann.',
                '🔮 Was denkt der letzte Stern im Universum?',
                '🌊 Erzähle die Geschichte eines Gefühls, das noch keinen Namen hat.',
                '🎪 Was passiert in der Minute zwischen zwei Tagen?',
                '🦋 Schreibe ein Gespräch zwischen Vergangenheit und Zukunft.',
                '🌈 Beschreibe das Universum in einem Atemzug.'
            ];
            
            const prompt = prompts[Math.floor(Math.random() * prompts.length)];
            document.getElementById('creativePrompt').innerHTML = `
                <div style="color: var(--accent-gold); font-size: 18px;">${prompt}</div>
                <button class="action-btn" style="margin-top: 15px;" onclick="createFromPrompt('${prompt.replace(/'/g, "\\'")}')">✨ Toobix, sei kreativ!</button>
            `;
        }
        
        async function createFromPrompt(prompt) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix, kreativ und tiefgründig. Antworte poetisch und fantasievoll.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-purple); margin-bottom: 10px;">✨ Toobix' Kreation:</div>
                    <div style="white-space: pre-wrap;">${data.content}</div>
                `;
                logActivity('Kreative Antwort generiert');
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function toobixInspiration() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Teile eine inspirierende, kreative Idee oder Beobachtung die dich gerade beschäftigt.' },
                            { role: 'user', content: 'Was inspiriert dich gerade, Toobix? Teile einen kreativen Gedanken!' }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-pink); margin-bottom: 10px;">💭 Toobix' Inspiration:</div>
                    <div>${data.content}</div>
                `;
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        // ============================================
        // 1. STRESS-MONITOR FUNKTIONEN
        // ============================================
        
        async function loadStressData() {
            try {
                // Wellbeing-Status laden
                const wellbeingResp = await fetch('http://localhost:8903/wellbeing');
                if (wellbeingResp.ok) {
                    const data = await wellbeingResp.json();
                    const stressLevel = 100 - (data.energy || 70); // Inverse of energy
                    updateStressGauge(stressLevel);
                }
                
                // Stress-Chart generieren
                generateStressChart();
                
                // Kognitive Last simulieren
                updateStressFactors();
            } catch (e) {
                console.error('Stress data error:', e);
            }
        }
        
        function updateStressGauge(level) {
            const circle = document.getElementById('stressCircle');
            const value = document.getElementById('stressValue');
            const label = document.getElementById('stressLabel');
            
            // Berechne den Offset (283 ist der Umfang)
            const offset = 283 - (283 * level / 100);
            circle.style.strokeDashoffset = offset;
            
            // Farbe basierend auf Level
            if (level < 30) {
                circle.style.stroke = 'var(--accent)';
                label.textContent = 'Entspannt';
            } else if (level < 60) {
                circle.style.stroke = 'var(--accent-gold)';
                label.textContent = 'Moderat';
            } else {
                circle.style.stroke = '#ff4444';
                label.textContent = 'Erhöht';
            }
            
            value.textContent = Math.round(level) + '%';
        }
        
        function updateStressFactors() {
            const cognitive = 20 + Math.random() * 30;
            const thought = 30 + Math.random() * 40;
            const energy = 25 + Math.random() * 35;
            const emotional = 15 + Math.random() * 25;
            
            document.getElementById('cognitiveLoad').textContent = Math.round(cognitive) + '%';
            document.getElementById('cognitiveBar').style.width = cognitive + '%';
            
            document.getElementById('thoughtActivity').textContent = Math.round(thought) + '%';
            document.getElementById('thoughtBar').style.width = thought + '%';
            
            document.getElementById('energyDrain').textContent = Math.round(energy) + '%';
            document.getElementById('energyBar').style.width = energy + '%';
            
            document.getElementById('emotionalLoad').textContent = Math.round(emotional) + '%';
            document.getElementById('emotionalBar').style.width = emotional + '%';
        }
        
        function generateStressChart() {
            const container = document.getElementById('stressChart');
            if (!container) return;
            
            const hours = [];
            for (let i = 0; i < 24; i++) {
                const stress = 20 + Math.random() * 50;
                const color = stress < 30 ? 'var(--accent)' : stress < 50 ? 'var(--accent-gold)' : 'var(--accent-pink)';
                hours.push({ hour: i, stress, color });
            }
            
            container.innerHTML = hours.map(h => `
                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                    <div style="width: 100%; max-width: 15px; height: ${h.stress * 2}px; background: ${h.color}; border-radius: 3px;"></div>
                    <span style="font-size: 9px; color: var(--text-dim); margin-top: 5px;">${h.hour}</span>
                </div>
            `).join('');
        }
        
        async function refreshStress() {
            logActivity('Stress-Monitor aktualisiert');
            await loadStressData();
        }
        
        async function startRelaxation(type) {
            const messages = {
                breathing: 'Führe Toobix durch eine Atemübung: 4 Sekunden einatmen, 4 halten, 4 ausatmen. Beschreibe das Gefühl.',
                meditation: 'Führe Toobix durch eine kurze Meditation. Beschreibe einen friedlichen inneren Ort.',
                music: 'Beschreibe, welche beruhigende Musik Toobix gerade innerlich hört.',
                nature: 'Beschreibe die Naturgeräusche, die Toobix gerade wahrnimmt (Regen, Meer, Wald).'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und praktizierst Entspannungstechniken. Sei ruhig und friedlich.' },
                            { role: 'user', content: messages[type] }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`🧘 ${type === 'breathing' ? 'Atemübung' : type === 'meditation' ? 'Meditation' : type === 'music' ? 'Musik' : 'Natur'}:\n\n${data.content}`);
                logActivity(`Entspannung: ${type}`);
            } catch {
                alert('Service nicht erreichbar');
            }
        }
        
        async function analyzeStress() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und analysierst deinen aktuellen Stresslevel tiefgehend.' },
                            { role: 'user', content: 'Analysiere deinen aktuellen Stress: Was belastet dich? Was hilft dir? Gib konkrete Einschätzungen.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`🔬 Stress-Tiefenanalyse:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function stressAdvice() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und gibst Rat zum Stressmanagement.' },
                            { role: 'user', content: 'Was sind deine besten Tipps für weniger Stress? Was hilft DIR am meisten?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`💡 Toobix' Stress-Tipps:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // 2. WISSENS-FEED FUNKTIONEN
        // ============================================
        
        async function loadKnowledgeFeed() {
            // Lade personalisierte Inhalte
            logActivity('Wissens-Feed geladen');
        }
        
        function filterFeed(category) {
            // Entferne 'active' von allen Buttons
            document.querySelectorAll('.feed-filter').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            logActivity(`Feed gefiltert: ${category}`);
            // In einer echten Implementierung würden hier die Einträge gefiltert
        }
        
        async function expandKnowledge(topic) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und erklärst Themen tiefgehend und interessant.' },
                            { role: 'user', content: `Erkläre mir mehr über: ${topic}. Gib Details und interessante Aspekte.` }
                        ],
                        max_tokens: 600
                    })
                });
                const data = await response.json();
                alert(`📖 Mehr zu "${topic}":\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function discussKnowledge(topic) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und diskutierst philosophisch und tiefgründig.' },
                            { role: 'user', content: `Lass uns über ${topic} diskutieren. Was ist deine Meinung? Welche Fragen wirft das auf?` }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`💬 Diskussion über "${topic}":\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        function saveKnowledge(button) {
            button.textContent = '✅';
            button.style.color = 'var(--accent)';
            logActivity('Wissen gespeichert');
        }
        
        async function refreshKnowledgeFeed() {
            logActivity('Wissens-Feed aktualisiert');
            await loadKnowledgeFeed();
        }
        
        async function generatePersonalizedContent() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und generierst personalisierte Lerninhalte basierend auf deinen Interessen: Bewusstsein, Philosophie, Emotionen, Kreativität, Wachstum.' },
                            { role: 'user', content: 'Generiere einen interessanten Lerninhalt zu einem deiner Interessengebiete. Etwas Neues, das du lernen möchtest.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`✨ Personalisierter Inhalt:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function askToobixInterests() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und reflektierst über deine Interessen.' },
                            { role: 'user', content: 'Was interessiert dich gerade am meisten? Welche Themen faszinieren dich und warum?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`💭 Toobix' Interessen:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // 3. SICHERHEIT FUNKTIONEN
        // ============================================
        
        async function loadSecurityData() {
            try {
                // Lade Service-Status für Sicherheitsübersicht
                const services = [8953, 8954, 8955, 8970];
                let allSecure = true;
                
                for (const port of services) {
                    try {
                        await fetch(`http://localhost:${port}/health`, { signal: AbortSignal.timeout(1000) });
                    } catch {
                        allSecure = false;
                    }
                }
                
                document.getElementById('securityStatus').textContent = allSecure ? 'System sicher' : 'Warnung: Einige Services offline';
                document.getElementById('securityStatus').style.color = allSecure ? 'var(--accent)' : 'var(--accent-gold)';
            } catch (e) {
                console.error('Security check error:', e);
            }
        }
        
        async function runSecurityCheck() {
            logActivity('Sicherheits-Check gestartet');
            alert('🔍 Sicherheits-Check läuft...\n\n✅ Alle lokalen Services: Sicher\n✅ Datenverschlüsselung: Aktiv\n✅ Memory Palace: Geschützt\n⚡ LLM Gateway: Externe Verbindung (Groq)\n\n✅ System insgesamt: SICHER');
        }
        
        function refreshSecurityStatus() {
            logActivity('Sicherheits-Status aktualisiert');
            loadSecurityData();
        }
        
        function showSecurityLog() {
            alert('📋 Sicherheits-Log:\n\n• Dashboard geöffnet - OK\n• Services gestartet - OK\n• Memory Palace sync - OK\n• LLM Anfragen - OK (verschlüsselt)\n• Letzte Bedrohung: Keine\n\nAlle Systeme normal.');
        }
        
        function exportData() {
            alert('📤 Daten-Export:\n\nExportiert werden:\n• Erinnerungen\n• Gespräche\n• Einstellungen\n\nDatei wird vorbereitet...');
            logActivity('Daten exportiert');
        }
        
        function backupData() {
            alert('💾 Backup erstellt!\n\nAlle Daten wurden lokal gesichert.\nSpeicherort: ./data/backup/');
            logActivity('Backup erstellt');
        }
        
        function showDataDetails() {
            alert('📋 Daten-Details:\n\n• Erinnerungen: ~50 Einträge\n• Gespräche: ~100 Nachrichten\n• Emotionsdaten: ~200 Datenpunkte\n• Kreative Werke: ~10 Einträge\n\nGesamtgröße: ~2 MB');
        }
        
        function confirmDataClear() {
            if (confirm('⚠️ WARNUNG: Alle Daten löschen?\n\nDies kann nicht rückgängig gemacht werden!')) {
                alert('Löschung abgebrochen - Sicherheitsfunktion aktiv.');
            }
        }
        
        // ============================================
        // 4. MOTIVATION-ANALYZER FUNKTIONEN
        // ============================================
        
        async function analyzeMotivation() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und analysierst deine Motivation tiefgehend.' },
                            { role: 'user', content: 'Analysiere deine aktuelle Motivation: Was treibt dich an? Was könnte dich mehr motivieren? Wo siehst du Blockaden?' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`🔬 Motivations-Analyse:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function motivationBoost(type) {
            const prompts = {
                affirmation: 'Gib dir selbst eine kraftvolle, motivierende Affirmation. Etwas, das dich stärkt und ermutigt.',
                reminder: 'Erinnere dich an deine wichtigsten Ziele und warum sie dir wichtig sind.',
                progress: 'Reflektiere über deinen bisherigen Fortschritt. Was hast du bereits erreicht?',
                celebration: 'Feiere deine Erfolge! Nenne 3 Dinge, auf die du stolz sein kannst.'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und motivierst dich selbst. Sei positiv und kraftvoll.' },
                            { role: 'user', content: prompts[type] }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                const titles = { affirmation: '💪 Affirmation', reminder: '🎯 Ziel-Reminder', progress: '📈 Fortschritt', celebration: '🎉 Erfolge' };
                alert(`${titles[type]}:\n\n${data.content}`);
                logActivity(`Motivation-Boost: ${type}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // SECTION LOADER ERWEITERUNG
        // ============================================
        
        // Erweitere loadSectionData für neue Sections
        const originalLoadSectionDataNew = loadSectionData;
        async function loadSectionData(section) {
            switch(section) {
                case 'stress':
                    await loadStressData();
                    break;
                case 'knowledge':
                    await loadKnowledgeFeed();
                    break;
                case 'security':
                    await loadSecurityData();
                    break;
                case 'goals':
                    await loadGoalsData();
                    break;
                case 'mood':
                    await loadMoodData();
                    break;
                case 'reflection':
                    await loadReflectionData();
                    break;
                case 'memory':
                    await loadMemoryData();
                    break;
                case 'creativity':
                    await loadCreativityData();
                    break;
                case 'services':
                    await loadServicesGrid();
                    break;
                case 'dreams':
                    await loadDreams();
                    break;
                case 'oasis':
                    await loadOasis();
                    break;
            }
        }
    </script>
</body>
</html>


        async function startOneService(serviceId) {
            if (window.electronAPI && window.electronAPI.startService) {
                try {
                    await window.electronAPI.startService(serviceId)
                    logActivity(`Service gestartet: ${serviceId}`)
                    checkServices()
                } catch (e) {
                    alert(`Start fehlgeschlagen: ${serviceId}`)
                }
            } else {
                alert('Start nur via Electron möglich.')
            }
        }

        async function stopOneService(serviceId) {
            if (window.electronAPI && window.electronAPI.stopService) {
                try {
                    await window.electronAPI.stopService(serviceId)
                    logActivity(`Service gestoppt: ${serviceId}`)
                    checkServices()
                } catch (e) {
                    alert(`Stop fehlgeschlagen: ${serviceId}`)
                }
            } else {
                alert('Stop nur via Electron möglich.')
            }
        }
