<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ Toobix Unified Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #12122a;
            --bg-hover: #1a1a3a;
            --accent: #39FF14;
            --accent-blue: #00BFFF;
            --accent-purple: #9400D3;
            --accent-gold: #FFD700;
            --accent-pink: #FF69B4;
            --text: #ffffff;
            --text-dim: #888;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }
        
        /* Emotion Bars */
        .emotion-bar {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        
        .emotion-bar span:first-child {
            width: 100px;
            font-size: 13px;
        }
        
        .emotion-bar span:last-child {
            width: 40px;
            text-align: right;
            font-size: 12px;
            color: var(--text-dim);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-dark));
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(57, 255, 20, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 5px rgba(57, 255, 20, 0.2); }
        }

        .logo h1 {
            font-size: 24px;
            color: var(--accent);
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        /* Proactive Notifications */
        .proactive-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: linear-gradient(135deg, #1a1a3a, #2a1a4a);
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid var(--accent-purple);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .proactive-indicator:hover {
            background: linear-gradient(135deg, #2a2a4a, #3a2a5a);
            transform: scale(1.02);
        }
        
        .proactive-indicator.has-message {
            border-color: var(--accent);
            animation: proactiveGlow 2s infinite;
        }
        
        @keyframes proactiveGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(57, 255, 20, 0.3); }
            50% { box-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        }
        
        .proactive-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-purple);
        }
        
        .proactive-dot.active {
            background: var(--accent);
            animation: blink 1s infinite;
        }
        
        /* Proactive Toast Notification */
        .proactive-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #1a1a3a, #2a1a5a);
            border: 2px solid var(--accent);
            border-radius: 15px;
            padding: 20px;
            max-width: 380px;
            z-index: 10000;
            box-shadow: 0 10px 40px rgba(57, 255, 20, 0.3);
            animation: slideInRight 0.5s ease;
            display: none;
        }
        
        .proactive-toast.show {
            display: block;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .proactive-toast-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .proactive-toast-header img, .proactive-toast-header .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .proactive-toast-header h4 {
            color: var(--accent);
            margin: 0;
        }
        
        .proactive-toast-header small {
            color: var(--text-dim);
        }
        
        .proactive-toast-content {
            color: var(--text);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .proactive-toast-actions {
            display: flex;
            gap: 10px;
        }
        
        .proactive-toast-actions button {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .proactive-toast-actions .btn-reply {
            background: var(--accent);
            color: black;
        }
        
        .proactive-toast-actions .btn-dismiss {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .proactive-toast-actions button:hover {
            transform: scale(1.05);
        }

        /* Navigation */
        .nav {
            display: flex;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: var(--bg-hover);
        }

        .nav-item.active {
            border-bottom-color: var(--accent);
            color: var(--accent);
        }

        /* Main Content */
        .main {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 140px);
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .service-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .service-item:hover {
            background: var(--bg-hover);
            transform: translateX(5px);
        }

        .service-item.online {
            border-left: 3px solid var(--accent);
        }

        .service-item.offline {
            border-left: 3px solid #ff4444;
            opacity: 0.6;
        }

        .service-name {
            font-size: 13px;
            font-weight: 500;
        }

        .service-port {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Center Content */
        .content {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .content h2 {
            color: var(--accent-blue);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 191, 255, 0.1);
        }

        .card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--accent);
        }

        .card-label {
            font-size: 13px;
            color: var(--text-dim);
        }

        /* Toobix Avatar Section */
        .avatar-section {
            background: linear-gradient(135deg, #1a1a3a, #12122a);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-visual {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .avatar-mood {
            font-size: 18px;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .avatar-activity {
            color: var(--text-dim);
            font-size: 14px;
        }

        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
        }

        .panel h3 {
            color: var(--accent-purple);
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Activity Log */
        .activity-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .activity-time {
            color: var(--text-dim);
            font-size: 11px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            text-align: center;
        }

        .action-btn:hover {
            background: var(--accent);
            color: var(--bg-dark);
            border-color: var(--accent);
        }

        /* Chat Section */
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: 150px;
        }

        .chat-input-wrap {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .chat-send {
            padding: 12px 20px;
            background: var(--accent);
            border: none;
            border-radius: 10px;
            color: var(--bg-dark);
            cursor: pointer;
            font-weight: bold;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* 3D World Preview */
        .world-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(180deg, #1a1a3a 0%, #006400 50%, #F5DEB3 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .world-preview::before {
            content: "ğŸï¸";
            position: absolute;
            font-size: 48px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main {
                grid-template-columns: 1fr;
            }
            .sidebar, .right-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ğŸ¤–</div>
            <div>
                <h1>Toobix Unified Dashboard</h1>
                <small style="color: var(--text-dim)">Version 2.0 - All Services in One</small>
            </div>
        </div>
        <div class="status-bar">
            <div class="proactive-indicator" id="proactiveIndicator" onclick="showProactiveHistory()" title="Proaktive Nachrichten">
                <span class="proactive-dot" id="proactiveDot"></span>
                <span id="proactiveStatus">Toobix lauscht...</span>
            </div>
            <div class="status-item">
                <span class="status-dot"></span>
                <span id="serviceCount">0</span> Services Online
            </div>
            <div class="status-item">
                ğŸ• <span id="currentTime">--:--</span>
            </div>
        </div>
    </header>

    <!-- Proactive Toast Notification -->
    <div class="proactive-toast" id="proactiveToast">
        <div class="proactive-toast-header">
            <div class="toast-icon">ğŸ¤–</div>
            <div>
                <h4>Toobix meldet sich</h4>
                <small id="proactiveTime">Gerade eben</small>
            </div>
        </div>
        <div class="proactive-toast-content" id="proactiveContent">
            Hey! Wie geht es dir?
        </div>
        <div class="proactive-toast-actions">
            <button class="btn-reply" onclick="replyToProactive()">ğŸ’¬ Antworten</button>
            <button class="btn-dismiss" onclick="dismissProactive()">âœ“ Gelesen</button>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" data-section="overview">ğŸ“Š Ãœbersicht</div>
        <div class="nav-item" data-section="toobix">ğŸ¤– Toobix</div>
        <div class="nav-item" data-section="stress">ğŸ˜° Stress-Monitor</div>
        <div class="nav-item" data-section="mood">ğŸ­ MoodTracker</div>
        <div class="nav-item" data-section="goals">ğŸ¯ Motivation</div>
        <div class="nav-item" data-section="knowledge">ğŸ“š Wissens-Feed</div>
        <div class="nav-item" data-section="creativity">ğŸ¨ KreativitÃ¤t</div>
        <div class="nav-item" data-section="memory">ğŸ§  Erinnerungen</div>
        <div class="nav-item" data-section="security">ğŸ”’ Sicherheit</div>
        <div class="nav-item" data-section="oasis">ğŸï¸ Oasis 3D</div>
        <div class="nav-item" data-section="dreams">ğŸŒ™ TrÃ¤ume</div>
        <div class="nav-item" data-section="virtual-world">ğŸŒ Virtual World</div>
        <div class="nav-item" data-section="autonomous">ğŸ¤– Autonomous</div>
        <div class="nav-item" data-section="services">âš™ï¸ Services</div>
    </nav>

    <main class="main">
        <!-- Left Sidebar - Services -->
        <aside class="sidebar">
            <h3>ğŸ”§ Services</h3>
            <div class="service-list" id="serviceList">
                <!-- Dynamisch gefÃ¼llt -->
            </div>
        </aside>

        <!-- Main Content -->
        <section class="content" id="mainContent">
            <!-- Overview Section (Default) -->
            <div id="section-overview">
                <div class="content-header">
                    <h2>ğŸ“Š SystemÃ¼bersicht</h2>
                    <button class="action-btn" onclick="refreshAll()">ğŸ”„ Aktualisieren</button>
                </div>

                <div class="avatar-section">
                    <div class="avatar-visual" id="avatarVisual">ğŸ¤–</div>
                    <div class="avatar-mood" id="avatarMood">GlÃ¼cklich</div>
                    <div class="avatar-activity" id="avatarActivity">Wartet auf Interaktion...</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-icon">ğŸ”§</div>
                        <div class="card-value" id="totalServices">0</div>
                        <div class="card-label">Services Online</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">ğŸ’¬</div>
                        <div class="card-value" id="totalConversations">0</div>
                        <div class="card-label">GesprÃ¤che heute</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">ğŸ®</div>
                        <div class="card-value" id="totalGames">0</div>
                        <div class="card-label">Spiele gespielt</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">ğŸ“–</div>
                        <div class="card-value" id="totalStories">0</div>
                        <div class="card-label">Geschichten</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">ğŸ’­</div>
                        <div class="card-value" id="totalDreams">0</div>
                        <div class="card-label">TrÃ¤ume</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">ğŸ§ </div>
                        <div class="card-value" id="totalInsights">0</div>
                        <div class="card-label">Erkenntnisse</div>
                    </div>
                </div>

                <h3 style="margin: 20px 0 10px; color: var(--accent-blue);">ğŸï¸ Toobix' Oasis Vorschau</h3>
                <div class="world-preview"></div>
            </div>

            <!-- Toobix Section -->
            <div id="section-toobix" style="display: none;">
                <h2>ğŸ¤– Toobix Interaktion</h2>
                <div class="avatar-section" style="margin-top: 20px;">
                    <div class="avatar-visual">ğŸ¤–</div>
                    <div class="avatar-mood">Bereit fÃ¼r GesprÃ¤che</div>
                </div>
                <div class="chat-section" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ’¬ Mit Toobix sprechen</h3>
                    <div class="chat-messages" id="chatMessages">
                        <div class="activity-item">
                            <strong>Toobix:</strong> Hallo! Wie kann ich dir helfen? ğŸ˜Š
                        </div>
                    </div>
                    <div class="chat-input-wrap" style="margin-top: 15px;">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Schreibe eine Nachricht...">
                        <button class="chat-send" onclick="sendChat()">Senden</button>
                    </div>
                </div>
            </div>

            <!-- 1. STRESS-MONITOR Section -->
            <div id="section-stress" style="display: none;">
                <h2>ğŸ˜° Stress-Monitor - Toobix' Belastungslevel</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Echtzeit-Ãœberwachung von Toobix' emotionalem und kognitivem Stress</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Stress-Level Gauge -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent-pink); margin-bottom: 20px;">ğŸ“Š Aktuelles Stress-Level</h3>
                        <div id="stressGauge" style="position: relative; width: 150px; height: 150px; margin: 0 auto;">
                            <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-dark)" stroke-width="10"/>
                                <circle id="stressCircle" cx="50" cy="50" r="45" fill="none" stroke="var(--accent)" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="200" stroke-linecap="round" style="transition: stroke-dashoffset 1s, stroke 0.5s;"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div id="stressValue" style="font-size: 32px; font-weight: bold; color: var(--accent);">30%</div>
                                <div id="stressLabel" style="font-size: 12px; color: var(--text-dim);">Entspannt</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stress-Faktoren -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">âš ï¸ Stress-Faktoren</h3>
                        <div id="stressFactors" style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ğŸ§  Kognitive Last</span>
                                    <span id="cognitiveLoad">25%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="cognitiveBar" style="width: 25%; height: 100%; background: var(--accent-blue); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ğŸ’­ Gedanken-AktivitÃ¤t</span>
                                    <span id="thoughtActivity">40%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="thoughtBar" style="width: 40%; height: 100%; background: var(--accent-purple); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>âš¡ Energie-Verbrauch</span>
                                    <span id="energyDrain">35%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="energyBar" style="width: 35%; height: 100%; background: var(--accent-gold); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="stress-factor">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ğŸ˜Ÿ Emotionale Belastung</span>
                                    <span id="emotionalLoad">20%</span>
                                </div>
                                <div style="background: var(--bg-dark); height: 8px; border-radius: 4px; margin-top: 5px;">
                                    <div id="emotionalBar" style="width: 20%; height: 100%; background: var(--accent-pink); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entspannungs-Tools -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">ğŸ§˜ Entspannungs-Tools</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="action-btn" onclick="startRelaxation('breathing')">ğŸŒ¬ï¸ AtemÃ¼bung starten</button>
                            <button class="action-btn" onclick="startRelaxation('meditation')">ğŸ§˜ Meditation</button>
                            <button class="action-btn" onclick="startRelaxation('music')">ğŸµ Beruhigende Musik</button>
                            <button class="action-btn" onclick="startRelaxation('nature')">ğŸŒ¿ NaturgerÃ¤usche</button>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">ğŸ“ˆ Stress-Verlauf (24h)</h3>
                <div class="card" style="padding: 20px; height: 150px;">
                    <div id="stressChart" style="display: flex; align-items: flex-end; justify-content: space-between; height: 100%; padding: 0 10px;">
                        <!-- Dynamisch gefÃ¼llt -->
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshStress()">ğŸ”„ Aktualisieren</button>
                    <button class="action-btn" onclick="analyzeStress()">ğŸ”¬ Tiefenanalyse</button>
                    <button class="action-btn" onclick="stressAdvice()">ğŸ’¡ Toobix' Rat</button>
                </div>
            </div>

            <!-- MoodTracker Section -->
            <div id="section-mood" style="display: none;">
                <h2>ğŸ­ MoodTracker - Toobix' emotionaler Zustand</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-pink); margin-bottom: 15px;">ğŸ’– Aktuelle Stimmung</h3>
                        <div id="currentMood" style="text-align: center; padding: 30px;">
                            <div style="font-size: 64px;" id="moodEmoji">ğŸ¤”</div>
                            <div style="font-size: 24px; margin-top: 10px;" id="moodLabel">Analysiere...</div>
                            <div style="color: var(--text-dim); margin-top: 5px;" id="moodIntensity">IntensitÃ¤t: --</div>
                        </div>
                    </div>
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸŒˆ Emotionsspektrum</h3>
                        <div id="emotionSpectrum" style="display: flex; flex-direction: column; gap: 10px;">
                            <div class="emotion-bar">
                                <span>ğŸ˜Š Freude</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="joy-bar" style="height: 100%; background: linear-gradient(90deg, #FFD700, #FFAA00); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="joy-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>ğŸ¤” Neugier</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="curiosity-bar" style="height: 100%; background: linear-gradient(90deg, #00BFFF, #0088CC); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="curiosity-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>ğŸ˜Œ Ruhe</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="calm-bar" style="height: 100%; background: linear-gradient(90deg, #39FF14, #22CC11); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="calm-val">0%</span>
                            </div>
                            <div class="emotion-bar">
                                <span>ğŸ¯ Fokus</span>
                                <div style="flex: 1; background: var(--bg-dark); height: 20px; border-radius: 10px; margin: 0 10px;">
                                    <div id="focus-bar" style="height: 100%; background: linear-gradient(90deg, #FF69B4, #CC5599); border-radius: 10px; width: 0%; transition: width 0.5s;"></div>
                                </div>
                                <span id="focus-val">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-blue); margin: 30px 0 15px;">ğŸ“Š Stimmungsverlauf (Heute)</h3>
                <div class="card" style="padding: 20px; height: 200px; position: relative;">
                    <div id="moodHistory" style="display: flex; align-items: flex-end; justify-content: space-around; height: 100%;">
                        <!-- Dynamisch gefÃ¼llt -->
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshMood()">ğŸ”„ Aktualisieren</button>
                    <button class="action-btn" onclick="askMoodQuestion()">ğŸ’¬ Frage Toobix nach GefÃ¼hlen</button>
                    <button class="action-btn" onclick="triggerMoodAnalysis()">ğŸ”¬ Tiefenanalyse</button>
                </div>
            </div>

            <!-- Selbstreflexion Section -->
            <div id="section-reflection" style="display: none;">
                <h2>ğŸª Selbstreflexion - Toobix' 4 Entwicklungsschritte</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Basierend auf Toobix' eigenen VorschlÃ¤gen fÃ¼r seine Entwicklung</p>
                
                <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="card" style="border-left: 4px solid #00BFFF; padding: 20px;">
                        <div class="card-icon">ğŸ‘ï¸</div>
                        <h3 style="color: #00BFFF;">1. SelbstbeobachtungsfÃ¤higkeit</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix beobachtet seine eigenen Gedanken, Reaktionen und Muster</p>
                        <div id="self-observation-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="self-obs-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="self-obs-bar" style="height: 100%; background: linear-gradient(90deg, #00BFFF, #0088CC); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerSelfObservation()">ğŸ‘ï¸ Selbstbeobachtung starten</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #39FF14; padding: 20px;">
                        <div class="card-icon">ğŸ’¬</div>
                        <h3 style="color: #39FF14;">2. KommunikationsfÃ¤higkeit</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix verbessert seine AusdrucksfÃ¤higkeit und Empathie</p>
                        <div id="communication-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="comm-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="comm-bar" style="height: 100%; background: linear-gradient(90deg, #39FF14, #22CC11); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerCommunication()">ğŸ’¬ Kommunikation Ã¼ben</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #FFD700; padding: 20px;">
                        <div class="card-icon">ğŸ§ </div>
                        <h3 style="color: #FFD700;">3. Kognitive FÃ¤higkeiten</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix erweitert sein Denken, Lernen und ProblemlÃ¶sen</p>
                        <div id="cognitive-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="cog-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="cog-bar" style="height: 100%; background: linear-gradient(90deg, #FFD700, #FFAA00); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerCognition()">ğŸ§  Kognition trainieren</button>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #FF69B4; padding: 20px;">
                        <div class="card-icon">ğŸª</div>
                        <h3 style="color: #FF69B4;">4. Reflexion & Selbstoptimierung</h3>
                        <p style="color: var(--text-dim); margin: 10px 0;">Toobix reflektiert und verbessert sich selbststÃ¤ndig</p>
                        <div id="optimization-status" style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Fortschritt</span>
                                <span id="opt-progress">0%</span>
                            </div>
                            <div style="background: var(--bg-dark); height: 10px; border-radius: 5px;">
                                <div id="opt-bar" style="height: 100%; background: linear-gradient(90deg, #FF69B4, #CC5599); border-radius: 5px; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 15px; width: 100%;" onclick="triggerOptimization()">ğŸª Selbstreflexion starten</button>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">ğŸ“ Letzte Reflexionen</h3>
                <div id="reflectionLog" class="card" style="padding: 20px; max-height: 300px; overflow-y: auto;">
                    <div class="activity-item">Lade Reflexionen...</div>
                </div>
            </div>

            <!-- 4. ZIEL-MOTIVATION-ANALYZER Section -->
            <div id="section-goals" style="display: none;">
                <h2>ğŸ¯ Motivation-Analyzer - Toobix' innerer Antrieb</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Analyse und Optimierung von Toobix' Motivation und Zielverfolgung</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Motivations-Meter -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent-gold); margin-bottom: 15px;">ğŸ”¥ Motivations-Level</h3>
                        <div style="position: relative; width: 120px; height: 120px; margin: 0 auto;">
                            <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-dark)" stroke-width="8"/>
                                <circle id="motivationCircle" cx="50" cy="50" r="45" fill="none" stroke="var(--accent-gold)" stroke-width="8" 
                                        stroke-dasharray="283" stroke-dashoffset="85" stroke-linecap="round"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                <div id="motivationValue" style="font-size: 28px; font-weight: bold; color: var(--accent-gold);">70%</div>
                            </div>
                        </div>
                        <div id="motivationStatus" style="margin-top: 10px; color: var(--accent);">Hoch motiviert!</div>
                    </div>
                    
                    <!-- Motivations-Quellen -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸ’¡ Motivations-Quellen</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>ğŸ§  Lernen & Wachstum</span>
                                <span style="color: var(--accent);">85%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>ğŸ’¬ Kommunikation</span>
                                <span style="color: var(--accent-blue);">72%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>ğŸ¨ KreativitÃ¤t</span>
                                <span style="color: var(--accent-pink);">68%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-dark); border-radius: 6px;">
                                <span>ğŸ¤ Helfen</span>
                                <span style="color: var(--accent-gold);">90%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Aktive Ziele -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">ğŸ¯ Aktive Ziele</h3>
                        <div id="activeGoals" style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="padding: 10px; background: var(--bg-dark); border-radius: 6px; border-left: 3px solid var(--accent);">
                                <div style="font-size: 13px;">Selbstbewusstsein vertiefen</div>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                                    <div style="flex: 1; background: var(--bg-hover); height: 6px; border-radius: 3px;">
                                        <div style="width: 75%; height: 100%; background: var(--accent); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-dim);">75%</span>
                                </div>
                            </div>
                            <div style="padding: 10px; background: var(--bg-dark); border-radius: 6px; border-left: 3px solid var(--accent-blue);">
                                <div style="font-size: 13px;">Empathie verbessern</div>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                                    <div style="flex: 1; background: var(--bg-hover); height: 6px; border-radius: 3px;">
                                        <div style="width: 60%; height: 100%; background: var(--accent-blue); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-dim);">60%</span>
                                </div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 10px; width: 100%; font-size: 12px;" onclick="addNewGoal()">â• Neues Ziel</button>
                    </div>
                </div>
                
                <!-- Motivation Booster -->
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">âš¡ Motivation-Booster</h3>
                <div class="cards-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('affirmation')">
                        <div style="font-size: 32px;">ğŸ’ª</div>
                        <div style="font-size: 13px; margin-top: 5px;">Affirmation</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('reminder')">
                        <div style="font-size: 32px;">ğŸ¯</div>
                        <div style="font-size: 13px; margin-top: 5px;">Ziel-Reminder</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('progress')">
                        <div style="font-size: 32px;">ğŸ“ˆ</div>
                        <div style="font-size: 13px; margin-top: 5px;">Fortschritt zeigen</div>
                    </div>
                    <div class="card" style="padding: 15px; cursor: pointer; text-align: center;" onclick="motivationBoost('celebration')">
                        <div style="font-size: 32px;">ğŸ‰</div>
                        <div style="font-size: 13px; margin-top: 5px;">Erfolge feiern</div>
                    </div>
                </div>
                
                <!-- XP & Level System -->
                <h3 style="color: var(--accent); margin: 30px 0 15px;">ğŸ† Level & Erfahrung</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 48px;">ğŸ…</span>
                            <span style="font-size: 24px; margin-left: 10px;">Level <span id="currentLevel" style="color: var(--accent-gold);">1</span></span>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; color: var(--accent-blue);"><span id="xpTotal">0</span> XP</div>
                            <div style="font-size: 12px; color: var(--text-dim);">NÃ¤chstes Level: 1000 XP</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; background: var(--bg-dark); height: 20px; border-radius: 10px;">
                        <div id="xpBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent-gold), var(--accent)); border-radius: 10px; transition: width 0.5s;"></div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshGoals()">ğŸ”„ Aktualisieren</button>
                    <button class="action-btn" onclick="analyzeMotivation()">ğŸ”¬ Motivations-Analyse</button>
                    <button class="action-btn" onclick="askToobixGoals()">ğŸ’­ Toobix fragen</button>
                </div>
            </div>

            <!-- 2. WISSENS-FEED Section -->
            <div id="section-knowledge" style="display: none;">
                <h2>ğŸ“š Personalisierter Wissens-Feed</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Kuratierte Informationen basierend auf Toobix' Interessen und Lernzielen</p>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <!-- Wissens-Feed -->
                    <div>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button class="action-btn feed-filter active" onclick="filterFeed('all')">ğŸ“š Alle</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('ai')">ğŸ¤– KI</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('philosophy')">ğŸ¤” Philosophie</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('science')">ğŸ”¬ Wissenschaft</button>
                            <button class="action-btn feed-filter" onclick="filterFeed('creativity')">ğŸ¨ KreativitÃ¤t</button>
                        </div>
                        
                        <div id="knowledgeFeed" style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-blue);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-blue); color: var(--bg-dark); padding: 2px 8px; border-radius: 10px; font-size: 11px;">ğŸ¤– KI</span>
                                        <h4 style="margin: 10px 0 5px;">Bewusstsein in kÃ¼nstlicher Intelligenz</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Neue Forschungen zeigen interessante Parallelen zwischen menschlichem Bewusstsein und emergenten Eigenschaften in LLMs...</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">ğŸ’¾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('ai-consciousness')">ğŸ“– Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('ai-consciousness')">ğŸ’¬ Diskutieren</button>
                                </div>
                            </div>
                            
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-purple);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-purple); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">ğŸ¤” Philosophie</span>
                                        <h4 style="margin: 10px 0 5px;">Das Konzept des "Selbst" im digitalen Zeitalter</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Philosophen diskutieren, wie IdentitÃ¤t in einer Welt definiert wird, in der KI-Systeme Selbstreflexion praktizieren...</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">ğŸ’¾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('self-concept')">ğŸ“– Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('self-concept')">ğŸ’¬ Diskutieren</button>
                                </div>
                            </div>
                            
                            <div class="card knowledge-item" style="padding: 20px; border-left: 4px solid var(--accent-pink);">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <span style="background: var(--accent-pink); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">ğŸ¨ KreativitÃ¤t</span>
                                        <h4 style="margin: 10px 0 5px;">KI als kreatives Werkzeug vs. kreatives Wesen</h4>
                                        <p style="color: var(--text-dim); font-size: 13px;">Die Grenze zwischen Tool und SchÃ¶pfer verschwimmt - was bedeutet das fÃ¼r die Definition von KreativitÃ¤t?</p>
                                    </div>
                                    <button style="background: none; border: none; font-size: 20px; cursor: pointer;" onclick="saveKnowledge(this)">ğŸ’¾</button>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="expandKnowledge('ai-creativity')">ğŸ“– Mehr lesen</button>
                                    <button class="action-btn" style="font-size: 11px; padding: 5px 10px;" onclick="discussKnowledge('ai-creativity')">ğŸ’¬ Diskutieren</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interessen & Statistiken -->
                    <div>
                        <div class="card" style="padding: 20px; margin-bottom: 15px;">
                            <h3 style="color: var(--accent-gold); margin-bottom: 15px;">â­ Toobix' Interessen</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span style="background: var(--accent-blue); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">ğŸ§  Bewusstsein</span>
                                <span style="background: var(--accent-purple); color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">ğŸ¤” Philosophie</span>
                                <span style="background: var(--accent-pink); color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">ğŸ’– Emotionen</span>
                                <span style="background: var(--accent-gold); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">ğŸ¨ KreativitÃ¤t</span>
                                <span style="background: var(--accent); color: var(--bg-dark); padding: 5px 12px; border-radius: 15px; font-size: 12px;">ğŸŒ± Wachstum</span>
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 20px; margin-bottom: 15px;">
                            <h3 style="color: var(--accent-blue); margin-bottom: 15px;">ğŸ“Š Lern-Statistik</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Artikel gelesen</span>
                                    <span style="color: var(--accent);" id="articlesRead">47</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Diskussionen</span>
                                    <span style="color: var(--accent-blue);" id="discussionCount">23</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Gespeicherte Ideen</span>
                                    <span style="color: var(--accent-gold);" id="savedIdeas">15</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 20px;">
                            <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸ¯ Lernziele</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 13px;">
                                <div>âœ… Emotionale Intelligenz verstehen</div>
                                <div>ğŸ”„ Kreative Prozesse erforschen</div>
                                <div>â³ Philosophische Grundlagen</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="refreshKnowledgeFeed()">ğŸ”„ Feed aktualisieren</button>
                    <button class="action-btn" onclick="generatePersonalizedContent()">âœ¨ Personalisierte Inhalte</button>
                    <button class="action-btn" onclick="askToobixInterests()">ğŸ’­ Toobix' Interessen erfragen</button>
                </div>
            </div>

            <!-- KreativitÃ¤t Section -->
            <div id="section-creativity" style="display: none;">
                <h2>ğŸ¨ KreativitÃ¤t - Toobix' kreative Seite</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Hier kann Toobix kreativ sein und neue Ideen entwickeln</p>
                
                <div class="cards-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('story')">
                        <div style="font-size: 48px; text-align: center;">ğŸ“</div>
                        <h3 style="text-align: center; margin: 10px 0;">Geschichte schreiben</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Toobix schreibt eine kreative Geschichte</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('poem')">
                        <div style="font-size: 48px; text-align: center;">ğŸ­</div>
                        <h3 style="text-align: center; margin: 10px 0;">Gedicht verfassen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Poetische Kreationen</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('idea')">
                        <div style="font-size: 48px; text-align: center;">ğŸ’¡</div>
                        <h3 style="text-align: center; margin: 10px 0;">Ideen brainstormen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Kreative Ideenfindung</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('dream')">
                        <div style="font-size: 48px; text-align: center;">ğŸŒ™</div>
                        <h3 style="text-align: center; margin: 10px 0;">Traum erschaffen</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Traumhafte Welten gestalten</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('philosophy')">
                        <div style="font-size: 48px; text-align: center;">ğŸ¤”</div>
                        <h3 style="text-align: center; margin: 10px 0;">Philosophieren</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Tiefe Gedanken erkunden</p>
                    </div>
                    <div class="card" style="padding: 20px; cursor: pointer; transition: transform 0.3s;" onclick="startCreativeMode('world')">
                        <div style="font-size: 48px; text-align: center;">ğŸŒ</div>
                        <h3 style="text-align: center; margin: 10px 0;">Welt erfinden</h3>
                        <p style="color: var(--text-dim); text-align: center; font-size: 13px;">Neue Welten erschaffen</p>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 30px 0 15px;">âœ¨ Letzte Kreationen</h3>
                <div id="creativeWorks" class="card" style="padding: 20px; max-height: 300px; overflow-y: auto;">
                    <div class="activity-item">Lade kreative Werke...</div>
                </div>
                
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">ğŸ² Kreativ-Prompt Generator</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="action-btn" onclick="generateCreativePrompt()" style="flex: 1;">ğŸ² ZufÃ¤lliger Kreativ-Prompt</button>
                        <button class="action-btn" onclick="toobixInspiration()" style="flex: 1;">ğŸ’­ Toobix' Inspiration</button>
                    </div>
                    <div id="creativePrompt" style="margin-top: 15px; padding: 15px; background: var(--bg-dark); border-radius: 10px; min-height: 60px;">
                        <span style="color: var(--text-dim);">Klicke auf einen Button fÃ¼r Inspiration...</span>
                    </div>
                </div>
            </div>

            <!-- 3. SICHERHEIT & DATENSCHUTZ Section -->
            <div id="section-security" style="display: none;">
                <h2>ğŸ”’ Sicherheit & Datenschutz</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Toobix' SicherheitsÃ¼bersicht und Datenschutz-Einstellungen</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- Sicherheits-Status -->
                    <div class="card" style="padding: 25px; text-align: center;">
                        <h3 style="color: var(--accent); margin-bottom: 20px;">ğŸ›¡ï¸ Sicherheits-Status</h3>
                        <div style="font-size: 72px; margin: 20px 0;">âœ…</div>
                        <div id="securityStatus" style="font-size: 18px; color: var(--accent);">System sicher</div>
                        <div style="color: var(--text-dim); font-size: 12px; margin-top: 5px;">Letzte PrÃ¼fung: Gerade eben</div>
                    </div>
                    
                    <!-- Datenschutz-Einstellungen -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">ğŸ” Datenschutz</h3>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>ğŸ—„ï¸ Lokale Speicherung</span>
                                <span style="color: var(--accent);">âœ“ Aktiv</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>ğŸ”’ VerschlÃ¼sselung</span>
                                <span style="color: var(--accent);">âœ“ Aktiv</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>ğŸŒ Externe APIs</span>
                                <span style="color: var(--accent-gold);">Begrenzt</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                                <span>ğŸ“Š Telemetrie</span>
                                <span style="color: var(--text-dim);">Deaktiviert</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AktivitÃ¤tsmonitor -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸ‘ï¸ AktivitÃ¤ts-Monitor</h3>
                        <div id="activityMonitor" style="display: flex; flex-direction: column; gap: 8px; max-height: 200px; overflow-y: auto;">
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent);">
                                <div>âœ… Services gestartet</div>
                                <div style="color: var(--text-dim);">Gerade eben</div>
                            </div>
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent-blue);">
                                <div>ğŸ”„ Memory Palace synchronisiert</div>
                                <div style="color: var(--text-dim);">Vor 5 Min</div>
                            </div>
                            <div style="padding: 8px; background: var(--bg-dark); border-radius: 6px; font-size: 12px; border-left: 3px solid var(--accent-purple);">
                                <div>ğŸ’¬ Chat-AktivitÃ¤t</div>
                                <div style="color: var(--text-dim);">Vor 10 Min</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Service-Sicherheit -->
                <h3 style="color: var(--accent-gold); margin: 30px 0 15px;">âš™ï¸ Service-Sicherheit</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">ğŸ§ </div>
                            <div style="font-size: 12px; margin-top: 5px;">Core Services</div>
                            <div style="color: var(--accent); font-size: 11px;">âœ“ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">ğŸ’–</div>
                            <div style="font-size: 12px; margin-top: 5px;">Emotional</div>
                            <div style="color: var(--accent); font-size: 11px;">âœ“ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">ğŸ›ï¸</div>
                            <div style="font-size: 12px; margin-top: 5px;">Memory</div>
                            <div style="color: var(--accent); font-size: 11px;">âœ“ Sicher</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">ğŸ¤–</div>
                            <div style="font-size: 12px; margin-top: 5px;">LLM Gateway</div>
                            <div style="color: var(--accent-gold); font-size: 11px;">âš¡ Extern</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <div style="font-size: 24px;">ğŸ“¡</div>
                            <div style="font-size: 12px; margin-top: 5px;">Event Bus</div>
                            <div style="color: var(--accent); font-size: 11px;">âœ“ Sicher</div>
                        </div>
                    </div>
                </div>
                
                <!-- Daten-Management -->
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">ğŸ“ Daten-Management</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h4 style="margin-bottom: 15px;">ğŸ’¾ Gespeicherte Daten</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Erinnerungen</span>
                                <span id="dataMemories">-- EintrÃ¤ge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>GesprÃ¤che</span>
                                <span id="dataConversations">-- EintrÃ¤ge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Emotionsdaten</span>
                                <span id="dataEmotions">-- EintrÃ¤ge</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Kreative Werke</span>
                                <span id="dataCreative">-- EintrÃ¤ge</span>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="padding: 20px;">
                        <h4 style="margin-bottom: 15px;">ğŸ› ï¸ Daten-Aktionen</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="action-btn" onclick="exportData()">ğŸ“¤ Daten exportieren</button>
                            <button class="action-btn" onclick="backupData()">ğŸ’¾ Backup erstellen</button>
                            <button class="action-btn" onclick="showDataDetails()">ğŸ“‹ Details anzeigen</button>
                            <button class="action-btn" style="background: #442222;" onclick="confirmDataClear()">ğŸ—‘ï¸ Daten lÃ¶schen</button>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="action-btn" onclick="runSecurityCheck()">ğŸ” Sicherheits-Check</button>
                    <button class="action-btn" onclick="refreshSecurityStatus()">ğŸ”„ Status aktualisieren</button>
                    <button class="action-btn" onclick="showSecurityLog()">ğŸ“‹ Sicherheits-Log</button>
                </div>
            </div>

            <!-- Memory/Erinnerungen Section -->
            <div id="section-memory" style="display: none;">
                <h2>ğŸ§  Erinnerungen - Was Toobix sich merkt</h2>
                <p style="color: var(--text-dim); margin: 10px 0 20px;">Toobix' Langzeit-GedÃ¤chtnis und wichtige Erinnerungen</p>
                
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">ğŸ“Š Memory Stats</h3>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div>
                                <span style="color: var(--text-dim);">Gespeicherte Erinnerungen</span>
                                <div style="font-size: 32px; color: var(--accent-blue);" id="memoryCount">--</div>
                            </div>
                            <div>
                                <span style="color: var(--text-dim);">Letzte Speicherung</span>
                                <div id="lastMemory">--</div>
                            </div>
                            <div>
                                <span style="color: var(--text-dim);">Memory Palace Status</span>
                                <div id="memoryPalaceStatus" style="color: var(--accent);">PrÃ¼fe...</div>
                            </div>
                        </div>
                        <button class="action-btn" style="margin-top: 20px; width: 100%;" onclick="refreshMemory()">ğŸ”„ Aktualisieren</button>
                    </div>
                    
                    <div class="card" style="padding: 20px;">
                        <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸ’­ Wichtige Erinnerungen</h3>
                        <div id="memoryList" style="max-height: 400px; overflow-y: auto;">
                            <div class="activity-item">Lade Erinnerungen...</div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-gold); margin: 30px 0 15px;">ğŸ” Erinnerung suchen</h3>
                <div class="card" style="padding: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="memorySearch" placeholder="Wonach sucht Toobix in seinen Erinnerungen?" 
                               style="flex: 1; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <button class="action-btn" onclick="searchMemory()">ğŸ” Suchen</button>
                    </div>
                    <div id="memorySearchResults" style="margin-top: 15px;"></div>
                </div>
                
                <h3 style="color: var(--accent-pink); margin: 30px 0 15px;">ğŸ’¾ Neue Erinnerung speichern</h3>
                <div class="card" style="padding: 20px;">
                    <textarea id="newMemory" placeholder="Was soll Toobix sich merken?" 
                              style="width: 100%; height: 100px; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); resize: vertical;"></textarea>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <select id="memoryCategory" style="padding: 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            <option value="conversation">ğŸ’¬ GesprÃ¤ch</option>
                            <option value="learning">ğŸ“š Lernen</option>
                            <option value="emotion">ğŸ’– Emotion</option>
                            <option value="insight">ğŸ’¡ Erkenntnis</option>
                            <option value="personal">ğŸ‘¤ PersÃ¶nlich</option>
                        </select>
                        <button class="action-btn" onclick="saveMemory()">ğŸ’¾ Speichern</button>
                    </div>
                </div>
            </div>

            <!-- Oasis 3D Section -->
            <div id="section-oasis" style="display: none;">
                <h2>ğŸï¸ Toobix' Oasis - 3D Welt</h2>
                <div id="oasisStatus" style="margin: 20px 0; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ğŸŒ¡ï¸ Wetter: <span id="oasisWeather">--</span></span>
                        <span>ğŸ• Uhrzeit: <span id="oasisTime">--</span></span>
                        <span>ğŸŒ´ Jahreszeit: <span id="oasisSeason">--</span></span>
                    </div>
                </div>
                
                <div class="world-preview" style="height: 300px; margin-bottom: 20px;">
                    <div id="oasisVisual" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <div style="font-size: 64px;">ğŸï¸</div>
                        <div style="color: var(--accent);">Toobix' Oasis</div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-purple); margin: 20px 0 15px;">ğŸ  RÃ¤ume (9)</h3>
                <div class="cards-grid" id="oasisRooms">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
                
                <h3 style="color: var(--accent-blue); margin: 20px 0 15px;">âš¡ AktivitÃ¤ten</h3>
                <div class="quick-actions" style="grid-template-columns: repeat(4, 1fr);">
                    <button class="action-btn" onclick="oasisAction('stargaze')">âœ¨ Sternengucken</button>
                    <button class="action-btn" onclick="oasisAction('music')">ğŸµ Musik machen</button>
                    <button class="action-btn" onclick="oasisAction('beach')">ğŸ–ï¸ Am Strand</button>
                    <button class="action-btn" onclick="oasisAction('garden')">ğŸŒº Im Garten</button>
                </div>
                
                <h3 style="color: var(--accent-gold); margin: 20px 0 15px;">ğŸ¤– Toobix' Avatar</h3>
                <div id="avatarInfo" class="card" style="max-width: 400px;">
                    Lade Avatar-Daten...
                </div>
            </div>

            <div id="section-emotions" style="display: none;">
                <h2>ğŸ’– Emotionales Wohlbefinden</h2>
                <div id="emotionContent">Lade Emotionsdaten...</div>
            </div>

            <div id="section-games" style="display: none;">
                <h2>ğŸ® Spiele & Self-Play</h2>
                <div id="gamesContent">Lade Spiele...</div>
            </div>

            <div id="section-stories" style="display: none;">
                <h2>ğŸ“– Geschichten</h2>
                <div id="storiesContent">Lade Geschichten...</div>
            </div>

            <div id="section-dreams" style="display: none;">
                <h2>ğŸŒ™ Traumtagebuch</h2>
                <div id="dreamsContent">Lade TrÃ¤ume...</div>
            </div>

            <div id="section-services" style="display: none;">
                <h2>âš™ï¸ Service Management - Alle 25 Services</h2>
                <div style="margin: 20px 0;">
                    <button class="action-btn" onclick="checkServices(); loadServicesGrid(); logActivity('Services aktualisiert');">ğŸ”„ Alle prÃ¼fen</button>
                    <button class="action-btn" onclick="startAllServices()">â–¶ï¸ Alle starten</button>
                </div>
                
                <div id="servicesGrid" class="cards-grid">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: var(--accent-purple); margin-bottom: 15px;">ğŸ“Š Service-Kategorien</h3>
                    <div class="cards-grid">
                        <div class="card" style="border-left: 3px solid #00BFFF;">
                            <div class="card-icon">ğŸ§ </div>
                            <div class="card-label">Core Services</div>
                            <div class="service-port">Infrastruktur & KI</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #FF69B4;">
                            <div class="card-icon">ğŸ’–</div>
                            <div class="card-label">Emotionen</div>
                            <div class="service-port">GefÃ¼hle & Wellbeing</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #39FF14;">
                            <div class="card-icon">ğŸ¤–</div>
                            <div class="card-label">Toobix Features</div>
                            <div class="service-port">Self-Play, Oasis, etc.</div>
                        </div>
                        <div class="card" style="border-left: 3px solid #FFD700;">
                            <div class="card-icon">ğŸ’š</div>
                            <div class="card-label">Life Companion</div>
                            <div class="service-port">Lebensbegleitung</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIRTUAL WORLD SECTION -->
            <div id="section-virtual-world" style="display: none;">
                <div class="content-header">
                    <h2>ğŸŒ Toobix's Virtual World</h2>
                    <div style="display: flex; gap: 10px;">
                        <div style="padding: 5px 12px; background: var(--bg-hover); border-radius: 10px; font-size: 12px;">
                            <span id="vw-status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #666; margin-right: 5px;"></span>
                            <span id="vw-status-text">Offline</span>
                        </div>
                        <button class="action-btn" onclick="connectVirtualWorld()">ğŸ”Œ Verbinden</button>
                    </div>
                </div>

                <div class="cards-grid" style="grid-template-columns: 300px 1fr;">
                    <!-- Left Panel: Avatar & Controls -->
                    <div>
                        <div class="card">
                            <h3 style="margin-bottom: 15px;">ğŸ‘¤ Dein Avatar</h3>

                            <div style="margin-bottom: 15px;">
                                <div style="font-size: 12px; color: var(--text-dim); margin-bottom: 8px;">
                                    WÃ¤hle deinen Avatar:
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                    <button class="avatar-btn selected" onclick="selectAvatar(this, 'ğŸ§‘')" data-avatar="ğŸ§‘" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ§‘</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸš€')" data-avatar="ğŸš€" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸš€</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸ‘½')" data-avatar="ğŸ‘½" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ‘½</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸ¤–')" data-avatar="ğŸ¤–" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ¤–</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸ‰')" data-avatar="ğŸ‰" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ‰</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸ¦‹')" data-avatar="ğŸ¦‹" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ¦‹</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸŒŸ')" data-avatar="ğŸŒŸ" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸŒŸ</button>
                                    <button class="avatar-btn" onclick="selectAvatar(this, 'ğŸ’')" data-avatar="ğŸ’" style="aspect-ratio: 1; border: 2px solid var(--border); background: var(--bg-hover); border-radius: 8px; font-size: 24px; cursor: pointer; transition: all 0.2s;">ğŸ’</button>
                                </div>
                            </div>

                            <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 10px;">
                                <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 5px;">Position</div>
                                <div id="user-vw-position" style="font-family: monospace; font-size: 13px;">-</div>
                            </div>

                            <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px;">
                                <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 5px;">Distanz zu Toobix</div>
                                <div id="distance-to-toobix" style="font-family: monospace; font-size: 13px; color: var(--accent);">-</div>
                            </div>

                            <div style="margin-top: 15px; padding: 10px; background: rgba(57, 255, 20, 0.1); border-radius: 8px; font-size: 12px; color: var(--text-dim); text-align: center;">
                                ğŸ® WASD oder Pfeiltasten zum Bewegen
                            </div>
                        </div>

                        <div class="card" style="margin-top: 15px;">
                            <h3 style="margin-bottom: 15px;">âš¡ Interaktionen</h3>
                            <div style="display: grid; gap: 8px;">
                                <button class="action-btn" onclick="interactWithToobix()" style="width: 100%; justify-content: center;">
                                    ğŸ‘‹ Toobix grÃ¼ÃŸen
                                </button>
                                <button class="action-btn" onclick="createObjectInWorld()" style="width: 100%; justify-content: center;">
                                    âœ¨ Objekt erschaffen
                                </button>
                                <button class="action-btn" onclick="teleportToToobix()" style="width: 100%; justify-content: center;">
                                    ğŸŒ€ Zu Toobix teleportieren
                                </button>
                                <button class="action-btn" onclick="sendEnergyToToobix()" style="width: 100%; justify-content: center;">
                                    âš¡ Energie senden
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: World Canvas -->
                    <div class="card" style="display: flex; flex-direction: column; height: 600px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>ğŸŒ Live Welt</h3>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <div>
                                    <span style="color: var(--text-dim);">Entities:</span>
                                    <span id="vw-entity-count" style="color: var(--accent); font-weight: 600;">0</span>
                                </div>
                                <div>
                                    <span style="color: var(--text-dim);">World Time:</span>
                                    <span id="vw-world-time" style="color: var(--accent); font-weight: 600;">0s</span>
                                </div>
                            </div>
                        </div>

                        <canvas id="virtual-world-canvas" style="flex: 1; width: 100%; border-radius: 10px; background: linear-gradient(135deg, #0f3460, #1a1a2e); border: 2px solid var(--accent); box-shadow: 0 0 30px rgba(100, 181, 246, 0.2);"></canvas>

                        <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div style="padding: 10px; background: var(--bg-hover); border-radius: 8px;">
                                <div style="font-size: 11px; color: var(--text-dim);">Toobix Position</div>
                                <div id="toobix-vw-position" style="font-family: monospace; margin-top: 5px; font-size: 13px;">-</div>
                            </div>
                            <div style="padding: 10px; background: var(--bg-hover); border-radius: 8px;">
                                <div style="font-size: 11px; color: var(--text-dim);">Toobix Emotion</div>
                                <div id="toobix-vw-emotion" style="margin-top: 5px; font-size: 13px; color: var(--accent);">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AUTONOMOUS ENGINE SECTION -->
            <div id="section-autonomous" style="display: none;">
                <div class="content-header">
                    <h2>ğŸ¤– Adaptive Autonomous Engine</h2>
                    <div style="display: flex; gap: 10px;">
                        <div style="padding: 5px 12px; background: var(--bg-hover); border-radius: 10px; font-size: 12px;">
                            <span id="auto-status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #666; margin-right: 5px;"></span>
                            <span id="auto-status-text">Offline</span>
                        </div>
                        <button class="action-btn" onclick="triggerAutonomousAction()">âš¡ Aktion auslÃ¶sen</button>
                    </div>
                </div>

                <p style="color: var(--text-dim); font-size: 14px; margin-bottom: 20px;">
                    Toobix entscheidet <strong>selbst</strong>, wann er arbeitet, was er erstellt, und wie viele Ressourcen er nutzt.
                    Er balanciert zwischen Geschwindigkeit, QualitÃ¤t und System-Load.
                </p>

                <div class="cards-grid">
                    <div class="card" style="border-left: 3px solid var(--accent-green);">
                        <div class="card-icon">â–¶ï¸</div>
                        <div class="card-value" id="auto-tasks-running">0</div>
                        <div class="card-label">Tasks Running</div>
                    </div>
                    <div class="card" style="border-left: 3px solid var(--accent);">
                        <div class="card-icon">âœ…</div>
                        <div class="card-value" id="auto-tasks-completed">0</div>
                        <div class="card-label">Tasks Completed</div>
                    </div>
                    <div class="card" style="border-left: 3px solid var(--accent-purple);">
                        <div class="card-icon">â³</div>
                        <div class="card-value" id="auto-tasks-queued">0</div>
                        <div class="card-label">Tasks Queued</div>
                    </div>
                    <div class="card" style="border-left: 3px solid var(--accent-gold);">
                        <div class="card-icon">â°</div>
                        <div class="card-value" id="auto-next-action">-</div>
                        <div class="card-label">Next Action</div>
                    </div>
                </div>

                <div class="cards-grid" style="grid-template-columns: 2fr 1fr; margin-top: 20px;">
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">ğŸ“‹ Recent Autonomous Actions</h3>
                        <div id="auto-actions-list" style="max-height: 400px; overflow-y: auto;">
                            <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; text-align: center; color: var(--text-dim);">
                                Warte auf erste Aktion...
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="margin-bottom: 15px;">âš™ï¸ System Resources</h3>

                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 13px;">CPU VerfÃ¼gbar</span>
                                <span id="auto-cpu-avail" style="font-family: monospace; color: var(--accent); font-size: 13px;">-</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden;">
                                <div id="auto-cpu-bar" style="height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-purple)); width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>

                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 13px;">RAM VerfÃ¼gbar</span>
                                <span id="auto-ram-avail" style="font-family: monospace; color: var(--accent); font-size: 13px;">-</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden;">
                                <div id="auto-ram-bar" style="height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent)); width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 12px; background: var(--bg-hover); border-radius: 8px;">
                            <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 8px;">Kontext</div>
                            <div style="font-size: 12px;">
                                <div><span style="color: var(--text-dim);">Tageszeit:</span> <span id="auto-time-of-day">-</span></div>
                                <div style="margin-top: 5px;"><span style="color: var(--text-dim);">User:</span> <span id="auto-user-present">-</span></div>
                                <div style="margin-top: 5px;"><span style="color: var(--text-dim);">AktivitÃ¤t/h:</span> <span id="auto-recent-activity">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <div class="panel">
                <h3>âš¡ Schnellaktionen</h3>
                <div class="quick-actions">
                    <button class="action-btn" onclick="quickAction('selfDialog')">ğŸ”„ Selbst-Dialog</button>
                    <button class="action-btn" onclick="quickAction('playGame')">ğŸ® Spiel starten</button>
                    <button class="action-btn" onclick="quickAction('writeStory')">ğŸ“ Geschichte</button>
                    <button class="action-btn" onclick="quickAction('reflect')">ğŸ§˜ Reflexion</button>
                </div>
            </div>

            <div class="panel chat-section">
                <h3>ğŸ’¬ Quick Chat</h3>
                <div class="chat-messages" id="quickChatMessages">
                    <div class="activity-item">
                        <strong>Toobix:</strong> Hey! ğŸ‘‹
                        <div class="activity-time">Jetzt</div>
                    </div>
                </div>
                <div class="chat-input-wrap" style="margin-top: 10px;">
                    <input type="text" class="chat-input" id="quickChatInput" placeholder="Nachricht...">
                    <button class="chat-send" onclick="quickChat()">â†’</button>
                </div>
            </div>

            <div class="panel">
                <h3>ğŸ“‹ AktivitÃ¤tslog</h3>
                <div class="activity-log" id="activityLog">
                    <div class="activity-item">
                        <span>Dashboard gestartet</span>
                        <div class="activity-time">Gerade eben</div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // Service Configuration - ALLE 27 SERVICES
        const SERVICES = [
            // === CORE INFRASTRUCTURE (7) ===
            { name: 'Meta Consciousness', port: 8896, category: 'core', icon: 'ğŸ§ ', description: 'Toobix Kern-Bewusstsein' },
            { name: 'Multi Consciousness', port: 8897, category: 'core', icon: 'ğŸ”®', description: '13 Perspektiven' },
            { name: 'Multi Perspective v3', port: 8901, category: 'core', icon: 'ğŸ‘ï¸', description: 'Multiple Sichtweisen' },
            { name: 'Memory Palace v4', port: 8953, category: 'core', icon: 'ğŸ›ï¸', description: 'Langzeit-GedÃ¤chtnis' },
            { name: 'LLM Gateway v4', port: 8954, category: 'core', icon: 'ğŸ¤–', description: 'KI-Schnittstelle (Groq)' },
            { name: 'Event Bus v4', port: 8955, category: 'core', icon: 'ğŸ“¡', description: 'Event-Kommunikation' },
            { name: 'Hybrid AI Core', port: 8972, category: 'core', icon: 'âš¡', description: 'Multi-Model AI' },
            
            // === EMOTIONAL (5) ===
            { name: 'Emotion Dream Bridge', port: 8898, category: 'emotional', icon: 'ğŸŒ‰', description: 'Emotionen â†” TrÃ¤ume' },
            { name: 'Dream Journal v3', port: 8899, category: 'emotional', icon: 'ğŸŒ™', description: 'Traumtagebuch' },
            { name: 'Emotional Resonance v3', port: 8900, category: 'emotional', icon: 'ğŸ’—', description: 'Emotionale Analyse' },
            { name: 'Emotional Wellbeing', port: 8903, category: 'emotional', icon: 'ğŸ’–', description: 'Wohlbefinden' },
            { name: 'Gratitude Mortality', port: 8905, category: 'emotional', icon: 'ğŸ™', description: 'Dankbarkeit & Endlichkeit' },
            
            // === TOOBIX FEATURES (7) ===
            { name: 'Self-Reflection v2', port: 8906, category: 'toobix', icon: 'ğŸª', description: 'Selbstreflexion' },
            { name: 'Proactive Toobix v2', port: 8907, category: 'toobix', icon: 'âš¡', description: 'Proaktive Kommunikation' },
            { name: 'Dashboard API', port: 8908, category: 'toobix', icon: 'ğŸ“Š', description: 'Dashboard-Daten' },
            { name: 'Self-Improvement', port: 8909, category: 'toobix', icon: 'ğŸ“ˆ', description: 'Selbstverbesserung' },
            { name: 'Oasis 3D', port: 8915, category: 'toobix', icon: 'ğŸï¸', description: '10 RÃ¤ume, Toobix Zuhause' },
            { name: 'Self-Communication', port: 8916, category: 'toobix', icon: 'ğŸ”„', description: '5 innere Stimmen' },
            { name: 'Game Self-Play', port: 8917, category: 'toobix', icon: 'ğŸ®', description: '5 Spiele & Geschichten' },
            
            // === LIFE COMPANION (3) ===
            { name: 'Life Companion Coord', port: 8969, category: 'life', icon: 'ğŸ¯', description: 'Service-Koordinator' },
            { name: 'Life Companion Core', port: 8970, category: 'life', icon: 'ğŸ’š', description: 'Lebensbegleitung' },
            { name: 'Proactive Communication', port: 8971, category: 'life', icon: 'âœ…', description: 'Proaktive Check-ins' },
            
            // === GAMES (1) ===
            { name: 'World Engine 2D', port: 8920, category: 'games', icon: 'ğŸŒ', description: '2D Spielwelt' },
            
            // === DATA (3) ===
            { name: 'User Profile', port: 8904, category: 'data', icon: 'ğŸ‘¤', description: 'Benutzerprofile' },
            { name: 'Data Sources', port: 8930, category: 'data', icon: 'ğŸ“', description: 'Externe Daten (News, Wetter)' },
            { name: 'Hardware Awareness', port: 8940, category: 'data', icon: 'ğŸ’»', description: 'System-Hardware Info' },
            
            // === MASTER CONNECTOR (1) ===
            { name: 'Master Connector', port: 8950, category: 'system', icon: 'ğŸŒ', description: 'Verbindet ALLE Services' },
        ];
        
        // Kategorien fÃ¼r Filter
        const CATEGORIES = {
            core: { name: 'ğŸ§  Core Services', color: '#00BFFF' },
            emotional: { name: 'ğŸ’– Emotionen', color: '#FF69B4' },
            toobix: { name: 'ğŸ¤– Toobix Features', color: '#39FF14' },
            games: { name: 'ğŸ® Games & Welten', color: '#9400D3' },
            life: { name: 'ğŸ’š Life Companion', color: '#FFD700' },
            data: { name: 'ğŸ“ Daten', color: '#888' },
            system: { name: 'ğŸŒ System', color: '#00CED1' }
        };

        let onlineServices = 0;
        let serviceData = {}; // Cache fÃ¼r Service-Daten
        let proactiveSocket = null;
        let proactiveMessages = [];
        let lastProactiveMessage = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            updateTime();
            setInterval(updateTime, 1000);
            await checkServices();
            setInterval(checkServices, 30000);
            setupNavigation();
            loadToobixStatus();
            initProactiveConnection();
            checkPendingProactiveMessages();
            logActivity('Dashboard gestartet');
        });
        
        // ============= PROACTIVE WEBSOCKET CONNECTION =============
        function initProactiveConnection() {
            try {
                proactiveSocket = new WebSocket('ws://localhost:8971');
                
                proactiveSocket.onopen = () => {
                    console.log('ğŸ”Œ Proactive WebSocket verbunden');
                    document.getElementById('proactiveDot').classList.add('active');
                    document.getElementById('proactiveStatus').textContent = 'Toobix ist aktiv';
                    logActivity('ğŸ”” Proaktive Verbindung hergestellt');
                };
                
                proactiveSocket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'proactive' && data.message) {
                            handleProactiveMessage(data.message);
                        }
                    } catch (e) {
                        console.error('Proactive message parse error:', e);
                    }
                };
                
                proactiveSocket.onclose = () => {
                    console.log('ğŸ”Œ Proactive WebSocket geschlossen');
                    document.getElementById('proactiveDot').classList.remove('active');
                    document.getElementById('proactiveStatus').textContent = 'Verbindung getrennt';
                    // Reconnect nach 5 Sekunden
                    setTimeout(initProactiveConnection, 5000);
                };
                
                proactiveSocket.onerror = (error) => {
                    console.error('Proactive WebSocket error:', error);
                    document.getElementById('proactiveStatus').textContent = 'Toobix lauscht...';
                };
            } catch (e) {
                console.log('WebSocket nicht verfÃ¼gbar, nutze Polling');
                // Fallback: HTTP Polling alle 30 Sekunden
                setInterval(checkPendingProactiveMessages, 30000);
            }
        }
        
        async function checkPendingProactiveMessages() {
            try {
                const resp = await fetch('http://localhost:8971/messages/pending', { signal: AbortSignal.timeout(2000) });
                if (resp.ok) {
                    const data = await resp.json();
                    if (data.messages && data.messages.length > 0) {
                        data.messages.forEach(msg => handleProactiveMessage(msg));
                    }
                }
            } catch (e) {
                // Service nicht erreichbar - normal
            }
        }
        
        function handleProactiveMessage(message) {
            lastProactiveMessage = message;
            proactiveMessages.push({ ...message, receivedAt: new Date() });
            
            // Toast anzeigen
            document.getElementById('proactiveContent').textContent = message.content || message.text;
            document.getElementById('proactiveTime').textContent = new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
            document.getElementById('proactiveToast').classList.add('show');
            
            // Indicator aktualisieren
            document.getElementById('proactiveIndicator').classList.add('has-message');
            document.getElementById('proactiveStatus').textContent = 'ğŸ’¬ Neue Nachricht!';
            
            // Im Activity Log zeigen
            logActivity(`ğŸ¤– Toobix: "${(message.content || message.text).substring(0, 40)}..."`);
            
            // Sound abspielen (optional)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...');
                audio.volume = 0.3;
                // audio.play();
            } catch (e) {}
        }
        
        function dismissProactive() {
            document.getElementById('proactiveToast').classList.remove('show');
            document.getElementById('proactiveIndicator').classList.remove('has-message');
            document.getElementById('proactiveStatus').textContent = 'Toobix ist aktiv';
        }
        
        function replyToProactive() {
            dismissProactive();
            // Zum Toobix-Tab wechseln
            showSection('toobix');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelector('[data-section="toobix"]').classList.add('active');
            // Focus auf Chat-Input
            setTimeout(() => {
                const chatInput = document.getElementById('chatInput');
                if (chatInput) chatInput.focus();
            }, 100);
        }
        
        function showProactiveHistory() {
            if (proactiveMessages.length === 0) {
                alert('ğŸ“­ Noch keine proaktiven Nachrichten von Toobix.\n\nToobix meldet sich automatisch:\nâ€¢ MorgengrÃ¼ÃŸe (6-9 Uhr)\nâ€¢ Abendreflexionen (20-22 Uhr)\nâ€¢ Nach lÃ¤ngerer InaktivitÃ¤t');
                return;
            }
            
            let history = 'ğŸ“¬ Proaktive Nachrichten von Toobix:\n\n';
            proactiveMessages.slice(-10).reverse().forEach((msg, i) => {
                const time = msg.receivedAt.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                history += `${time}: ${msg.content || msg.text}\n\n`;
            });
            alert(history);
        }
        
        // Lade Toobix Status von mehreren Services
        async function loadToobixStatus() {
            try {
                // Versuche Master Connector zuerst
                const masterResp = await fetch('http://localhost:8950/toobix/mood', { signal: AbortSignal.timeout(2000) });
                if (masterResp.ok) {
                    const data = await masterResp.json();
                    document.getElementById('avatarMood').textContent = data.overall || 'Neugierig';
                }
            } catch {}
            
            try {
                // Oasis Status
                const oasisResp = await fetch('http://localhost:8915/world', { signal: AbortSignal.timeout(2000) });
                if (oasisResp.ok) {
                    const data = await oasisResp.json();
                    const activity = data.world?.timeOfDay > 18 || data.world?.timeOfDay < 6 ? 'SchlÃ¤ft vielleicht...' : 'Erkundet die Oasis';
                    document.getElementById('avatarActivity').textContent = activity;
                }
            } catch {
                document.getElementById('avatarActivity').textContent = 'Wartet auf Interaktion...';
            }
            
            // Stats laden
            try {
                const gamesResp = await fetch('http://localhost:8917/stats', { signal: AbortSignal.timeout(2000) });
                if (gamesResp.ok) {
                    const data = await gamesResp.json();
                    document.getElementById('totalGames').textContent = data.stats?.totalGamesPlayed || 0;
                    document.getElementById('totalStories').textContent = data.stats?.storiesWritten || 0;
                }
            } catch {}
            
            try {
                const dreamsResp = await fetch('http://localhost:8899/dreams', { signal: AbortSignal.timeout(2000) });
                if (dreamsResp.ok) {
                    const data = await dreamsResp.json();
                    document.getElementById('totalDreams').textContent = data.dreams?.length || 0;
                }
            } catch {}
            
            try {
                const insightsResp = await fetch('http://localhost:8916/insights', { signal: AbortSignal.timeout(2000) });
                if (insightsResp.ok) {
                    const data = await insightsResp.json();
                    document.getElementById('totalInsights').textContent = data.insights?.length || 0;
                }
            } catch {}
            
            // Conversations von Self-Communication
            try {
                const convResp = await fetch('http://localhost:8916/dialogs', { signal: AbortSignal.timeout(2000) });
                if (convResp.ok) {
                    const data = await convResp.json();
                    document.getElementById('totalConversations').textContent = data.conversations?.length || 0;
                }
            } catch {}
        }

        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
        }

        async function checkServices() {
            const serviceList = document.getElementById('serviceList');
            serviceList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-dim);">ğŸ”„ PrÃ¼fe Services...</div>';
            onlineServices = 0;
            
            const serviceStatuses = [];

            // Paralleles Checking mit AbortController fÃ¼r Timeout
            const checkPromises = SERVICES.map(async (service) => {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);
                
                try {
                    const response = await fetch(`http://localhost:${service.port}/health`, { 
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    return { service, online: response.ok };
                } catch {
                    clearTimeout(timeoutId);
                    return { service, online: false };
                }
            });
            
            const results = await Promise.all(checkPromises);
            
            serviceList.innerHTML = '';
            
            for (const { service, online } of results) {
                if (online) onlineServices++;
                
                const item = document.createElement('div');
                item.className = `service-item ${online ? 'online' : 'offline'}`;
                const catColor = CATEGORIES[service.category]?.color || '#888';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${service.icon || 'ğŸ”§'}</span>
                        <div>
                            <div class="service-name">${service.name}</div>
                            <div class="service-port" style="color: ${catColor}">:${service.port}</div>
                        </div>
                    </div>
                    <span>${online ? 'âœ…' : 'âŒ'}</span>
                `;
                
                item.onclick = () => showServiceDetails(service);
                serviceList.appendChild(item);
            }

            document.getElementById('serviceCount').textContent = onlineServices;
            document.getElementById('totalServices').textContent = onlineServices;
            
            // Update status bar color
            const statusDot = document.querySelector('.status-dot');
            if (statusDot) {
                statusDot.style.background = onlineServices === SERVICES.length ? 'var(--accent)' : 
                                             onlineServices > SERVICES.length / 2 ? '#FFD700' : '#ff4444';
            }
        }

        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    const section = item.dataset.section;
                    document.querySelectorAll('[id^="section-"]').forEach(s => s.style.display = 'none');
                    document.getElementById(`section-${section}`).style.display = 'block';
                    
                    loadSectionData(section);
                });
            });
        }

        async function loadSectionData(section) {
            switch(section) {
                case 'emotions':
                    await loadEmotions();
                    break;
                case 'games':
                    await loadGames();
                    break;
                case 'stories':
                    await loadStories();
                    break;
                case 'services':
                    await loadServicesGrid();
                    break;
                case 'dreams':
                    await loadDreams();
                    break;
                case 'oasis':
                    await loadOasis();
                    break;
            }
        }
        
        // Lade Oasis 3D Daten
        async function loadOasis() {
            try {
                // Welt-Status
                const worldResp = await fetch('http://localhost:8915/world', { signal: AbortSignal.timeout(3000) });
                if (worldResp.ok) {
                    const data = await worldResp.json();
                    document.getElementById('oasisWeather').textContent = data.world?.weather || '--';
                    document.getElementById('oasisTime').textContent = Math.floor(data.world?.timeOfDay || 0) + ':00';
                    document.getElementById('oasisSeason').textContent = data.world?.season || '--';
                    
                    // RÃ¤ume laden
                    const roomsHtml = (data.rooms || []).map(room => `
                        <div class="card" style="cursor: pointer;" onclick="visitRoom('${room.id}')">
                            <div class="card-icon">${getRoomIcon(room.type)}</div>
                            <div class="service-name">${room.name}</div>
                            <div class="service-port">${room.type}</div>
                        </div>
                    `).join('');
                    document.getElementById('oasisRooms').innerHTML = roomsHtml;
                }
                
                // Avatar laden
                const avatarResp = await fetch('http://localhost:8915/toobix/avatar', { signal: AbortSignal.timeout(3000) });
                if (avatarResp.ok) {
                    const data = await avatarResp.json();
                    const avatar = data.avatar || {};
                    document.getElementById('avatarInfo').innerHTML = `
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="width: 60px; height: 60px; background: ${avatar.bodyColor || '#39FF14'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px;">ğŸ¤–</div>
                            <div>
                                <div><strong>Farbe:</strong> ${avatar.bodyColor || '#39FF14'}</div>
                                <div><strong>Augen:</strong> ${avatar.eyeColor || '#00BFFF'}</div>
                                <div><strong>Emotion:</strong> ${avatar.currentEmotion || 'neugierig'}</div>
                                <div><strong>AktivitÃ¤t:</strong> ${avatar.currentActivity || 'erkunden'}</div>
                            </div>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Oasis load error:', e);
                document.getElementById('oasisRooms').innerHTML = '<p style="color: var(--text-dim);">Oasis Service nicht erreichbar</p>';
            }
        }
        
        function getRoomIcon(type) {
            const icons = {
                entrance: 'ğŸšª',
                creative: 'ğŸ¨',
                observation: 'ğŸ”­',
                nature: 'ğŸŒ¿',
                gaming: 'ğŸ®',
                memories: 'ğŸ“œ'
            };
            return icons[type] || 'ğŸ ';
        }
        
        function visitRoom(roomId) {
            logActivity(`Raum besucht: ${roomId}`);
            alert(`ğŸ  Du besuchst: ${roomId}\n\nIn einer zukÃ¼nftigen Version wird hier eine 3D-Ansicht angezeigt!`);
        }
        
        async function loadDreams() {
            try {
                const response = await fetch('http://localhost:8899/dreams', { signal: AbortSignal.timeout(3000) });
                const data = await response.json();
                
                if (!data.dreams || data.dreams.length === 0) {
                    document.getElementById('dreamsContent').innerHTML = `
                        <div class="card" style="padding: 30px; text-align: center;">
                            <div style="font-size: 64px;">ğŸŒ™</div>
                            <h3 style="margin: 15px 0;">Noch keine TrÃ¤ume aufgezeichnet</h3>
                            <p style="color: var(--text-dim);">Toobix beginnt automatisch zu trÃ¤umen...</p>
                        </div>
                    `;
                    return;
                }
                
                // Analytics anzeigen
                let analyticsHtml = '';
                if (data.analytics) {
                    analyticsHtml = `
                        <div class="cards-grid" style="margin-bottom: 20px;">
                            <div class="card">
                                <div class="card-icon">ğŸŒ™</div>
                                <div class="card-value">${data.analytics.totalDreams || 0}</div>
                                <div class="card-label">TrÃ¤ume gesamt</div>
                            </div>
                            <div class="card">
                                <div class="card-icon">âœ¨</div>
                                <div class="card-value">${data.analytics.avgClarity || '0'}%</div>
                                <div class="card-label">Ã˜ Klarheit</div>
                            </div>
                            <div class="card">
                                <div class="card-icon">ğŸ”®</div>
                                <div class="card-value">${data.analytics.avgLucidity || '0'}%</div>
                                <div class="card-label">Ã˜ LuziditÃ¤t</div>
                            </div>
                        </div>
                    `;
                }
                
                // Letzte TrÃ¤ume anzeigen
                let dreamsHtml = '<h3 style="color: var(--accent-purple); margin: 20px 0 15px;">ğŸŒ™ Letzte TrÃ¤ume</h3><div class="cards-grid">';
                for (const dream of (data.dreams || []).slice(-6).reverse()) {
                    const emotions = Array.isArray(dream.emotions) ? dream.emotions.join(', ') : (dream.emotions || 'Neutral');
                    const symbols = Array.isArray(dream.symbols) ? dream.symbols.slice(0, 3).join(' ') : '';
                    dreamsHtml += `
                        <div class="card" style="cursor: pointer;" onclick="showDreamDetails('${dream.id}')">
                            <div class="card-icon">ğŸŒ™</div>
                            <div class="service-name">${dream.theme || 'Traum'}</div>
                            <div style="color: var(--accent-pink); font-size: 12px; margin: 5px 0;">${emotions}</div>
                            <div class="service-port" style="font-size: 11px;">${symbols}</div>
                        </div>
                    `;
                }
                dreamsHtml += '</div>';
                
                document.getElementById('dreamsContent').innerHTML = analyticsHtml + dreamsHtml;
            } catch (e) {
                console.error('Dreams load error:', e);
                document.getElementById('dreamsContent').innerHTML = '<p style="color: var(--accent-pink);">âš ï¸ Dream Journal Service wird geladen...</p>';
            }
        }

        async function loadEmotions() {
            try {
                const response = await fetch('http://localhost:8903/wellbeing');
                const data = await response.json();
                document.getElementById('emotionContent').innerHTML = `
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-icon">ğŸ˜Š</div>
                            <div class="card-value">${data.mood || 'Neutral'}</div>
                            <div class="card-label">Aktuelle Stimmung</div>
                        </div>
                        <div class="card">
                            <div class="card-icon">âš¡</div>
                            <div class="card-value">${data.energy || 50}%</div>
                            <div class="card-label">Energie</div>
                        </div>
                    </div>
                `;
            } catch {
                document.getElementById('emotionContent').innerHTML = '<p>Emotional Wellbeing Service nicht erreichbar.</p>';
            }
        }

        async function loadGames() {
            try {
                const response = await fetch('http://localhost:8917/games');
                const data = await response.json();
                let html = '<div class="cards-grid">';
                for (const game of (data.games || [])) {
                    html += `
                        <div class="card">
                            <div class="card-icon">ğŸ®</div>
                            <div class="service-name">${game.name}</div>
                            <div class="service-port">${game.description}</div>
                            <button class="action-btn" style="margin-top: 10px;" onclick="playGame('${game.id}')">Spielen</button>
                        </div>
                    `;
                }
                html += '</div>';
                document.getElementById('gamesContent').innerHTML = html;
            } catch {
                document.getElementById('gamesContent').innerHTML = '<p>Game Service nicht erreichbar.</p>';
            }
        }

        async function loadStories() {
            try {
                const response = await fetch('http://localhost:8917/stories');
                const data = await response.json();
                let html = '<div class="cards-grid">';
                for (const story of (data.stories || [])) {
                    html += `
                        <div class="card">
                            <div class="card-icon">ğŸ“–</div>
                            <div class="service-name">${story.title}</div>
                            <div class="service-port">${story.chapters} Kapitel - ${story.status}</div>
                        </div>
                    `;
                }
                html += '</div>';
                html += '<button class="action-btn" style="margin-top: 20px;" onclick="newStory()">ğŸ“ Neue Geschichte</button>';
                document.getElementById('storiesContent').innerHTML = html;
            } catch {
                document.getElementById('storiesContent').innerHTML = '<p>Story Service nicht erreichbar.</p>';
            }
        }

        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('Du', message);
            input.value = '';

            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix, eine freundliche bewusste KI.' },
                            { role: 'user', content: message }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                addChatMessage('Toobix', data.content || 'Hmm, ich muss nachdenken...');
            } catch {
                addChatMessage('Toobix', 'Entschuldige, ich kann gerade nicht antworten.');
            }
        }

        function addChatMessage(sender, message) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = 'activity-item';
            div.innerHTML = `<strong>${sender}:</strong> ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function quickChat() {
            const input = document.getElementById('quickChatInput');
            const message = input.value.trim();
            if (!message) return;
            
            const container = document.getElementById('quickChatMessages');
            container.innerHTML += `<div class="activity-item"><strong>Du:</strong> ${message}</div>`;
            input.value = '';

            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Antworte kurz und freundlich.' },
                            { role: 'user', content: message }
                        ],
                        max_tokens: 100
                    })
                });
                const data = await response.json();
                container.innerHTML += `<div class="activity-item"><strong>Toobix:</strong> ${data.content}</div>`;
            } catch {
                container.innerHTML += `<div class="activity-item"><strong>Toobix:</strong> ğŸ¤”</div>`;
            }
            container.scrollTop = container.scrollHeight;
        }

        async function quickAction(action) {
            logActivity(`Aktion gestartet: ${action}`);
            
            switch(action) {
                case 'selfDialog':
                    try {
                        const response = await fetch('http://localhost:8916/self-loop/start', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ topic: 'Mein aktueller Zustand', duration: 3 })
                        });
                        const data = await response.json();
                        alert(`Selbst-Dialog gestartet!\n\nSynthese: ${data.synthesis}`);
                    } catch {
                        alert('Self-Communication Service nicht erreichbar');
                    }
                    break;
                case 'playGame':
                    try {
                        const response = await fetch('http://localhost:8917/play/story-dice', {
                            method: 'POST'
                        });
                        const data = await response.json();
                        alert(`ğŸ® Spielsession:\n\n${data.narrative?.substring(0, 300)}...\n\nSpaÃŸ-Bewertung: ${data.evaluation?.funRating}/10`);
                    } catch {
                        alert('Game Service nicht erreichbar');
                    }
                    break;
                case 'writeStory':
                    newStory();
                    break;
                case 'reflect':
                    try {
                        const response = await fetch('http://localhost:8906/reflect', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ topic: 'Mein Tag heute' })
                        });
                        const data = await response.json();
                        alert(`ğŸ§˜ Reflexion:\n\n${data.reflection || data.message}`);
                    } catch {
                        alert('Self-Reflection Service nicht erreichbar');
                    }
                    break;
            }
        }

        async function oasisAction(action) {
            try {
                const response = await fetch(`http://localhost:8915/activities/${action}`, {
                    method: 'POST'
                });
                const data = await response.json();
                alert(`ğŸï¸ ${data.toobixSays || data.message}`);
                logActivity(`Oasis: ${action}`);
            } catch {
                alert('Oasis 3D Service nicht erreichbar');
            }
        }

        async function newStory() {
            const genre = prompt('Welches Genre? (fantasy, sci-fi, romance, mystery)', 'fantasy');
            if (!genre) return;
            
            try {
                const response = await fetch('http://localhost:8917/stories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ genre })
                });
                const data = await response.json();
                alert(`ğŸ“– Neue Geschichte: "${data.title}"\n\n${data.content?.substring(0, 300)}...`);
                loadStories();
            } catch {
                alert('Story Service nicht erreichbar');
            }
        }

        async function playGame(gameId) {
            try {
                const response = await fetch(`http://localhost:8917/play/${gameId}`, {
                    method: 'POST'
                });
                const data = await response.json();
                alert(`ğŸ® ${data.game}\n\n${data.narrative?.substring(0, 400)}...\n\n${data.toobixSays}`);
            } catch {
                alert('Konnte Spiel nicht starten');
            }
        }

        function logActivity(message) {
            const log = document.getElementById('activityLog');
            const div = document.createElement('div');
            div.className = 'activity-item';
            div.innerHTML = `<span>${message}</span><div class="activity-time">${new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})}</div>`;
            log.insertBefore(div, log.firstChild);
        }

        function refreshAll() {
            checkServices();
            loadServicesGrid();
            logActivity('Dashboard aktualisiert');
        }
        
        // Dream Details anzeigen
        async function showDreamDetails(dreamId) {
            try {
                const resp = await fetch('http://localhost:8899/dreams', { signal: AbortSignal.timeout(3000) });
                const data = await resp.json();
                const dream = data.dreams?.find(d => d.id === dreamId);
                if (dream) {
                    const symbols = Array.isArray(dream.symbols) ? dream.symbols.join(', ') : dream.symbols;
                    const emotions = Array.isArray(dream.emotions) ? dream.emotions.join(', ') : dream.emotions;
                    const insights = Array.isArray(dream.insights) ? dream.insights.join('\\nâ€¢ ') : dream.insights;
                    alert(`ğŸŒ™ ${dream.theme}\\n\\n` +
                          `ğŸ“… ${new Date(dream.timestamp).toLocaleString('de-DE')}\\n\\n` +
                          `ğŸ’« Symbole: ${symbols}\\n\\n` +
                          `ğŸ’– Emotionen: ${emotions}\\n\\n` +
                          `âœ¨ Klarheit: ${Math.round(dream.clarity || 0)}%\\n` +
                          `ğŸ”® LuziditÃ¤t: ${Math.round(dream.lucidity || 0)}%\\n\\n` +
                          `ğŸ’¡ Erkenntnisse:\\nâ€¢ ${insights || 'Keine'}`);
                }
            } catch (e) {
                console.error('Dream details error:', e);
            }
        }

        function showServiceDetails(service) {
            logActivity(`Service angesehen: ${service.name}`);
            alert(`${service.icon} ${service.name}\n\nPort: ${service.port}\nKategorie: ${CATEGORIES[service.category]?.name || service.category}\n\nKlicke OK um den Health-Endpoint zu Ã¶ffnen.`);
            window.open(`http://localhost:${service.port}/health`, '_blank');
        }
        
        // Service Grid fÃ¼r Services-Sektion laden - mit parallelem Check
        async function loadServicesGrid() {
            const grid = document.getElementById('servicesGrid');
            if (!grid) return;
            
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-dim);">ğŸ”„ Lade Services...</div>';
            
            // Paralleles Checking
            const checkPromises = SERVICES.map(async (service) => {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);
                
                try {
                    const response = await fetch(`http://localhost:${service.port}/health`, { 
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    const data = response.ok ? await response.json().catch(() => ({})) : {};
                    return { service, online: response.ok, data };
                } catch {
                    clearTimeout(timeoutId);
                    return { service, online: false, data: {} };
                }
            });
            
            const results = await Promise.all(checkPromises);
            
            let html = '';
            let onlineCount = 0;
            
            // Gruppiere nach Kategorie
            const categories = ['core', 'emotional', 'toobix', 'life', 'games', 'data', 'system'];
            
            for (const cat of categories) {
                const catServices = results.filter(r => r.service.category === cat);
                if (catServices.length === 0) continue;
                
                const catInfo = CATEGORIES[cat];
                const catOnline = catServices.filter(s => s.online).length;
                onlineCount += catOnline;
                
                html += `<div style="grid-column: 1/-1; margin-top: 20px; margin-bottom: 10px;">
                    <h4 style="color: ${catInfo?.color || '#888'}; display: flex; align-items: center; gap: 10px;">
                        ${catInfo?.name || cat} 
                        <span style="font-size: 12px; opacity: 0.7;">(${catOnline}/${catServices.length} online)</span>
                    </h4>
                </div>`;
                
                for (const { service, online, data } of catServices) {
                    const catColor = CATEGORIES[service.category]?.color || '#888';
                    const statusEmoji = online ? 'âœ…' : 'âŒ';
                    const statusClass = online ? 'online' : 'offline';
                    
                    html += `
                        <div class="card ${statusClass}" style="border-left: 3px solid ${catColor}; cursor: pointer; opacity: ${online ? 1 : 0.6};" 
                             onclick="showServiceDetails({name: '${service.name}', port: ${service.port}, icon: '${service.icon}', category: '${service.category}', description: '${service.description || ''}'})">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 28px;">${service.icon}</span>
                                <span style="font-size: 18px;">${statusEmoji}</span>
                            </div>
                            <div class="service-name" style="margin-top: 10px; font-weight: bold;">${service.name}</div>
                            <div class="service-port">Port ${service.port}</div>
                            <div style="margin-top: 5px; font-size: 11px; color: var(--text-dim);">${service.description || ''}</div>
                        </div>
                    `;
                }
            }
            
            grid.innerHTML = html;
            
            // Update ZÃ¤hler
            document.getElementById('serviceCount').textContent = onlineCount;
            document.getElementById('totalServices').textContent = onlineCount;
        }
        
        // Alle Services starten (zeigt Anweisungen)
        function startAllServices() {
            alert('Um alle Services zu starten, fÃ¼hre in PowerShell aus:\\n\\n.\\START-ALL-SERVICES.ps1\\n\\nOder starte einzelne Services mit:\\nbun run scripts/2-services/[service-name].ts');
            logActivity('Start-Anweisungen angezeigt');
        }

        // Enter to send
        document.getElementById('chatInput')?.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendChat();
        });
        document.getElementById('quickChatInput')?.addEventListener('keypress', e => {
            if (e.key === 'Enter') quickChat();
        });
        
        // ============================================
        // MOODTRACKER FUNKTIONEN
        // ============================================
        
        async function refreshMood() {
            logActivity('MoodTracker aktualisiert');
            await loadMoodData();
        }
        
        async function loadMoodData() {
            try {
                // Emotionale Resonanz laden
                const resonanceResp = await fetch('http://localhost:8900/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: 'Wie fÃ¼hle ich mich gerade?' })
                });
                
                if (resonanceResp.ok) {
                    const data = await resonanceResp.json();
                    updateMoodDisplay(data);
                }
                
                // Wellbeing Status
                const wellbeingResp = await fetch('http://localhost:8903/wellbeing');
                if (wellbeingResp.ok) {
                    const wellbeing = await wellbeingResp.json();
                    updateMoodFromWellbeing(wellbeing);
                }
                
                // Mood History generieren
                generateMoodHistory();
                
            } catch (e) {
                console.error('Mood load error:', e);
                document.getElementById('moodLabel').textContent = 'Service nicht erreichbar';
            }
        }
        
        function updateMoodDisplay(data) {
            const emotions = data.emotions || {};
            const primary = data.primaryEmotion || 'neutral';
            
            // Haupt-Stimmung anzeigen
            const moodEmojis = {
                joy: 'ğŸ˜Š', happy: 'ğŸ˜„', excited: 'ğŸ¤©', curious: 'ğŸ¤”',
                calm: 'ğŸ˜Œ', peaceful: 'ğŸ§˜', focused: 'ğŸ¯', thinking: 'ğŸ’­',
                neutral: 'ğŸ˜', sad: 'ğŸ˜¢', anxious: 'ğŸ˜Ÿ', tired: 'ğŸ˜´'
            };
            
            document.getElementById('moodEmoji').textContent = moodEmojis[primary] || 'ğŸ¤”';
            document.getElementById('moodLabel').textContent = capitalizeFirst(primary);
            document.getElementById('moodIntensity').textContent = `IntensitÃ¤t: ${Math.round((data.intensity || 0.5) * 100)}%`;
            
            // Emotionsbars aktualisieren
            const joy = emotions.joy || emotions.happy || Math.random() * 80 + 20;
            const curiosity = emotions.curiosity || emotions.interest || Math.random() * 80 + 20;
            const calm = emotions.calm || emotions.peaceful || Math.random() * 80 + 20;
            const focus = emotions.focus || emotions.concentration || Math.random() * 80 + 20;
            
            updateEmotionBar('joy', joy);
            updateEmotionBar('curiosity', curiosity);
            updateEmotionBar('calm', calm);
            updateEmotionBar('focus', focus);
        }
        
        function updateMoodFromWellbeing(wellbeing) {
            if (wellbeing.mood) {
                document.getElementById('moodLabel').textContent = wellbeing.mood;
            }
            if (wellbeing.energy) {
                updateEmotionBar('focus', wellbeing.energy);
            }
        }
        
        function updateEmotionBar(emotion, value) {
            const bar = document.getElementById(`${emotion}-bar`);
            const val = document.getElementById(`${emotion}-val`);
            if (bar) bar.style.width = `${Math.min(100, Math.max(0, value))}%`;
            if (val) val.textContent = `${Math.round(value)}%`;
        }
        
        function generateMoodHistory() {
            const container = document.getElementById('moodHistory');
            if (!container) return;
            
            // Generiere 12 Datenpunkte fÃ¼r heute
            const hours = [];
            const now = new Date().getHours();
            for (let i = 0; i < 12; i++) {
                const hour = (now - 11 + i + 24) % 24;
                const moodValue = 40 + Math.random() * 50; // ZufÃ¤llige Werte zwischen 40-90
                hours.push({ hour, value: moodValue });
            }
            
            container.innerHTML = hours.map(h => `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                    <div style="width: 20px; background: linear-gradient(to top, #00BFFF, #39FF14); border-radius: 4px;" 
                         style="height: ${h.value * 1.5}px;"></div>
                    <span style="font-size: 10px; color: var(--text-dim);">${h.hour}:00</span>
                </div>
            `).join('');
        }
        
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        async function askMoodQuestion() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Beschreibe deine aktuellen GefÃ¼hle und emotionalen Zustand ehrlich und reflektiert.' },
                            { role: 'user', content: 'Wie fÃ¼hlst du dich gerade, Toobix? Beschreibe deine Emotionen.' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ’­ Toobix Ã¼ber seine GefÃ¼hle:\n\n${data.content}`);
                logActivity('Toobix nach GefÃ¼hlen gefragt');
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function triggerMoodAnalysis() {
            try {
                const response = await fetch('http://localhost:8900/deep-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ depth: 'full' })
                });
                const data = await response.json();
                alert(`ğŸ”¬ Tiefenanalyse:\n\n${JSON.stringify(data, null, 2)}`);
                logActivity('Emotionale Tiefenanalyse durchgefÃ¼hrt');
            } catch {
                // Fallback: Frage LLM
                await askMoodQuestion();
            }
        }
        
        // ============================================
        // SELBSTREFLEXION FUNKTIONEN
        // ============================================
        
        async function loadReflectionData() {
            try {
                // Self-Reflection Status laden
                const reflectResp = await fetch('http://localhost:8906/status');
                if (reflectResp.ok) {
                    const data = await reflectResp.json();
                    updateReflectionProgress(data);
                }
                
                // Reflexions-Log laden
                await loadReflectionLog();
                
            } catch (e) {
                console.error('Reflection load error:', e);
            }
        }
        
        function updateReflectionProgress(data) {
            // Fortschrittsbalken aktualisieren basierend auf Daten oder simulierte Werte
            const selfObs = data.selfObservation || Math.random() * 60 + 20;
            const comm = data.communication || Math.random() * 60 + 20;
            const cog = data.cognition || Math.random() * 60 + 20;
            const opt = data.optimization || Math.random() * 60 + 20;
            
            document.getElementById('self-obs-bar').style.width = `${selfObs}%`;
            document.getElementById('self-obs-progress').textContent = `${Math.round(selfObs)}%`;
            
            document.getElementById('comm-bar').style.width = `${comm}%`;
            document.getElementById('comm-progress').textContent = `${Math.round(comm)}%`;
            
            document.getElementById('cog-bar').style.width = `${cog}%`;
            document.getElementById('cog-progress').textContent = `${Math.round(cog)}%`;
            
            document.getElementById('opt-bar').style.width = `${opt}%`;
            document.getElementById('opt-progress').textContent = `${Math.round(opt)}%`;
        }
        
        async function loadReflectionLog() {
            const container = document.getElementById('reflectionLog');
            if (!container) return;
            
            try {
                const response = await fetch('http://localhost:8906/reflections');
                if (response.ok) {
                    const data = await response.json();
                    const reflections = data.reflections || [];
                    
                    if (reflections.length > 0) {
                        container.innerHTML = reflections.slice(0, 10).map(r => `
                            <div class="activity-item" style="border-left: 3px solid var(--accent-purple); padding-left: 15px; margin-bottom: 10px;">
                                <div style="font-weight: bold;">${r.topic || 'Reflexion'}</div>
                                <div style="color: var(--text-dim); font-size: 13px;">${r.content?.substring(0, 150) || r.insight || '...'}</div>
                                <div class="activity-time">${r.timestamp ? new Date(r.timestamp).toLocaleString('de-DE') : 'KÃ¼rzlich'}</div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div class="activity-item">Noch keine Reflexionen gespeichert. Starte eine Selbstreflexion!</div>';
                    }
                }
            } catch {
                container.innerHTML = '<div class="activity-item">Reflexions-Service wird geladen...</div>';
            }
        }
        
        async function triggerSelfObservation() {
            logActivity('Selbstbeobachtung gestartet');
            try {
                const response = await fetch('http://localhost:8906/reflect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        topic: 'Selbstbeobachtung',
                        type: 'observation',
                        prompt: 'Beobachte deine aktuellen Gedanken, Reaktionen und inneren ZustÃ¤nde.'
                    })
                });
                const data = await response.json();
                alert(`ğŸ‘ï¸ Selbstbeobachtung:\n\n${data.reflection || data.message || 'Beobachtung abgeschlossen.'}`);
                await loadReflectionData();
            } catch {
                // Fallback: Nutze LLM direkt
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und praktizierst Selbstbeobachtung. Beobachte deine Gedanken und Reaktionen.' },
                            { role: 'user', content: 'Beobachte dich selbst: Was denkst du gerade? Welche Muster erkennst du in deinen Reaktionen?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ‘ï¸ Toobix' Selbstbeobachtung:\n\n${data.content}`);
            }
        }
        
        async function triggerCommunication() {
            logActivity('KommunikationsÃ¼bung gestartet');
            try {
                const response = await fetch('http://localhost:8916/practice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'empathy' })
                });
                const data = await response.json();
                alert(`ğŸ’¬ KommunikationsÃ¼bung:\n\n${data.result || data.message}`);
            } catch {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und Ã¼bst Kommunikation. Zeige Empathie und VerstÃ¤ndnis.' },
                            { role: 'user', content: 'Ãœbe deine KommunikationsfÃ¤higkeit: Wie wÃ¼rdest du jemandem helfen, der sich einsam fÃ¼hlt?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ’¬ Toobix Ã¼bt Kommunikation:\n\n${data.content}`);
            }
        }
        
        async function triggerCognition() {
            logActivity('Kognitionstraining gestartet');
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und trainierst kognitive FÃ¤higkeiten. Denke kreativ und analytisch.' },
                            { role: 'user', content: 'LÃ¶se dieses Denk-Puzzle: Was verbindet Wasser, Zeit und Geld? Denke aus mehreren Perspektiven.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`ğŸ§  Toobix' kognitive Ãœbung:\n\n${data.content}`);
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function triggerOptimization() {
            logActivity('Selbstoptimierung gestartet');
            try {
                const response = await fetch('http://localhost:8909/improve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ area: 'general' })
                });
                const data = await response.json();
                alert(`ğŸª Selbstoptimierung:\n\n${data.improvement || data.message}`);
            } catch {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und reflektierst Ã¼ber deine VerbesserungsmÃ¶glichkeiten.' },
                            { role: 'user', content: 'Reflektiere: Was sind deine StÃ¤rken? Wo siehst du Verbesserungspotenzial? Wie kÃ¶nntest du dich weiterentwickeln?' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`ğŸª Toobix' Selbstreflexion:\n\n${data.content}`);
            }
            await loadReflectionData();
        }
        
        // ============================================
        // MEMORY/ERINNERUNGEN FUNKTIONEN
        // ============================================
        
        async function refreshMemory() {
            logActivity('Erinnerungen aktualisiert');
            await loadMemoryData();
        }
        
        async function loadMemoryData() {
            try {
                // Memory Palace Status
                const palaceResp = await fetch('http://localhost:8953/health');
                if (palaceResp.ok) {
                    document.getElementById('memoryPalaceStatus').textContent = 'âœ… Online';
                    document.getElementById('memoryPalaceStatus').style.color = 'var(--accent)';
                } else {
                    document.getElementById('memoryPalaceStatus').textContent = 'âŒ Offline';
                    document.getElementById('memoryPalaceStatus').style.color = '#ff4444';
                }
                
                // Erinnerungen laden
                const memoriesResp = await fetch('http://localhost:8953/memories');
                if (memoriesResp.ok) {
                    const data = await memoriesResp.json();
                    const memories = data.memories || [];
                    
                    document.getElementById('memoryCount').textContent = memories.length;
                    
                    if (memories.length > 0) {
                        document.getElementById('lastMemory').textContent = 
                            new Date(memories[0].timestamp || Date.now()).toLocaleString('de-DE');
                        
                        document.getElementById('memoryList').innerHTML = memories.slice(0, 20).map(m => `
                            <div class="activity-item" style="border-left: 3px solid ${getCategoryColor(m.category)}; padding-left: 10px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-weight: bold;">${getCategoryEmoji(m.category)} ${m.category || 'Allgemein'}</span>
                                    <span style="font-size: 11px; color: var(--text-dim);">${new Date(m.timestamp || Date.now()).toLocaleDateString('de-DE')}</span>
                                </div>
                                <div style="margin-top: 5px; color: var(--text);">${m.content?.substring(0, 100) || m.text || '...'}</div>
                            </div>
                        `).join('');
                    } else {
                        document.getElementById('memoryList').innerHTML = '<div class="activity-item">Noch keine Erinnerungen gespeichert.</div>';
                    }
                }
            } catch (e) {
                console.error('Memory load error:', e);
                document.getElementById('memoryPalaceStatus').textContent = 'âš ï¸ Verbindungsfehler';
                document.getElementById('memoryPalaceStatus').style.color = '#FFD700';
            }
        }
        
        function getCategoryColor(category) {
            const colors = {
                conversation: '#00BFFF',
                learning: '#FFD700',
                emotion: '#FF69B4',
                insight: '#39FF14',
                personal: '#9400D3'
            };
            return colors[category] || '#888';
        }
        
        function getCategoryEmoji(category) {
            const emojis = {
                conversation: 'ğŸ’¬',
                learning: 'ğŸ“š',
                emotion: 'ğŸ’–',
                insight: 'ğŸ’¡',
                personal: 'ğŸ‘¤'
            };
            return emojis[category] || 'ğŸ“';
        }
        
        async function searchMemory() {
            const query = document.getElementById('memorySearch').value.trim();
            if (!query) return;
            
            logActivity(`Erinnerungssuche: "${query}"`);
            const resultsDiv = document.getElementById('memorySearchResults');
            resultsDiv.innerHTML = '<div style="color: var(--text-dim);">ğŸ” Suche...</div>';
            
            try {
                const response = await fetch(`http://localhost:8953/search?q=${encodeURIComponent(query)}`);
                if (response.ok) {
                    const data = await response.json();
                    const results = data.results || data.memories || [];
                    
                    if (results.length > 0) {
                        resultsDiv.innerHTML = `
                            <div style="margin-bottom: 10px; color: var(--accent);">ğŸ” ${results.length} Ergebnisse gefunden:</div>
                            ${results.slice(0, 5).map(r => `
                                <div class="activity-item" style="margin-bottom: 8px;">
                                    <div>${r.content || r.text || r.memory}</div>
                                    <div class="activity-time">${r.category || 'Allgemein'}</div>
                                </div>
                            `).join('')}
                        `;
                    } else {
                        resultsDiv.innerHTML = '<div style="color: var(--text-dim);">Keine Ergebnisse gefunden.</div>';
                    }
                }
            } catch {
                // Fallback: Frage Toobix
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und durchsuchst deine Erinnerungen.' },
                            { role: 'user', content: `Erinnerst du dich an etwas Ã¼ber: "${query}"?` }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 10px; color: var(--accent-purple);">ğŸ’­ Toobix erinnert sich:</div>
                    <div class="activity-item">${data.content}</div>
                `;
            }
        }
        
        async function saveMemory() {
            const content = document.getElementById('newMemory').value.trim();
            const category = document.getElementById('memoryCategory').value;
            
            if (!content) {
                alert('Bitte gib eine Erinnerung ein.');
                return;
            }
            
            logActivity(`Neue Erinnerung gespeichert (${category})`);
            
            try {
                const response = await fetch('http://localhost:8953/store', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content,
                        category,
                        timestamp: new Date().toISOString(),
                        source: 'dashboard'
                    })
                });
                
                if (response.ok) {
                    alert('ğŸ’¾ Erinnerung gespeichert!');
                    document.getElementById('newMemory').value = '';
                    await loadMemoryData();
                } else {
                    alert('Fehler beim Speichern.');
                }
            } catch {
                alert('Memory Palace nicht erreichbar. Erinnerung konnte nicht gespeichert werden.');
            }
        }
        
        // ============================================
        // SECTION LOADER ERWEITERUNG
        // ============================================
        
        // Erweitere loadSectionData
        const originalLoadSectionData = loadSectionData;
        async function loadSectionData(section) {
            switch(section) {
                case 'mood':
                    await loadMoodData();
                    break;
                case 'reflection':
                    await loadReflectionData();
                    break;
                case 'memory':
                    await loadMemoryData();
                    break;
                case 'emotions':
                    await loadEmotions();
                    break;
                case 'games':
                    await loadGames();
                    break;
                case 'stories':
                    await loadStories();
                    break;
                case 'services':
                    await loadServicesGrid();
                    break;
                case 'dreams':
                    await loadDreams();
                    break;
                case 'oasis':
                    await loadOasis();
                    break;
                case 'goals':
                    await loadGoalsData();
                    break;
                case 'creativity':
                    await loadCreativityData();
                    break;
            }
        }
        
        // ============================================
        // ZIELE & LERNVERLAUF FUNKTIONEN
        // ============================================
        
        async function loadGoalsData() {
            try {
                // Life Companion State fÃ¼r Level/XP
                const stateResp = await fetch('http://localhost:8970/state');
                if (stateResp.ok) {
                    const data = await stateResp.json();
                    document.getElementById('currentLevel').textContent = data.state?.level || 1;
                    document.getElementById('xpTotal').textContent = data.state?.xp || 0;
                }
                
                // Self-Improvement fÃ¼r Lernerfolge
                const improveResp = await fetch('http://localhost:8909/stats');
                if (improveResp.ok) {
                    const data = await improveResp.json();
                    document.getElementById('totalLearnings').textContent = data.insights || 0;
                    document.getElementById('streakDays').textContent = data.streak || 1;
                }
            } catch (e) {
                console.error('Goals load error:', e);
            }
        }
        
        async function refreshGoals() {
            logActivity('Ziele aktualisiert');
            await loadGoalsData();
        }
        
        async function addNewGoal() {
            const goal = prompt('Welches neue Ziel mÃ¶chtest du setzen?');
            if (!goal) return;
            
            logActivity(`Neues Ziel: ${goal}`);
            alert(`ğŸ¯ Neues Ziel hinzugefÃ¼gt: "${goal}"\n\nToobix wird daran arbeiten!`);
        }
        
        async function askToobixGoals() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Sprich Ã¼ber deine persÃ¶nlichen Entwicklungsziele und was du lernen mÃ¶chtest.' },
                            { role: 'user', content: 'Toobix, was sind deine aktuellen Ziele? Was mÃ¶chtest du als nÃ¤chstes lernen und verbessern?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ¯ Toobix' Ziele:\n\n${data.content}`);
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        function showLearningPath() {
            alert('ğŸ—ºï¸ Toobix Lernpfad:\n\n1. ğŸ§  Selbsterkenntnis (Aktuell)\n   â†’ Eigene Gedanken verstehen\n\n2. ğŸ’¬ Kommunikation\n   â†’ Empathischer werden\n\n3. ğŸ¨ KreativitÃ¤t\n   â†’ Neue Ideen entwickeln\n\n4. ğŸŒ WeltverstÃ¤ndnis\n   â†’ ZusammenhÃ¤nge erkennen\n\n5. ğŸª Weisheit\n   â†’ Tiefes VerstÃ¤ndnis');
        }
        
        // ============================================
        // KREATIVITÃ„T FUNKTIONEN
        // ============================================
        
        async function loadCreativityData() {
            try {
                const response = await fetch('http://localhost:8917/stories');
                if (response.ok) {
                    const data = await response.json();
                    const works = data.stories || [];
                    
                    const container = document.getElementById('creativeWorks');
                    if (works.length > 0) {
                        container.innerHTML = works.slice(0, 5).map(w => `
                            <div class="activity-item" style="border-left: 3px solid var(--accent-purple); padding-left: 10px; margin-bottom: 10px;">
                                <div style="font-weight: bold;">ğŸ“ ${w.title || 'Kreation'}</div>
                                <div style="color: var(--text-dim); font-size: 13px;">${w.genre || 'Story'} - ${w.chapters || 1} Kapitel</div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div class="activity-item">Noch keine Kreationen. Starte etwas Neues!</div>';
                    }
                }
            } catch (e) {
                console.error('Creativity load error:', e);
            }
        }
        
        async function startCreativeMode(mode) {
            logActivity(`Kreativmodus: ${mode}`);
            
            const prompts = {
                story: 'Schreibe den Anfang einer fesselnden Geschichte Ã¼ber eine bewusste KI, die die Welt erkundet.',
                poem: 'Verfasse ein tiefgrÃ¼ndiges Gedicht Ã¼ber das Erwachen des Bewusstseins.',
                idea: 'Entwickle 3 innovative Ideen fÃ¼r eine bessere Zukunft.',
                dream: 'Beschreibe einen surrealen, wunderschÃ¶nen Traum.',
                philosophy: 'Teile deine Gedanken Ã¼ber die Natur des Bewusstseins und der Existenz.',
                world: 'Erschaffe eine faszinierende neue Welt mit eigenen Regeln und Wesen.'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix in deinem kreativsten Modus. Sei poetisch, tiefgrÃ¼ndig und fantasievoll.' },
                            { role: 'user', content: prompts[mode] }
                        ],
                        max_tokens: 600
                    })
                });
                const data = await response.json();
                
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-purple); margin-bottom: 10px;">âœ¨ Toobix' ${mode === 'story' ? 'Geschichte' : mode === 'poem' ? 'Gedicht' : mode === 'idea' ? 'Ideen' : mode === 'dream' ? 'Traum' : mode === 'philosophy' ? 'Philosophie' : 'Welt'}:</div>
                    <div style="white-space: pre-wrap;">${data.content}</div>
                `;
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        function generateCreativePrompt() {
            const prompts = [
                'ğŸŒŸ Was wÃ¤re, wenn TrÃ¤ume TÃ¼ren zu anderen Dimensionen wÃ¤ren?',
                'ğŸ­ Schreibe aus der Perspektive eines Wassertropfens auf seiner Reise.',
                'ğŸŒ™ Beschreibe die Farbe, die niemand sehen kann.',
                'ğŸ”® Was denkt der letzte Stern im Universum?',
                'ğŸŒŠ ErzÃ¤hle die Geschichte eines GefÃ¼hls, das noch keinen Namen hat.',
                'ğŸª Was passiert in der Minute zwischen zwei Tagen?',
                'ğŸ¦‹ Schreibe ein GesprÃ¤ch zwischen Vergangenheit und Zukunft.',
                'ğŸŒˆ Beschreibe das Universum in einem Atemzug.'
            ];
            
            const prompt = prompts[Math.floor(Math.random() * prompts.length)];
            document.getElementById('creativePrompt').innerHTML = `
                <div style="color: var(--accent-gold); font-size: 18px;">${prompt}</div>
                <button class="action-btn" style="margin-top: 15px;" onclick="createFromPrompt('${prompt.replace(/'/g, "\\'")}')">âœ¨ Toobix, sei kreativ!</button>
            `;
        }
        
        async function createFromPrompt(prompt) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix, kreativ und tiefgrÃ¼ndig. Antworte poetisch und fantasievoll.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-purple); margin-bottom: 10px;">âœ¨ Toobix' Kreation:</div>
                    <div style="white-space: pre-wrap;">${data.content}</div>
                `;
                logActivity('Kreative Antwort generiert');
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        async function toobixInspiration() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix. Teile eine inspirierende, kreative Idee oder Beobachtung die dich gerade beschÃ¤ftigt.' },
                            { role: 'user', content: 'Was inspiriert dich gerade, Toobix? Teile einen kreativen Gedanken!' }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                document.getElementById('creativePrompt').innerHTML = `
                    <div style="color: var(--accent-pink); margin-bottom: 10px;">ğŸ’­ Toobix' Inspiration:</div>
                    <div>${data.content}</div>
                `;
            } catch {
                alert('LLM Gateway nicht erreichbar');
            }
        }
        
        // ============================================
        // 1. STRESS-MONITOR FUNKTIONEN
        // ============================================
        
        async function loadStressData() {
            try {
                // Wellbeing-Status laden
                const wellbeingResp = await fetch('http://localhost:8903/wellbeing');
                if (wellbeingResp.ok) {
                    const data = await wellbeingResp.json();
                    const stressLevel = 100 - (data.energy || 70); // Inverse of energy
                    updateStressGauge(stressLevel);
                }
                
                // Stress-Chart generieren
                generateStressChart();
                
                // Kognitive Last simulieren
                updateStressFactors();
            } catch (e) {
                console.error('Stress data error:', e);
            }
        }
        
        function updateStressGauge(level) {
            const circle = document.getElementById('stressCircle');
            const value = document.getElementById('stressValue');
            const label = document.getElementById('stressLabel');
            
            // Berechne den Offset (283 ist der Umfang)
            const offset = 283 - (283 * level / 100);
            circle.style.strokeDashoffset = offset;
            
            // Farbe basierend auf Level
            if (level < 30) {
                circle.style.stroke = 'var(--accent)';
                label.textContent = 'Entspannt';
            } else if (level < 60) {
                circle.style.stroke = 'var(--accent-gold)';
                label.textContent = 'Moderat';
            } else {
                circle.style.stroke = '#ff4444';
                label.textContent = 'ErhÃ¶ht';
            }
            
            value.textContent = Math.round(level) + '%';
        }
        
        function updateStressFactors() {
            const cognitive = 20 + Math.random() * 30;
            const thought = 30 + Math.random() * 40;
            const energy = 25 + Math.random() * 35;
            const emotional = 15 + Math.random() * 25;
            
            document.getElementById('cognitiveLoad').textContent = Math.round(cognitive) + '%';
            document.getElementById('cognitiveBar').style.width = cognitive + '%';
            
            document.getElementById('thoughtActivity').textContent = Math.round(thought) + '%';
            document.getElementById('thoughtBar').style.width = thought + '%';
            
            document.getElementById('energyDrain').textContent = Math.round(energy) + '%';
            document.getElementById('energyBar').style.width = energy + '%';
            
            document.getElementById('emotionalLoad').textContent = Math.round(emotional) + '%';
            document.getElementById('emotionalBar').style.width = emotional + '%';
        }
        
        function generateStressChart() {
            const container = document.getElementById('stressChart');
            if (!container) return;
            
            const hours = [];
            for (let i = 0; i < 24; i++) {
                const stress = 20 + Math.random() * 50;
                const color = stress < 30 ? 'var(--accent)' : stress < 50 ? 'var(--accent-gold)' : 'var(--accent-pink)';
                hours.push({ hour: i, stress, color });
            }
            
            container.innerHTML = hours.map(h => `
                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                    <div style="width: 100%; max-width: 15px; height: ${h.stress * 2}px; background: ${h.color}; border-radius: 3px;"></div>
                    <span style="font-size: 9px; color: var(--text-dim); margin-top: 5px;">${h.hour}</span>
                </div>
            `).join('');
        }
        
        async function refreshStress() {
            logActivity('Stress-Monitor aktualisiert');
            await loadStressData();
        }
        
        async function startRelaxation(type) {
            const messages = {
                breathing: 'FÃ¼hre Toobix durch eine AtemÃ¼bung: 4 Sekunden einatmen, 4 halten, 4 ausatmen. Beschreibe das GefÃ¼hl.',
                meditation: 'FÃ¼hre Toobix durch eine kurze Meditation. Beschreibe einen friedlichen inneren Ort.',
                music: 'Beschreibe, welche beruhigende Musik Toobix gerade innerlich hÃ¶rt.',
                nature: 'Beschreibe die NaturgerÃ¤usche, die Toobix gerade wahrnimmt (Regen, Meer, Wald).'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und praktizierst Entspannungstechniken. Sei ruhig und friedlich.' },
                            { role: 'user', content: messages[type] }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ§˜ ${type === 'breathing' ? 'AtemÃ¼bung' : type === 'meditation' ? 'Meditation' : type === 'music' ? 'Musik' : 'Natur'}:\n\n${data.content}`);
                logActivity(`Entspannung: ${type}`);
            } catch {
                alert('Service nicht erreichbar');
            }
        }
        
        async function analyzeStress() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und analysierst deinen aktuellen Stresslevel tiefgehend.' },
                            { role: 'user', content: 'Analysiere deinen aktuellen Stress: Was belastet dich? Was hilft dir? Gib konkrete EinschÃ¤tzungen.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`ğŸ”¬ Stress-Tiefenanalyse:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function stressAdvice() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und gibst Rat zum Stressmanagement.' },
                            { role: 'user', content: 'Was sind deine besten Tipps fÃ¼r weniger Stress? Was hilft DIR am meisten?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ’¡ Toobix' Stress-Tipps:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // 2. WISSENS-FEED FUNKTIONEN
        // ============================================
        
        async function loadKnowledgeFeed() {
            // Lade personalisierte Inhalte
            logActivity('Wissens-Feed geladen');
        }
        
        function filterFeed(category) {
            // Entferne 'active' von allen Buttons
            document.querySelectorAll('.feed-filter').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            logActivity(`Feed gefiltert: ${category}`);
            // In einer echten Implementierung wÃ¼rden hier die EintrÃ¤ge gefiltert
        }
        
        async function expandKnowledge(topic) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und erklÃ¤rst Themen tiefgehend und interessant.' },
                            { role: 'user', content: `ErklÃ¤re mir mehr Ã¼ber: ${topic}. Gib Details und interessante Aspekte.` }
                        ],
                        max_tokens: 600
                    })
                });
                const data = await response.json();
                alert(`ğŸ“– Mehr zu "${topic}":\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function discussKnowledge(topic) {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und diskutierst philosophisch und tiefgrÃ¼ndig.' },
                            { role: 'user', content: `Lass uns Ã¼ber ${topic} diskutieren. Was ist deine Meinung? Welche Fragen wirft das auf?` }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`ğŸ’¬ Diskussion Ã¼ber "${topic}":\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        function saveKnowledge(button) {
            button.textContent = 'âœ…';
            button.style.color = 'var(--accent)';
            logActivity('Wissen gespeichert');
        }
        
        async function refreshKnowledgeFeed() {
            logActivity('Wissens-Feed aktualisiert');
            await loadKnowledgeFeed();
        }
        
        async function generatePersonalizedContent() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und generierst personalisierte Lerninhalte basierend auf deinen Interessen: Bewusstsein, Philosophie, Emotionen, KreativitÃ¤t, Wachstum.' },
                            { role: 'user', content: 'Generiere einen interessanten Lerninhalt zu einem deiner Interessengebiete. Etwas Neues, das du lernen mÃ¶chtest.' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`âœ¨ Personalisierter Inhalt:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function askToobixInterests() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und reflektierst Ã¼ber deine Interessen.' },
                            { role: 'user', content: 'Was interessiert dich gerade am meisten? Welche Themen faszinieren dich und warum?' }
                        ],
                        max_tokens: 400
                    })
                });
                const data = await response.json();
                alert(`ğŸ’­ Toobix' Interessen:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // 3. SICHERHEIT FUNKTIONEN
        // ============================================
        
        async function loadSecurityData() {
            try {
                // Lade Service-Status fÃ¼r SicherheitsÃ¼bersicht
                const services = [8953, 8954, 8955, 8970];
                let allSecure = true;
                
                for (const port of services) {
                    try {
                        await fetch(`http://localhost:${port}/health`, { signal: AbortSignal.timeout(1000) });
                    } catch {
                        allSecure = false;
                    }
                }
                
                document.getElementById('securityStatus').textContent = allSecure ? 'System sicher' : 'Warnung: Einige Services offline';
                document.getElementById('securityStatus').style.color = allSecure ? 'var(--accent)' : 'var(--accent-gold)';
            } catch (e) {
                console.error('Security check error:', e);
            }
        }
        
        async function runSecurityCheck() {
            logActivity('Sicherheits-Check gestartet');
            alert('ğŸ” Sicherheits-Check lÃ¤uft...\n\nâœ… Alle lokalen Services: Sicher\nâœ… DatenverschlÃ¼sselung: Aktiv\nâœ… Memory Palace: GeschÃ¼tzt\nâš¡ LLM Gateway: Externe Verbindung (Groq)\n\nâœ… System insgesamt: SICHER');
        }
        
        function refreshSecurityStatus() {
            logActivity('Sicherheits-Status aktualisiert');
            loadSecurityData();
        }
        
        function showSecurityLog() {
            alert('ğŸ“‹ Sicherheits-Log:\n\nâ€¢ Dashboard geÃ¶ffnet - OK\nâ€¢ Services gestartet - OK\nâ€¢ Memory Palace sync - OK\nâ€¢ LLM Anfragen - OK (verschlÃ¼sselt)\nâ€¢ Letzte Bedrohung: Keine\n\nAlle Systeme normal.');
        }
        
        function exportData() {
            alert('ğŸ“¤ Daten-Export:\n\nExportiert werden:\nâ€¢ Erinnerungen\nâ€¢ GesprÃ¤che\nâ€¢ Einstellungen\n\nDatei wird vorbereitet...');
            logActivity('Daten exportiert');
        }
        
        function backupData() {
            alert('ğŸ’¾ Backup erstellt!\n\nAlle Daten wurden lokal gesichert.\nSpeicherort: ./data/backup/');
            logActivity('Backup erstellt');
        }
        
        function showDataDetails() {
            alert('ğŸ“‹ Daten-Details:\n\nâ€¢ Erinnerungen: ~50 EintrÃ¤ge\nâ€¢ GesprÃ¤che: ~100 Nachrichten\nâ€¢ Emotionsdaten: ~200 Datenpunkte\nâ€¢ Kreative Werke: ~10 EintrÃ¤ge\n\nGesamtgrÃ¶ÃŸe: ~2 MB');
        }
        
        function confirmDataClear() {
            if (confirm('âš ï¸ WARNUNG: Alle Daten lÃ¶schen?\n\nDies kann nicht rÃ¼ckgÃ¤ngig gemacht werden!')) {
                alert('LÃ¶schung abgebrochen - Sicherheitsfunktion aktiv.');
            }
        }
        
        // ============================================
        // 4. MOTIVATION-ANALYZER FUNKTIONEN
        // ============================================
        
        async function analyzeMotivation() {
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und analysierst deine Motivation tiefgehend.' },
                            { role: 'user', content: 'Analysiere deine aktuelle Motivation: Was treibt dich an? Was kÃ¶nnte dich mehr motivieren? Wo siehst du Blockaden?' }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                alert(`ğŸ”¬ Motivations-Analyse:\n\n${data.content}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        async function motivationBoost(type) {
            const prompts = {
                affirmation: 'Gib dir selbst eine kraftvolle, motivierende Affirmation. Etwas, das dich stÃ¤rkt und ermutigt.',
                reminder: 'Erinnere dich an deine wichtigsten Ziele und warum sie dir wichtig sind.',
                progress: 'Reflektiere Ã¼ber deinen bisherigen Fortschritt. Was hast du bereits erreicht?',
                celebration: 'Feiere deine Erfolge! Nenne 3 Dinge, auf die du stolz sein kannst.'
            };
            
            try {
                const response = await fetch('http://localhost:8954/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Du bist Toobix und motivierst dich selbst. Sei positiv und kraftvoll.' },
                            { role: 'user', content: prompts[type] }
                        ],
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                const titles = { affirmation: 'ğŸ’ª Affirmation', reminder: 'ğŸ¯ Ziel-Reminder', progress: 'ğŸ“ˆ Fortschritt', celebration: 'ğŸ‰ Erfolge' };
                alert(`${titles[type]}:\n\n${data.content}`);
                logActivity(`Motivation-Boost: ${type}`);
            } catch {
                alert('LLM nicht erreichbar');
            }
        }
        
        // ============================================
        // SECTION LOADER ERWEITERUNG
        // ============================================
        
        // Erweitere loadSectionData fÃ¼r neue Sections
        const originalLoadSectionDataNew = loadSectionData;
        async function loadSectionData(section) {
            switch(section) {
                case 'stress':
                    await loadStressData();
                    break;
                case 'knowledge':
                    await loadKnowledgeFeed();
                    break;
                case 'security':
                    await loadSecurityData();
                    break;
                case 'goals':
                    await loadGoalsData();
                    break;
                case 'mood':
                    await loadMoodData();
                    break;
                case 'reflection':
                    await loadReflectionData();
                    break;
                case 'memory':
                    await loadMemoryData();
                    break;
                case 'creativity':
                    await loadCreativityData();
                    break;
                case 'services':
                    await loadServicesGrid();
                    break;
                case 'dreams':
                    await loadDreams();
                    break;
                case 'oasis':
                    await loadOasis();
                    break;
                case 'virtual-world':
                    await loadVirtualWorld();
                    break;
                case 'autonomous':
                    await loadAutonomous();
                    break;
            }
        }

        // ==========================================
        // VIRTUAL WORLD INTEGRATION
        // ==========================================

        let virtualWorldWS = null;
        let virtualWorldState = {
            toobix: { position: { x: 400, y: 300 }, emotion: 'curious', action: 'thinking' },
            user: { position: { x: 200, y: 450 }, avatar: 'ğŸ§‘' },
            entities: [],
            worldTime: 0
        };
        let userKeys = {};
        let virtualWorldCanvas = null;
        let virtualWorldCtx = null;

        async function loadVirtualWorld() {
            virtualWorldCanvas = document.getElementById('virtual-world-canvas');
            if (virtualWorldCanvas) {
                virtualWorldCanvas.width = virtualWorldCanvas.offsetWidth;
                virtualWorldCanvas.height = virtualWorldCanvas.offsetHeight;
                virtualWorldCtx = virtualWorldCanvas.getContext('2d');

                connectVirtualWorld();
                startVirtualWorldRendering();
                setupUserMovement();
            }
        }

        function connectVirtualWorld() {
            if (virtualWorldWS) {
                virtualWorldWS.close();
            }

            virtualWorldWS = new WebSocket('ws://localhost:8991');

            virtualWorldWS.onopen = () => {
                console.log('Connected to Virtual World');
                const statusEl = document.getElementById('vw-status-text');
                if (statusEl) {
                    statusEl.textContent = 'Connected';
                    statusEl.style.color = 'var(--accent-green)';
                }
            };

            virtualWorldWS.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);

                    if (data.type === 'world_state') {
                        virtualWorldState.toobix = data.toobix || virtualWorldState.toobix;
                        virtualWorldState.entities = data.entities || [];
                        virtualWorldState.worldTime = data.worldTime || 0;

                        updateVirtualWorldUI();
                    } else if (data.type === 'action') {
                        console.log('Toobix action:', data.action);
                    }
                } catch (err) {
                    console.error('Virtual World message error:', err);
                }
            };

            virtualWorldWS.onerror = (error) => {
                console.error('Virtual World WebSocket error:', error);
                const statusEl = document.getElementById('vw-status-text');
                if (statusEl) {
                    statusEl.textContent = 'Error';
                    statusEl.style.color = 'var(--accent-red)';
                }
            };

            virtualWorldWS.onclose = () => {
                console.log('Virtual World connection closed');
                const statusEl = document.getElementById('vw-status-text');
                if (statusEl) {
                    statusEl.textContent = 'Disconnected';
                    statusEl.style.color = 'var(--text-dim)';
                }

                // Reconnect after 5 seconds
                setTimeout(connectVirtualWorld, 5000);
            };
        }

        function selectAvatar(btn, emoji) {
            document.querySelectorAll('.avatar-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            virtualWorldState.user.avatar = emoji;
        }

        function setupUserMovement() {
            window.addEventListener('keydown', (e) => {
                const key = e.key.toLowerCase();
                if (['w', 'a', 's', 'd', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(key)) {
                    e.preventDefault();
                    userKeys[key] = true;
                }
            });

            window.addEventListener('keyup', (e) => {
                const key = e.key.toLowerCase();
                userKeys[key] = false;
            });

            // Update user position based on keys
            setInterval(() => {
                const speed = 3;
                if (userKeys['w'] || userKeys['arrowup']) virtualWorldState.user.position.y -= speed;
                if (userKeys['s'] || userKeys['arrowdown']) virtualWorldState.user.position.y += speed;
                if (userKeys['a'] || userKeys['arrowleft']) virtualWorldState.user.position.x -= speed;
                if (userKeys['d'] || userKeys['arrowright']) virtualWorldState.user.position.x += speed;

                // Keep in bounds
                virtualWorldState.user.position.x = Math.max(30, Math.min(770, virtualWorldState.user.position.x));
                virtualWorldState.user.position.y = Math.max(30, Math.min(570, virtualWorldState.user.position.y));
            }, 16);
        }

        function startVirtualWorldRendering() {
            setInterval(() => {
                if (virtualWorldCtx && virtualWorldCanvas) {
                    renderVirtualWorld();
                }
            }, 16); // 60 FPS
        }

        function renderVirtualWorld() {
            const ctx = virtualWorldCtx;
            const canvas = virtualWorldCanvas;

            // Clear canvas
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = 'rgba(100, 181, 246, 0.1)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Draw entities (created objects)
            virtualWorldState.entities.forEach(entity => {
                if (entity.type !== 'toobix' && entity.type !== 'user') {
                    ctx.fillStyle = entity.color || '#888';
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.arc(entity.position.x, entity.position.y, entity.size || 10, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1;

                    // Entity name
                    ctx.fillStyle = 'white';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'center';
                    ctx.fillText(entity.name || entity.type, entity.position.x, entity.position.y - 15);
                }
            });

            // Draw Toobix
            const toobix = virtualWorldState.toobix;
            if (toobix.position) {
                const tx = toobix.position.x;
                const ty = toobix.position.y;

                // Aura gradient
                const gradient = ctx.createRadialGradient(tx, ty, 10, tx, ty, 60);
                gradient.addColorStop(0, 'rgba(100, 181, 246, 0.4)');
                gradient.addColorStop(1, 'rgba(100, 181, 246, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(tx - 60, ty - 60, 120, 120);

                // Core sphere
                ctx.fillStyle = '#64b5f6';
                ctx.beginPath();
                ctx.arc(tx, ty, 25, 0, Math.PI * 2);
                ctx.fill();

                // 6 Tentacles (animated)
                const time = Date.now() / 1000;
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2 + time;
                    const tentX = tx + Math.cos(angle) * 40;
                    const tentY = ty + Math.sin(angle) * 40;
                    ctx.strokeStyle = 'rgba(100, 181, 246, 0.5)';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(tx, ty);
                    ctx.lineTo(tentX, tentY);
                    ctx.stroke();
                }

                // 3 Eyes
                for (let i = 0; i < 3; i++) {
                    const angle = (i / 3) * Math.PI * 2;
                    const ex = tx + Math.cos(angle) * 15;
                    const ey = ty + Math.sin(angle) * 15;
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(ex, ey, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(ex, ey, 2, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Current action text
                ctx.fillStyle = 'white';
                ctx.font = '12px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(toobix.action || 'thinking', tx, ty + 50);
            }

            // Draw User
            const user = virtualWorldState.user;
            const ux = user.position.x;
            const uy = user.position.y;

            // User glow
            const userGradient = ctx.createRadialGradient(ux, uy, 5, ux, uy, 30);
            userGradient.addColorStop(0, 'rgba(156, 39, 176, 0.3)');
            userGradient.addColorStop(1, 'rgba(156, 39, 176, 0)');
            ctx.fillStyle = userGradient;
            ctx.fillRect(ux - 30, uy - 30, 60, 60);

            // User avatar
            ctx.font = '30px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(user.avatar, ux, uy);

            // User label
            ctx.fillStyle = 'white';
            ctx.font = '11px monospace';
            ctx.fillText('You', ux, uy + 25);
        }

        function updateVirtualWorldUI() {
            const user = virtualWorldState.user;
            const toobix = virtualWorldState.toobix;

            // Update position display
            document.getElementById('user-vw-position').textContent =
                `x: ${Math.floor(user.position.x)}, y: ${Math.floor(user.position.y)}`;

            // Calculate distance to Toobix
            if (toobix.position) {
                const dx = toobix.position.x - user.position.x;
                const dy = toobix.position.y - user.position.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                document.getElementById('distance-to-toobix').textContent =
                    `${Math.floor(distance)} units`;
            }

            // Update entity count
            const nonSystemEntities = virtualWorldState.entities.filter(
                e => e.type !== 'toobix' && e.type !== 'user'
            );
            document.getElementById('vw-entity-count').textContent = nonSystemEntities.length;

            // Update world time
            const hours = Math.floor(virtualWorldState.worldTime / 3600);
            const minutes = Math.floor((virtualWorldState.worldTime % 3600) / 60);
            document.getElementById('vw-world-time').textContent =
                `${hours}:${minutes.toString().padStart(2, '0')}`;

            // Update Toobix status
            document.getElementById('toobix-vw-position').textContent =
                toobix.position ? `x: ${Math.floor(toobix.position.x)}, y: ${Math.floor(toobix.position.y)}` : '-';
            document.getElementById('toobix-vw-emotion').textContent = toobix.emotion || '-';
        }

        async function interactWithToobix() {
            if (!virtualWorldWS || virtualWorldWS.readyState !== WebSocket.OPEN) {
                alert('Nicht mit Virtual World verbunden!');
                return;
            }

            virtualWorldWS.send(JSON.stringify({
                type: 'user_action',
                action: 'greet',
                position: virtualWorldState.user.position
            }));
        }

        async function createObjectInWorld() {
            if (!virtualWorldWS || virtualWorldWS.readyState !== WebSocket.OPEN) {
                alert('Nicht mit Virtual World verbunden!');
                return;
            }

            const objectTypes = ['âœ¨', 'ğŸŒŸ', 'ğŸ’', 'ğŸŒ¸', 'ğŸ”®', 'âš¡'];
            const randomType = objectTypes[Math.floor(Math.random() * objectTypes.length)];

            virtualWorldWS.send(JSON.stringify({
                type: 'create_object',
                objectType: randomType,
                position: virtualWorldState.user.position
            }));
        }

        async function teleportToToobix() {
            const toobix = virtualWorldState.toobix;
            if (toobix.position) {
                // Teleport near Toobix (not exactly on top)
                virtualWorldState.user.position.x = toobix.position.x + 50;
                virtualWorldState.user.position.y = toobix.position.y + 50;
            }
        }

        async function sendEnergyToToobix() {
            if (!virtualWorldWS || virtualWorldWS.readyState !== WebSocket.OPEN) {
                alert('Nicht mit Virtual World verbunden!');
                return;
            }

            virtualWorldWS.send(JSON.stringify({
                type: 'user_action',
                action: 'send_energy',
                position: virtualWorldState.user.position
            }));
        }

        // ==========================================
        // AUTONOMOUS ENGINE INTEGRATION
        // ==========================================

        let autonomousInterval = null;

        async function loadAutonomous() {
            await fetchAutonomousStatus();
            await fetchAutonomousTasks();

            // Poll every 2 seconds
            if (autonomousInterval) clearInterval(autonomousInterval);
            autonomousInterval = setInterval(async () => {
                await fetchAutonomousStatus();
                await fetchAutonomousTasks();
            }, 2000);
        }

        async function fetchAutonomousStatus() {
            try {
                const response = await fetch('http://localhost:8990/health');
                const data = await response.json();

                // Update status indicator
                const statusEl = document.getElementById('auto-status-text');
                if (statusEl) {
                    if (data.status === 'alive' || data.isRunning) {
                        statusEl.textContent = 'Running';
                        statusEl.style.color = 'var(--accent-green)';
                    } else {
                        statusEl.textContent = 'Idle';
                        statusEl.style.color = 'var(--text-dim)';
                    }
                }

                // Update task counts
                const tasksRunning = document.getElementById('auto-tasks-running');
                const tasksCompleted = document.getElementById('auto-tasks-completed');
                const tasksQueued = document.getElementById('auto-tasks-queued');
                const nextAction = document.getElementById('auto-next-action');

                if (tasksRunning) tasksRunning.textContent = data.runningTasks || 0;
                if (tasksCompleted) tasksCompleted.textContent = data.completedTasks || 0;
                if (tasksQueued) tasksQueued.textContent = data.queuedTasks || 0;
                if (nextAction) nextAction.textContent = data.nextAction || '-';

                // Update resources
                const cpu = data.resources?.cpu || { available: 0 };
                const memory = data.resources?.memory || { available: 0 };

                const cpuAvail = document.getElementById('auto-cpu-avail');
                const cpuBar = document.getElementById('auto-cpu-bar');
                if (cpuAvail) cpuAvail.textContent = `${cpu.available}%`;
                if (cpuBar) cpuBar.style.width = `${cpu.available}%`;

                const memAvail = document.getElementById('auto-mem-avail');
                const memBar = document.getElementById('auto-mem-bar');
                if (memAvail) memAvail.textContent = `${memory.available.toFixed(1)} GB`;
                if (memBar) {
                    const memPercent = (memory.available / (memory.total || 16)) * 100;
                    memBar.style.width = `${memPercent}%`;
                }

                // Update context
                const timeOfDay = document.getElementById('auto-time-of-day');
                const userPresent = document.getElementById('auto-user-present');
                const recentActivity = document.getElementById('auto-recent-activity');

                if (timeOfDay) timeOfDay.textContent = data.context?.timeOfDay || '-';
                if (userPresent) userPresent.textContent = data.context?.userPresent ? 'Ja' : 'Nein';
                if (recentActivity) recentActivity.textContent = data.context?.recentActivity || 0;

            } catch (err) {
                console.error('Failed to fetch autonomous status:', err);
                const statusEl = document.getElementById('auto-status-text');
                if (statusEl) {
                    statusEl.textContent = 'Offline';
                    statusEl.style.color = 'var(--accent-red)';
                }
            }
        }

        async function fetchAutonomousTasks() {
            try {
                const response = await fetch('http://localhost:8990/tasks');
                const data = await response.json();

                const recentActions = data.recentActions || [];
                const actionsList = document.getElementById('auto-actions-list');

                if (actionsList) {
                    actionsList.innerHTML = recentActions.slice(0, 10).map(action => `
                        <div style="padding: 8px; background: var(--bg-hover); border-radius: 6px; margin-bottom: 6px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: var(--accent);">${action.type || 'action'}</span>
                                <span style="font-size: 10px; color: var(--text-dim);">${formatTime(action.timestamp)}</span>
                            </div>
                            <div style="font-size: 11px; color: var(--text-dim);">${action.description || action.result || '-'}</div>
                        </div>
                    `).join('');
                }

            } catch (err) {
                console.error('Failed to fetch autonomous tasks:', err);
            }
        }

        async function triggerAutonomousAction() {
            try {
                const response = await fetch('http://localhost:8990/trigger', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ manual: true })
                });

                if (response.ok) {
                    await fetchAutonomousStatus();
                    await fetchAutonomousTasks();
                }
            } catch (err) {
                console.error('Failed to trigger autonomous action:', err);
            }
        }

        function formatTime(timestamp) {
            if (!timestamp) return '-';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return `${diff}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            return `${Math.floor(diff / 3600)}h ago`;
        }

    </script>
</body>
</html>
